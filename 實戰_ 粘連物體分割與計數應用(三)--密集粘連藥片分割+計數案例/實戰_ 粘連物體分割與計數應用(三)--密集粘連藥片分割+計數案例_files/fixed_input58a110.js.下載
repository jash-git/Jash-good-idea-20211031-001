define("pages/player_adaptor.js",["pages/music_player.js","biz_wap/utils/jsmonitor_report.js","pages/loadscript.js","pages/music_report_conf.js"],function(t){
"use strict";
function i(t,i){
0!=t.type&&1!=t.type||!p.inQMClient?"function"==typeof i.callback&&i.callback(new a.init(t)):(p.initPlayerQueue.push(e("QMClient",t,i)),
n("QMClient"));
}
function e(t,i,e){
var n=p.config[t].func;
return function(t,i,e,n){
return function(){
"function"==typeof window[i]?"function"==typeof n.callback&&n.callback(new o(e,{
type:t
})):"function"==typeof n.callback&&n.callback(new a.init(e));
};
}(t,n,i,e);
}
function n(t){
var i=p.config[t];
if(1!=i.jsLoadState){
if(2==i.jsLoadState||3==i.jsLoadState)return void r();
i.jsLoadState=1;
var e=+new Date,n=l[t+"_js_num"];
n&&(n=n.split("_"),u.setSum(n[0],n[1],1)),c({
url:i.jsLink,
timeout:1e4,
type:"JS",
callback:function(){
+new Date-e;
2==i.jsLoadState,r();
var n=l[t+"_js_suc"];
n&&(n=n.split("_"),u.setSum(n[0],n[1],1));
},
onerror:function(n){
+new Date-e;
i.jsLoadState=3,r();
var s=l[t+"_js_err"],o=l[t+"_js_timeout"],a=l[t+"_js_network"];
if(s&&o&&a)switch(s=s.split("_"),o=o.split("_"),a=a.split("_"),u.setSum(s[0],s[1],1),
1*n){
case 400:
u.setSum(a[0],a[1],1);
break;

case 500:
u.setSum(o[0],o[1],1);
}
}
});
}
}
function r(){
for(var t=0,i=p.initPlayerQueue.length;i>t;t++)"function"==typeof p.initPlayerQueue[t]&&p.initPlayerQueue[t]();
p.initPlayerQueue=[];
}
function s(){
for(var t in p.config)"function"==typeof p[t+"EvInit"]&&p[t+"EvInit"]();
}
function o(t,i){
if(this.opt=t,this.opt2=i,this._g={
_blockPlugin:{},
playType:"-1"
},"QMClient"==i.type&&p.inQMClient){
var e=p.config[i.type];
e.playerObj||(p.config[i.type].playerObj=new window[e.func]),this._g.playType=i.type,
this.player=e.playerObj,this._initPlugins(),this._bindQMEvent();
}
}
var a=t("pages/music_player.js"),u=t("biz_wap/utils/jsmonitor_report.js"),c=t("pages/loadscript.js"),l=t("pages/music_report_conf.js"),p={
debug:location.href.indexOf("_qqclient=1")>0?!0:!1,
config:{
QMClient:{
func:"Player",
playerObj:null,
jsLink:"https://imgcache.qq.com/music/h5/player/player.js?max_age=604800&v=1",
jsLoadState:-1
}
},
inQMClient:!1,
initPlayerQueue:[]
};
return p.QMClientEvInit=function(){
if(p.inQMClient=window.navigator.userAgent.indexOf("QQMusic/")>0||p.debug?!0:!1,
p.inQMClient&&window.msg_cdn_url&&window.msg_title){
var t=window.location.href,i=a.getQuery("scene",t);
i&&(t=t.replace("&scene="+i,"").replace("?scene="+i,"")),t=t.replace(/#rd$/,"").replace(/#wechat_redirect$/,""),
-1==t.indexOf("?")&&(t+="?"),t+="&scene=112#wechat_redirect";
var e=function(t){
window.WebViewJavascriptBridge?t():document.addEventListener("WebViewJavascriptBridgeReady",t);
},n=(window.msg_title||"").html(!1),r=(window.msg_desc||"").html(!1);
e(function(){
M.client.invoke("ui","setActionBtn",{
type:"icon",
content:"share"
},function(){
M.client.invoke("other","callShareWeb",{
imgUrl:window.msg_cdn_url,
link:t,
title:n,
desc:r
});
});
});
}
},s(),o.prototype={
_initPlugins:function(){
this.opt.plugins||(this.opt.plugins=[]);
for(var t=this.opt.plugins,i=0,e=t.length;e>i;++i){
var n=t[i];
n.setPlayer(this),!!n.init&&n.init();
}
},
_trigger:function(t,i){
var e=this.opt,n=this._g,r=e.plugins,s=n._blockPlugin[t]||n._blockPlugin.all,o=0;
if(s&&"function"==typeof s.recv&&(o|=s.recv(t,i),1&o))return!1;
for(var a=0,u=r.length;u>a&&(o|=r[a].recv(t,i),!(2&o));++a);
if(!(4&o)){
var c=this["__"+t+"Handler"];
c&&c.call(this,i);
}
8&o||this.__triggerOutside(t,i);
},
__triggerOutside:function(){
var t=arguments,i=t[0];
if(i){
i=i.substr(0,1).toUpperCase()+i.substr(1);
var e=this.opt["on"+i];
"function"==typeof e&&e.apply(this,t);
}
},
_setBlockPlugin:function(t,i){
this._g._blockPlugin[t]=i;
},
_bindQMEvent:function(){
var t=this;
this.player.on("play",function(i){
i&&i.song&&i.song.mid==t.opt.mid?(t._trigger("statusChange",1),t._trigger("QMClientPlay")):t._trigger("statusChange",3);
}),this.player.on("pause",function(i){
i&&i.song&&i.song.mid==t.opt.mid&&t._trigger("statusChange",2);
}),this.player.on("stop",function(i){
i&&i.song&&i.song.mid==t.opt.mid&&t._trigger("statusChange",3);
});
},
play:function(){
"QMClient"==this._g.playType&&this.player.play(this.opt.mid);
},
pause:function(){
this.player.pause();
},
stop:function(){
this.player.stop();
},
getDuration:function(){
return this.opt.duration?this.opt.duration:"QMClient"==this._g.playType?this.player.duration||0:0;
},
getCurTime:function(){
return"QMClient"==this._g.playType?this.player.currentTime||0:0;
},
surportSeekRange:function(){
return!1;
},
getSrc:function(){
return"";
},
destory:function(){},
seek:function(){},
setDuration:function(){},
setSrc:function(){}
},{
create:i,
inQMClient:p.inQMClient
};
});var _extends=Object.assign||function(t){
for(var e=1;e<arguments.length;e++){
var i=arguments[e];
for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o]);
}
return t;
};
define("pages/music_player.js",["biz_wap/utils/mmversion.js","biz_wap/jsapi/core.js","pages/version4video.js","appmsg/log.js","biz_common/utils/url/parse.js"],function(t){
"use strict";
function e(){
C.hasInit||(C.hasInit=!0,l(),c("onBackgroundAudioStateChange"),c("onTingAudioStateChanged"),
r());
}
function i(t){
var i=this;
e(),this._o={
plugins:[],
protocal:"",
wxIndex:0,
type:0,
src:"",
jsapi2Src:"",
mid:"",
autoPlay:!1,
duration:0,
needVioceMutex:!0,
title:"",
allowPause:!1,
singer:"",
epname:"",
coverImgUrl:"",
webUrl:"",
musicbar_url:"",
fileSize:0,
onStatusChange:function(){},
onTimeupdate:function(){},
onError:function(){},
onUpdateSeekRange:function(){},
albumId:"",
audioList:[],
playAudioId:"",
speedList:[],
articleCoverCdnUrl1_1:"",
albumInfo:{},
tingExtInfo:{}
},this._extend(t),this._o.audioList.length&&this._o.audioList.forEach(function(t){
t.srcId=C.wxtag+i._o.albumId+"_"+t.audioId;
}),this._status=-1,this._g={
mutexKey:"",
jsapiSrcId:"",
hasCheckPlay:!1,
playTimeoutId:null,
stateChangeCallback:{},
_blockPlugin:{},
hasInitH5Event:!1,
h5Event:{},
totalPlayTime:0,
hasPlayedDuration:0
},this._initPlugins(),this._fixAndroidSizeLimit(),0!==C.surportType&&(this._initData(),
this._synSpeedList(),this._synPlayStatus(),!!C.debug&&console.log("听一听开关: ",this._o.isTingOpen));
}
function o(t){
I.invoke("musicPlay",{
app_id:"a",
title:"微信公众平台",
singer:"微信公众平台",
epname:"微信公众平台",
coverImgUrl:"http://res.wx.qq.com/mpres/htmledition/images/favicon.ico",
dataUrl:C.ev,
lowbandUrl:C.ev,
webUrl:"http://mp.weixin.qq.com/s?"
},function(e){
"function"==typeof t&&t(e);
});
}
function a(t){
n({
cur:t,
stopCur:!1
});
}
function n(t){
function e(){
if(C.mutexCount==s&&(s=0,C.mutexCount=0,"function"==typeof a)){
var t=0;
1==C.surportType?t=2e3:3==C.surportType&&(t=0),setTimeout(function(){
a();
},t);
}
}
if(0!=C.mutexCount)return void setTimeout(function(){
n(t);
},200);
var i=t.cur,o=t.stopCur===!0?!0:!1,a=t.callback,s=0;
for(var u in C.mutexPlayers)for(var r=0,l=C.mutexPlayers[u].length;l>r;r++)s++;
for(var u in C.mutexPlayers)for(var r=0,l=C.mutexPlayers[u].length;l>r;r++){
var d=C.mutexPlayers[u][r];
if(d&&d!==i){
var p=d.getSurportType(),c="";
2!=p||1!=d._status&&4!=d._status?1!=p&&3!=p||1!=d._status&&2!=d._status&&4!=d._status||(c="stop"):c=d._o.allowPause?"pause":"stop",
c&&"function"==typeof d[c]?d[c](o,function(){
C.mutexCount++,e();
}):(C.mutexCount++,e());
}else C.mutexCount++,e();
}
}
function s(){
return C.surportType;
}
function u(t,e){
return new i(t,e);
}
function r(){
C.surportType>0&&C.isAndroidLow&&window.addEventListener("canplay",function(t){
t.target&&"function"==typeof t.target.play&&t.target.play();
},!0);
}
function l(){
C.jsapiGlobalEvent={
error:h,
pause:_,
stop:y,
play:g,
preempted:y,
waiting:f
};
}
function d(t){
return"&"+C.wxtag+"="+t;
}
function p(t,e){
e=e||"info";
var i="[musicplay]"+t+"[location:"+location.href+"]";
x(i,e);
}
function c(t){
I.on(t,function(t){
if(!!C.debug&&console.log("+++++++++++++++onBackgroundAudioStateChange log:"+JSON.stringify(t||{})),
t.state){
t.src&&(t.src=T(t.src,"t"));
var e;
t.albumId?(e=t.albumId,t.srcId=""):t.srcId&&t.audioId&&(e=t.srcId.match(new RegExp(C.wxtag+"(.*?)_"+t.audioId)))?(e=e[1],
t.srcId="",t.albumId=e):(e=v(C.wxtag,t.src)||"",e&&(e=d(e)));
var i=C.mutexPlayers[t.src]||C.mutexPlayers2[t.src]||C.mutexPlayers[e];
if(i){
var o;
if(t.srcId)for(var a=0,n=i.length;n>a;a++)i[a]._g.jsapiSrcId==t.srcId&&(o=i[a]);else if(1==i.length)o=i[0];else for(var a=0,n=i.length;n>a;a++)if(-1!=i[a]._status&&0!=i[a]._status&&3!=i[a]._status){
o=i[a];
break;
}
if(o&&o._g.stateChangeCallback){
t.albumId===o._o.albumId&&t.audioId!==o.getPlayAudioId()&&(o.setPlayAudioId(t.audioId),
o._initJsapiData());
var s=t.state,u=!1;
"ended"===s&&(s="stop",u=!0),"wait"==s&&(s="waiting");
var r=!1,l=JSON.stringify(t||{});
if("error"==s){
o.jsapiLog("onBackgroundAudioStateChange error;res:"+l);
for(var p in o._g.stateChangeCallback)o._g.stateChangeCallback.hasOwnProperty(p)&&"function"==typeof o._g.stateChangeCallback[p]&&(r=!0,
o._g.stateChangeCallback[p](-1,t.errMsg||""),o._g.stateChangeCallback[p]=null);
}else"function"==typeof o._g.stateChangeCallback[s]&&(C.debug&&console.log("excute stateChangeCallback :"+s),
o.jsapiLog("onBackgroundAudioStateChange "+s+";res:"+l),r=!0,o._g.stateChangeCallback[s](0),
o._g.stateChangeCallback[s]=null);
r||"function"!=typeof C.jsapiGlobalEvent[s]||(o.jsapiLog("onBackgroundAudioStateChange "+s+" unHandle;res:"+l),
"stop"===s?C.jsapiGlobalEvent[s](t,o,u):C.jsapiGlobalEvent[s](t,o));
}
}
}
});
}
function h(t,e){
e.stop(!1),e._trigger("jsapi2PlayingErr");
}
function y(t,e,i){
e.stop(!1,null,t,i),e._trigger("jsapi2PlayingStop");
}
function _(t,e){
e.pause(!1,null,!0),e._trigger("jsapi2PlayingPause");
}
function g(t,e){
1!=e._status&&e.resume(!1,null,!0);
}
function f(t,e){
e.onload();
}
function m(){
for(var t in C.mutexPlayers)if(C.mutexPlayers.hasOwnProperty(t))for(var e=0,i=C.mutexPlayers[t].length;i>e;e++){
var o=C.mutexPlayers[t][e];
if(o&&1==o._status&&(1==o._surportType||3==o._surportType)){
o._trigger("unloadPlaying");
break;
}
}
}
function v(t){
var e=arguments[1]||window.location.search,i=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),o=e.substr(e.indexOf("?")+1).match(i);
return null!=o?o[2]:"";
}
function S(t,e,i){
function o(t,e){
for(;C.synPlayStatusArr.length>0;){
var i=C.synPlayStatusArr.shift();
i&&"function"==typeof i[t]&&i[t](e);
}
}
C.synPlayStatusArr.push({
_t:t,
onSuccess:e,
onError:i
}),C.synPlayStatusId&&clearTimeout(C.synPlayStatusId),C.synPlayStatusId=setTimeout(function(){
t._jsapi_getMusicPlayerState({
onSuccess:function(t){
o("onSuccess",t);
},
onError:function(t){
o("onError",t);
}
});
},0);
}
function A(t){
var e=1*t;
C.playbackRate=isNaN(e)?1:e;
}
function b(){
return C.playbackRate;
}
function T(t,e){
if(t){
if(!e)return t;
var i=new URL(t),o=i.origin,a=i.pathname,n=i.searchParams,s=i.hash;
if(n){
if(n.has(e)){
n.delete(e);
var u=[],r=!0,l=!1,d=void 0;
try{
for(var p,c=n[Symbol.iterator]();!(r=(p=c.next()).done);r=!0){
var h=p.value;
u.push(h[0]+"="+h[1]);
}
}catch(y){
l=!0,d=y;
}finally{
try{
!r&&c.return&&c.return();
}finally{
if(l)throw d;
}
}
return""+o+a+"?"+u.join("&")+s;
}
}else{
var _=i.search;
if(_){
var g=new RegExp("[?&]?"+e+"=[^&]*","g");
return _=_.replace(g,"").replace(/^&/,"?"),""+o+a+_+s;
}
}
return t;
}
}
var P=t("biz_wap/utils/mmversion.js"),I=t("biz_wap/jsapi/core.js"),k=t("pages/version4video.js"),x=t("appmsg/log.js"),j=t("biz_common/utils/url/parse.js"),C={
hasInit:!1,
synPlayStatusId:null,
synPlayStatusArr:[],
inWechat:!k.device.inWechat||k.device.inWindowWechat||k.device.inMacWechat?!1:!0,
mutexCount:0,
ev:0!=window._empty_v.indexOf(window.location.protocol)?"http:"+window._empty_v:window._empty_v,
debug:location.href.indexOf("vconsole=1")>0||document.cookie&&document.cookie.indexOf("vconsole_open=1")>-1?!0:!1,
_playtype:1*v("_playtype")||0,
isAndroidLow:/android\s2\.3/i.test(navigator.userAgent),
isAndroid:P.isAndroid,
surportType:"addEventListener"in window?2:0,
mutexPlayers:{},
mutexPlayers2:{},
wxtag:"__wxtag__",
playbackRate:1,
autoplayAudioList:[],
autoplayAudioListLen:10
};
return i.prototype._initPlugins=function(){
for(var t=this._o.plugins,e=0,i=t.length;i>e;++e){
var o=t[e];
o.setPlayer(this),!!o.init&&o.init();
}
},i.prototype._trigger=function(t,e){
var i=this._o,o=this._g,a=i.plugins,n=o._blockPlugin[t]||o._blockPlugin.all,s=0;
if(n&&"function"==typeof n.recv&&(s|=n.recv(t,e),1&s))return!1;
for(var u=0,r=a.length;r>u&&(s|=a[u].recv(t,e),!(2&s));++u);
if(!(4&s)){
var l=this["__"+t+"Handler"];
l&&l.call(this,e);
}
8&s||this.__triggerOutside(t,e);
},i.prototype.__triggerOutside=function(){
var t=arguments,e=t[0];
if(e){
e=e.substr(0,1).toUpperCase()+e.substr(1);
var i=this._o["on"+e];
"function"==typeof i&&i.apply(this,t);
}
},i.prototype._setBlockPlugin=function(t,e){
this._g._blockPlugin[t]=e;
},i.prototype._synPlayStatus=function(){
function t(t){
if(s&&clearTimeout(s),n.hasCheckPlay===!0,n.hasCheckPlay=!0,o._surportType=3,C.surportType=3,
A(t.playbackRate),!!C.debug&&console.log("_synPlayStatus mutexKey:"+n.mutexKey),
t&&t.audioListState)try{
t.audioListState=JSON.parse(t.audioListState),t.albumId=t.audioListState.albumId;
}catch(i){}
if(a.albumId){
if(t.albumId&&a.albumId===t.albumId){
var u="waiting"==t.playState||"seeked"==t.playState||"seeking"==t.playState||"play"==t.playState;
o._onAlbumSync({
action:"updatePlayStatus",
isPlay:u
});
}else o._onAlbumSync({
action:"updatePlayStatus",
isPlay:!1
});
e(t);
}else if(t.src&&(a.src==t.src||t.src.indexOf(n.mutexKey)>=0)){
if(t.srcId){
if(t.srcId!=n.jsapiSrcId)return;
}else if(C.mutexPlayers[n.mutexKey].length>1&&C.mutexPlayers[n.mutexKey][0]!==o)return;
e(t);
}
}
function e(t){
o._initJsapiData({
curTime:t.currentTime,
bufferedPercent:t.bufferedPercent,
starTime:+new Date-1e3*t.currentTime
}),o._trigger("jsapi2Begin2Play",t);
var e=o.jsApiData,i="waiting"==t.playState||"seeked"==t.playState||"seeking"==t.playState||"play"==t.playState;
!t.paused||i?(o._onPlay(null,t),o._analogUpdateTime()):(o._onTimeupdate(null,e.curTime),
o._onPause()),o._getMusicPlayerState();
}
function i(){
s&&clearTimeout(s),n.hasCheckPlay!==!0&&(n.hasCheckPlay=!0,o._o.autoPlay&&o.play());
}
var o=this,a=this._o,n=this._g;
if(!C.inWechat||1*C._playtype>0)return n.hasCheckPlay=!0,void(o._o.autoPlay&&o.play());
var s;
S(o,t,i);
+new Date;
s=setTimeout(function(){
i();
},a.syncTimeout||1e4);
},i.prototype._fixAndroidSizeLimit=function(){
if(!(1*C._playtype>0)&&C.isAndroid){
var t=this._o;
!t.fileSize||t.fileSize>300||P.gtVersion("6.3.28",!0)||(this._trigger("androidForceH5"),
this._g._playtype=2);
}
},i.prototype._createAutoAndPlay=function(){
function t(){
function t(){
e._h5Audio.src=e._o.albumId&&e._o.playAudioId?e.getPlayAudioOpt().src:e._o.src;
}
e._trigger("h5Begin2Play"),e._h5Audio=document.createElement("audio"),e._initH5Data(!0),
e._H5bindEvent(!0),e._h5Audio.setAttribute("style","height:0;width:0;display:none"),
e._h5Audio.setAttribute("autoplay",""),e._status=0,e._onLoading(),C.isAndroidLow?(t(),
document.body.appendChild(e._h5Audio),e._h5Audio.load()):(document.body.appendChild(e._h5Audio),
setTimeout(function(){
t(),e._h5Audio.playbackRate=e._o.isAudio?C.playbackRate:1,e._h5Audio.play();
},0)),e._surportType=2;
}
var e=this;
C.inWechat?this._stopJsapiPlay(!0,function(){
t();
}):t();
},i.prototype._destoryH5Audio=function(){
this._h5Audio&&(-1!=this._status&&"function"==typeof this._h5Audio.pause&&this._h5Audio.pause(),
document.body.removeChild(this._h5Audio),this._h5Audio=null,this._status=-1);
},i.prototype._onLoading=function(t){
this._status=4;
try{
a(this);
}catch(t){}
"function"==typeof this._o.onStatusChange&&this._o.onStatusChange.call(this,t||{},this._status),
this._endCountTime();
},i.prototype._onPlay=function(){
{
var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];
arguments.length<=1||void 0===arguments[1]?{}:arguments[1];
}
this._status=1;
try{
a(this);
}catch(t){}
"function"==typeof this._o.onStatusChange&&this._o.onStatusChange.call(this,t,this._status),
this._startCountTime();
},i.prototype._onPause=function(t){
this._status=2,"function"==typeof this._o.onStatusChange&&this._o.onStatusChange.call(this,t||{},this._status),
this._endCountTime();
},i.prototype._onAlbumSync=function(t){
"function"==typeof this._o.onAlbumSync&&this._o.onAlbumSync.call(this,t||{});
},i.prototype.getAudioListState=function(t,e){
var i=function(t){
if(t&&t.audioListState){
if("string"==typeof t.audioListState)try{
t.audioListState=JSON.parse(t.audioListState);
}catch(i){
t.audioListState={};
}
A(t.playbackRate),e(t.audioListState);
}
};
this.isTingSupportType()&&1*this._o.isTingOpen===1?I.invoke("getTingAudioState",{
albumId:t
},function(t){
i(t);
}):I.invoke("getBackgroundAudioState",{
albumId:t
},function(t){
t.src&&(t.src=T(t.src,"t")),i(t);
});
},i.prototype._onEnd=function(t){
var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],o=e.audioId,a=void 0===o?"":o,n=C.autoplayAudioList[C.autoplayAudioList.length-1];
if(this._status=3,"function"==typeof this._o.onStatusChange&&this._o.onStatusChange.call(this,t||{},this._status),
this._endCountTime(),i?this.updatePlayedDuration(0):this.updatePlayedDuration(),
this._o.albumId&&1*this._o.isTingOpen!==1&&i&&n&&n.audioId===a){
var s=this.getAlbumCurAudio(),u=s.curIdx;
if(u>-1){
C.autoplayAudioList=this._o.audioList.slice(u+1,u+1+C.autoplayAudioListLen);
var r=this._o.audioList[u+1],l={
albumId:this._o.albumId+"",
playAudioId:r.audioId,
audioList:C.autoplayAudioList
};
I.invoke("setBackgroundAudioState",l);
}
}
},i.prototype._onLoadedmetadata=function(t){
"function"==typeof this._o.onLoadedmetadata&&this._o.onLoadedmetadata.call(this,t||{});
},i.prototype._onUpdateSeekRange=function(t){
this.surportSeekRange()&&(t=Math.max(t,0),t=Math.min(t,100),"function"==typeof this._o.onUpdateSeekRange&&this._o.onUpdateSeekRange.call(this,t));
},i.prototype._onTimeupdate=function(t,e,i){
"function"!=typeof this._o.onTimeupdate||i||this._o.onTimeupdate.call(this,t||{},e),
e>0&&this._startCountTime();
},i.prototype._onError=function(t,e){
this._status=-1,"function"==typeof this._o.onError&&this._o.onError.call(this,t||{},e);
},i.prototype._initH5Event=function(){
var t=this,e=this._o,i=this._g;
if(!t._g.hasInitH5Event){
t._g.hasInitH5Event=!0;
var o=i.h5Event;
o.canplaythrough=function(e){
t._h5Audio&&(!!C.debug&&console.log("h5 canplaythrough"),t._h5Data.firstCanplaythrough=!0,
t._onPlay(e),t._onUpdateSeekRange(t._h5Data.downloadDuration||0));
},o.play=function(e){
t._h5Audio&&(!!C.debug&&console.log("h5 "+e.type),t._h5Data.firstCanplaythrough===!0&&(t._onPlay(e),
t._onUpdateSeekRange(t._h5Data.downloadDuration||0)));
},o.ended=function(e){
t._h5Audio&&(!!C.debug&&console.log("h5 ended"),t._onUpdateSeekRange(t._h5Data.downloadDuration),
t._onEnd(e));
},o.pause=function(e){
t._h5Audio&&(!!C.debug&&console.log("h5 pause"),t._o.allowPause!==!0||0==t._h5Audio.currentTime?t._onEnd(e):t._onPause(e));
},o.waiting=function(e){
t._h5Audio&&(!!C.debug&&console.log("h5 "+e.type),(1==t._status||2==t._status||4==t._status)&&t._onLoading(e));
};
var a,n=100;
o.seeking=function(e){
t._h5Audio&&(!!C.debug&&console.log("h5 "+e.type),(1==t._status||2==t._status||4==t._status)&&t._onLoading(e),
a=setTimeout(function(){
!!C.debug&&console.log("seek loading Timeout excute"),a=null,t._trigger("seekNeed2Load");
},n));
},o.seeked=function(e){
t._h5Audio&&(!!C.debug&&console.log("h5 seeked"),(1==t._status||2==t._status||4==t._status)&&(t._onPlay(e),
t._h5Audio.play()),a&&(clearTimeout(a),a=null,t._trigger("seekNotNeed2Load")));
},o.error=function(e){
var i=1*e.target.error.code||5;
(1>i||i>5)&&(i=5),t._trigger("h5Error",{
code:i
}),t._onError(e,{
type:1,
code:i
}),t._destoryH5Audio();
},o.timeupdate=function(i){
t._h5Audio&&((1==t._status||4==t._status)&&t._onUpdateSeekRange(t._getH5DownloadDuration()),
1==t._status&&t._onTimeupdate(i,t._h5Audio.currentTime),"undefined"!=typeof e.duration&&1*e.duration>0&&t._h5Audio.currentTime>=e.duration&&t._h5Stop());
},o.loadedmetadata=function(e){
t._h5Audio&&t._onLoadedmetadata(e);
};
}
},i.prototype._H5bindEvent=function(t){
var e=(this._o,this._g),i={
canplaythrough:"canplaythrough",
play:"play",
playing:"play",
ended:"ended",
pause:"pause",
seeking:"seeking",
waiting:"waiting",
seeked:"seeked",
error:"error"
};
try{
for(var o in i)i.hasOwnProperty(o)&&this._h5Audio.removeEventListener(o,e.h5Event[i[o]]);
this._h5Audio.removeEventListener("timeupdate",e.h5Event.timeupdate),this._h5Audio.removeEventListener("loadedmetadata",e.h5Event.loadedmetadata);
}catch(a){}
if(t){
for(var o in i)i.hasOwnProperty(o)&&this._h5Audio.addEventListener(o,e.h5Event[i[o]],!1);
"function"==typeof this._o.onTimeupdate&&this._h5Audio.addEventListener("timeupdate",e.h5Event.timeupdate,!1),
"function"==typeof this._o.onLoadedmetadata&&this._h5Audio.addEventListener("loadedmetadata",e.h5Event.loadedmetadata,!1);
}
},i.prototype._initData=function(){
var t=this._o;
this._createMutexKey(),C.mutexPlayers[this._g.mutexKey]?C.mutexPlayers[this._g.mutexKey].push(this):C.mutexPlayers[this._g.mutexKey]=[this],
t.jsapi2Src&&t.jsapi2Src!=t.src&&(C.mutexPlayers2[t.jsapi2Src]?C.mutexPlayers2[t.jsapi2Src].push(this):C.mutexPlayers2[t.jsapi2Src]=[this]),
this._initH5Event();
},i.prototype._createMutexKey=function(){
if(this._o.albumId)this._g.mutexKey=this._o.albumId,this._g.jsapiSrcId=C.wxtag+"_"+this._o.wxIndex;else{
var t=this._o.mid||"";
this._o.src?(this._g.mutexKey=this._o.src,this._g.jsapiSrcId=C.wxtag+"_"+this._o.wxIndex):(this._g.mutexKey=d(t),
this._g.jsapiSrcId=this._g.mutexKey+"_"+this._o.wxIndex);
}
},i.prototype._extend=function(t){
for(var e in t)this._o[e]=t[e];
},i.prototype._initH5Data=function(t){
this._h5Data={
firstCanplaythrough:t===!0?!1:!0,
downloadDuration:0,
lastPlaytime:null
};
},i.prototype._initJsapiData=function(t){
t=t||{},this.jsApiData&&(this.jsApiData.updateTimeoutId&&clearTimeout(this.jsApiData.updateTimeoutId),
this.jsApiData.getStatusId&&clearTimeout(this.jsApiData.getStatusId)),this.jsApiData={
getStatusId:null,
getStatusTime:t.getStatusTime||2500,
updateTimeoutId:null,
seeking:!1,
starTime:t.starTime||+new Date,
curTime:t.curTime||0,
bufferedPercent:t.bufferedPercent||0,
duration:this._o.duration||t.duration||void 0,
lastPlaytime:null,
albumId:"",
audioId:""
};
},i.prototype._getMusicPlayerState=function(){
var t=this,e=t._o,i=t.jsApiData;
i&&i.getStatusId&&clearTimeout(i.getStatusId),t._jsapi_getMusicPlayerState({
onSuccess:function(o){
if(o&&o.audioListState&&"string"==typeof o.audioListState)try{
o.audioListState=JSON.parse(o.audioListState),o.albumId=o.audioListState.albumId;
}catch(a){
o.audioListState={};
}
(o.albumId&&o.albumId===e.albumId||o.src==e.jsapi2Src||o.src==e.src)&&(i.curTime=o.currentTime,
i.starTime=+new Date-1e3*o.currentTime,i.bufferedPercent=o.bufferedPercent,i.albumId=o.albumId||"",
i.audioId=o.audioId||"",(1==t._status||2==t._status||4==t._status)&&(i.getStatusId=setTimeout(function(){
t._getMusicPlayerState();
},i.getStatusTime)),t._onUpdateSeekRange(i.bufferedPercent),A(o.playbackRate),1==o.paused&&1==t._status?(C.debug&&console.log("_getMusicPlayerState force syn"),
t._pauseJsapiPlay(!1)):0==o.paused&&2==t._status&&(C.debug&&console.log("_getMusicPlayerState force syn"),
t._resumeJsapiPlay(!1))),t._o.onMusicPlayerInfo&&t._o.onMusicPlayerInfo(o);
},
onError:function(){
i.getStatusId=setTimeout(function(){
t._getMusicPlayerState();
},i.getStatusTime);
}
});
},i.prototype._analogUpdateTime=function(t){
var e=this,i=e.jsApiData;
if(i){
if(i.updateTimeoutId&&clearTimeout(i.updateTimeoutId),1==e._status||2==e._status){
if(1==e._status&&(i.curTime=1*((+new Date-i.starTime)/1e3).toFixed(2)),i.curTime>=i.duration)return e._stopJsapiPlay(!1),
!0;
e._onTimeupdate(null,i.curTime,t);
}
return i.updateTimeoutId=setTimeout(function(){
e._analogUpdateTime();
},1e3),!1;
}
},i.prototype._jsapi_getMusicPlayerState=function(t){
var e=this,i=e._o,o=function(e){
if(!!C.debug&&console.log("getBackgroundAudioState log: "+JSON.stringify(e||{})),
/:ok$/.test(e.err_msg)){
if(e.paused=1*e.paused,e.currentTime=e.currentTime?(1*e.currentTime).toFixed(2):0,
e.buffered){
var o=Math.floor(e.buffered/i.duration*100);
o=Math.max(o,0),o=Math.min(o,100),e.bufferedPercent=o;
}else e.bufferedPercent=0;
"function"==typeof t.onSuccess&&t.onSuccess(e);
}else"function"==typeof t.onError&&t.onError(e);
};
e.isTingSupportType()&&1*i.isTingOpen===1?I.invoke("getTingAudioState",{},function(t){
o(t);
}):I.invoke("getBackgroundAudioState",{},function(t){
t.src&&(t.src=T(t.src,"t")),o(t);
});
},i.prototype._jsapi_musicPlay=function(t){
if(this._h5Audio&&this._destoryH5Audio(),2==C._playtype)return void("function"==typeof t.onError&&t.onError({}));
var e=this,i=this._o;
this.jsapiLog("jsapi_musicPlay"),I.invoke("musicPlay",{
app_id:"a",
title:i.title,
singer:i.singer,
epname:i.epname,
coverImgUrl:i.coverImgUrl,
dataUrl:i.src,
lowbandUrl:i.src,
webUrl:i.webUrl
},function(o){
!!C.debug&&console.log("playlog:"+JSON.stringify(o||{})),o.err_msg.indexOf("ok")>=0?(e._trigger("jsapi1Begin2Play"),
e._surportType=1,C.surportType=1,e._initJsapiData(),e._onPlay(),"undefined"!=typeof i.duration&&1*i.duration>0&&e._analogUpdateTime(),
e._onUpdateSeekRange(0),"function"==typeof t.onSuccess&&t.onSuccess(o)):"function"==typeof t.onError&&t.onError(o);
});
},i.prototype._jsapi_setBackgroundAudioState=function(){
var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];
this._h5Audio&&this._destoryH5Audio(),!!C.debug&&console.log("_playtype",C._playtype);
var e=t.onSuccess,i=t.onError,o=t.needStartMusicUI,a=t.playAudioId,n=t.playbackRate,s=t.startTime,u=void 0===s?0:s;
if("function"!=typeof e&&(e=function(){}),"function"!=typeof i&&(i=function(){}),
1*C._playtype>0){
var r={};
return r.err_code=1,void i(r);
}
var l=this,d=l._o,p=l._g;
!!C.debug&&console.log("invoke set setBackgroundAudioState with param",d),this.jsapiLog("jsapi_setBackgroundAudioState"),
n&&A(n);
var c=void 0,h=void 0;
if(d.albumId){
l.setPlayAudioId(a),d.audioList.forEach(function(t){
t.audioId===a?(t.stopTime>=0&&t.stopTime<t.duration&&(t.startTime=t.stopTime),t.stopTime>=t.duration&&(t.startTime=0)):t.startTime=0,
t.isaac&&(t.src=j.addParam(t.src,"voice_type",1,!0)),t.playbackRate=C.playbackRate;
});
var y=l.getAlbumCurAudio(),_=y.curIdx,g=y.curAudio;
C.autoplayAudioList=_>-1?d.audioList.slice(_,_+C.autoplayAudioListLen):[],c={
albumId:d.albumId,
playAudioId:a,
audioList:C.autoplayAudioList
},h=_extends({},c,{
audioList:C.autoplayAudioList.map(function(t){
return t.singer.endsWith("的语音")&&(t.singer=t.singer.substring(0,t.singer.length-3)),
t.coverImgUrl=t.articleCoverCdnUrl1_1?t.articleCoverCdnUrl1_1:t.coverImgUrl,t;
}),
albumName:d.albumInfo.albumName,
albumUrl:d.albumInfo.albumUrl,
username:d.userName||"",
extInfo:JSON.stringify(g?g.tingExtInfo:{}),
playbackRate:d.isAudio?C.playbackRate:1
});
}else c={
protocol:d.protocal||"",
src:function(){
var t=window.clientversion;
return t&&(t>"18000e00"&&"18000e2d">=t||t>"18000f00"&&"18000f24">=t)?(d.jsapi2Src||d.src)+"&t="+Date.now():d.jsapi2Src||d.src;
}(),
lowbandUrl:d.jsapi2Src||d.src,
title:d.title,
epname:d.epname,
singer:d.singer,
srcId:p.jsapiSrcId,
coverImgUrl:d.coverImgUrl,
webUrl:d.webUrl,
musicbar_url:d.musicbar_url||"",
needStartMusicUI:1*o>0?1:0,
playbackRate:d.isAudio?C.playbackRate:1,
startTime:u
},h={
audioList:[_extends({},c,{
audioId:p.jsapiSrcId,
singer:d.singer.endsWith("的语音")?d.singer.substring(0,d.singer.length-3):d.singer,
coverImgUrl:d.articleCoverCdnUrl1_1?d.articleCoverCdnUrl1_1:d.coverImgUrl
})],
albumId:d.albumInfo.albumId+"",
albumName:d.albumInfo.albumName,
albumUrl:d.albumInfo.albumUrl,
username:d.userName||"",
extInfo:JSON.stringify(d.tingExtInfo||{}),
playbackRate:d.isAudio?C.playbackRate:1
};
var f=function(t){
if(!!C.debug&&console.log("setBackgroundAudioState log: "+JSON.stringify(t||{})),
t.err_msg.indexOf("ok")>=0){
var a=1*l._status;
!o||1!==a&&2!==a&&4!==a?(e("waiting"),p.stateChangeCallback.play=function(t,o){
0==t?e("play"):0!==t&&i({
err_code:2,
err_msg:o||""
});
}):e();
}else t=t||{},t.err_code=1,i(t);
};
l.isTingSupportType()&&1*d.isTingOpen===1?I.invoke("setTingAudioState",h,function(t){
f(t);
}):I.invoke("setBackgroundAudioState",c,function(t){
f(t);
});
},i.prototype._jsapi_operateBackgroundAudio=function(t){
var e=this,i=e._o,o=e._g,a=1*t.position||0,n=t.type;
this.jsapiLog("jsapi_operateBackgroundAudio;param:"+JSON.stringify(t||{}));
var s={
operationType:n,
currentTime:a
},u=e.getAlbumCurAudio(),r=u.curIdx,l=u.curAudio,d=_extends({},s,{
audioId:i.albumId?i.playAudioId:o.jsapiSrcId,
albumId:i.albumInfo.albumId+"",
src:r>-1?l.jsapi2Src||l.src:i.jsapi2Src||i.src,
extInfo:JSON.stringify(r>-1?l.tingExtInfo:i.tingExtInfo)
}),p=function(e){
!!C.debug&&console.log("operateBackgroundAudio "+n+", position: "+a+", log: "+JSON.stringify(e||{})),
-1===e.err_msg.indexOf("ok")&&("function"==typeof t.onError&&t.onError(e),"seek"===n?(o.stateChangeCallback.seeking=null,
o.stateChangeCallback.seeked=null):o.stateChangeCallback[n]=null);
};
e.isTingSupportType()&&1*i.isTingOpen===1?I.invoke("operateTingAudio",d,function(t){
!!C.debug&&console.log("operateTingAudio log: params: "+JSON.stringify(d||{})+", res: "+JSON.stringify(t||{})),
p(t);
}):I.invoke("operateBackgroundAudio",s,function(t){
p(t);
}),"seek"==n?(o.stateChangeCallback.seeking=function(e,i){
0==e&&"function"==typeof t.onSuccess?t.onSuccess("seeking",a):0!=e&&"function"==typeof t.onError&&t.onError({
err_msg:i||""
});
},o.stateChangeCallback.seeked=function(e,i){
0==e&&"function"==typeof t.onSuccess?t.onSuccess("seeked",a):0!=e&&"function"==typeof t.onError&&t.onError({
err_msg:i||""
});
}):o.stateChangeCallback[n]=function(e,i){
0==e&&"function"==typeof t.onSuccess?t.onSuccess():0!=e&&"function"==typeof t.onError&&t.onError({
err_msg:i||""
});
};
},i.prototype._jsapiPlay=function(){
var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=this,i=(this._o,
this._g);
!!C.debug&&console.log("supporttype",C.surportType);
var o=t.onError,a=t.onSuccess,n=t.needStartMusicUI,s=t.playAudioId,u=t.playbackRate,r=t.startTime,l=t.isDoubleSpeed;
"function"!=typeof o&&(o=function(){}),"function"!=typeof a&&(a=function(){}),1==C.surportType?n?o():this._jsapi_musicPlay({
onError:function(){
e._h5Play({
playAudioId:s
});
}
}):this._jsapi_setBackgroundAudioState({
playAudioId:s,
needStartMusicUI:n,
playbackRate:u,
startTime:r||i.hasPlayedDuration,
onSuccess:function(t){
!!C.debug&&console.log("----- "+t+" -----"),"waiting"===t?(e._trigger("jsapi2Begin2Play",t),
e._initJsapiData(),e._surportType=3,C.surportType=3,e._onLoading()):"play"===t&&(e._initJsapiData(),
e._onPlay(),e._analogUpdateTime(!!l),e._getMusicPlayerState(),e._trigger("jsapi2PlaySuccess")),
"function"==typeof a&&(a(),a=null,o=null);
},
onError:function(t){
t&&1==t.err_code&&!n?e._jsapi_musicPlay({
onError:function(){
e._h5Play({
playAudioId:s
});
}
}):(n||e._h5Play({
playAudioId:s
}),e._trigger("jsapi2Begin2PlayErr")),"function"==typeof o&&(o(),o=null,a=null);
}
});
},i.prototype._getJsapiDownloadSec=function(){
this._getMusicPlayerState();
var t=Math.floor(this._o.duration*this.jsApiData.bufferedPercent/100);
return!!C.debug&&console.log("downloadSec:"+t),t;
},i.prototype._jsapiSeek=function(t){
function e(){
a.seeking=!1,i._onPlay(),a.starTime=+new Date-1e3*C.seekingPosition,i._analogUpdateTime(),
i._getMusicPlayerState();
}
var i=this,o=this._g,a=(this._o,this.jsApiData),n=parseInt(t,10);
this._o.duration&&n>=this._o.duration&&(n=this._o.duration-1),a.getStatusId&&clearTimeout(a.getStatusId),
a.updateTimeoutId&&clearTimeout(a.updateTimeoutId),a.seekWaitId&&clearTimeout(a.seekWaitId),
a.seeking=!0;
var s,u,r=100;
C.seekingPosition=n,a.starTime=+new Date-1e3*C.seekingPosition,!!C.debug&&console.log("begin to seek to",n),
this._jsapi_operateBackgroundAudio({
type:"seek",
position:n,
onError:function(){
i._trigger("seekErr"),!!C.debug&&console.log("seek callback fail"),a.seeking=!1,
i._analogUpdateTime(),i._getMusicPlayerState();
},
onSuccess:function(t){
!!C.debug&&console.log("jsapi seek res is ",t),"seeking"==t?(!!C.debug&&console.log("seeking callback success"),
a.seeking=!0,o.stateChangeCallback.play=function(){
!!C.debug&&console.log("seeked to play"),s&&(clearTimeout(s),s=null),e();
},u=setTimeout(function(){
u=null,i._trigger("seekNeed2Load");
},r)):"seeked"==t&&((2==i._status||4==i._status)&&(s=setTimeout(function(){
!!C.debug&&console.log("setTimeout to play"),o.stateChangeCallback.play=null,a.seeking=!1,
a.curTime=n,i._resumeJsapiPlay(!0);
},1e3)),u&&(clearTimeout(u),u=null,i._trigger("seekNotNeed2Load")));
}
}),i._getMusicPlayerState();
},i.prototype._resumeJsapiPlay=function(t,e){
function i(t){
var e=o.jsApiData;
e.starTime=+new Date-1e3*e.curTime,o._onPlay(),o._analogUpdateTime(),o._getMusicPlayerState(),
"function"==typeof t&&t();
}
var o=this;
1==this._surportType?this._jsapiPlay():3==this._surportType&&(t?this._jsapi_operateBackgroundAudio({
type:"play",
onError:function(){
o._stopJsapiPlay(!1,function(){
o.play();
});
},
onSuccess:function(){
i(e);
}
}):i(e));
},i.prototype._pauseJsapiPlay=function(t,e,i){
function o(t){
var e=a.jsApiData;
a._analogUpdateTime(),a._getMusicPlayerState(),e&&(e.updateTimeoutId=null),t===!0&&e&&e.getStatusId&&clearTimeout(e.getStatusId),
1==a._status&&a._onPause();
}
var a=this;
return 2==a._status?(o(e),void("function"==typeof i&&i())):void(1==this._surportType?this._stopJsapiPlay(t,i):3==this._surportType&&(t?this._jsapi_operateBackgroundAudio({
type:"pause",
onSuccess:function(){
o(e),"function"==typeof i&&i();
},
onError:function(){
a._stopJsapiPlay(!0,i);
}
}):(o(e),"function"==typeof i&&i())));
},i.prototype._stopJsapiPlay=function(t,e,i,a){
function n(t,e){
s._onTimeupdate(null,0),s._onUpdateSeekRange(0),s._onEnd(null,e,a),s._initJsapiData(),
"function"==typeof t&&t();
}
{
var s=this;
s.jsApiData;
}
t?1==s._surportType?o(function(){
n(e);
}):s._jsapi_operateBackgroundAudio({
type:"stop",
onSuccess:function(){
n(e,i);
},
onError:function(){
n(e,i);
}
}):n(e,i);
},i.prototype._getH5DownloadSec=function(){
var t=Math.floor(this._o.duration*this._getH5DownloadDuration()/100);
return!!C.debug&&console.log("h5 downloadSec:"+t),t;
},i.prototype._getH5DownloadDuration=function(){
if(!this._h5Audio)return 0;
if(this._h5Data.downloadDuration>=100)return 100;
var t=this._h5Audio.buffered,e=t.end(t.length-1);
return this._h5Data.downloadDuration=this._o.albumId&&this._o.playAudioId?parseInt(e/this.getPlayAudioOpt().duration*100,10):parseInt(e/this._o.duration*100,10),
this._h5Data.downloadDuration;
},i.prototype._h5Play=function(t){
0!==C.surportType&&(this.jsapiLog("h5Play"),this.setPlayAudioId(t.playAudioId),this._h5Audio?(this._h5Audio.ended||this._h5Audio.paused)&&(this._trigger("h5Begin2Play"),
this._initH5Data(),this._onLoading(),this._H5bindEvent(!0),this._h5Audio.currentTime=0):this._createAutoAndPlay());
},i.prototype._h5Resume=function(){
this._h5Audio&&(this._h5Audio.playbackRate=C.playbackRate,this._h5Audio.play());
},i.prototype._h5Stop=function(){
this._h5Audio&&(this._onUpdateSeekRange(0),this._onEnd(),this._H5bindEvent(!1),this._h5Audio.pause(),
this._h5Audio.currentTime=0,this._initH5Data());
},i.prototype._h5Seek=function(t){
if(this._h5Audio){
var e=(this._h5Data,parseInt(t,10));
e=Math.max(e,0),e=Math.min(e,this._o.duration),!!C.debug&&console.log("h5 seek position:"+e),
this._h5Audio.currentTime=e;
}
},i.prototype._h5SetVolume=function(t){
var e=this;
e._h5Audio&&t&&(t=Math.min(1,t),t=Math.max(0,t),e._h5Audio.volume=t);
},i.prototype._startCountTime=function(){
1!=this._surportType&&3!=this._surportType||!this.jsApiData?this._h5Audio&&this._h5Data&&null===this._h5Data.lastPlaytime&&(this._h5Data.lastPlaytime=this._h5Audio.currentTime):null===this.jsApiData.lastPlaytime&&(this.jsApiData.lastPlaytime=this.jsApiData.curTime);
},i.prototype._endCountTime=function(){
if(1!=this._surportType&&3!=this._surportType||!this.jsApiData){
if(this._h5Audio&&this._h5Data){
var t=this._h5Audio,e=this._h5Data;
t.currentTime>0&&t.currentTime>e.lastPlaytime&&null!==e.lastPlaytime&&(this._g.totalPlayTime+=t.currentTime-e.lastPlaytime),
e.lastPlaytime=null;
}
}else{
var i=this.jsApiData;
i.curTime>0&&i.curTime>i.lastPlaytime&&null!==i.lastPlaytime&&(this._g.totalPlayTime+=i.curTime-i.lastPlaytime),
i.lastPlaytime=null;
}
},i.prototype._delMutexPlayers=function(){
var t=this._o,e=this._g.mutexKey,i=C.mutexPlayers[e];
if(i){
for(var o=0,a=i.length;a>o;o++)if(i[o]===this){
i.splice(o,1);
break;
}
if(0==i.length)try{
delete C.mutexPlayers[e];
}catch(n){}
}
if(t.jsapi2Src&&C.mutexPlayers2[t.jsapi2Src]){
for(var s=C.mutexPlayers2[t.jsapi2Src],o=0,a=s.length;a>o;o++)if(s[o]===this){
s.splice(o,1);
break;
}
if(0==s.length)try{
delete C.mutexPlayers2[t.jsapi2Src];
}catch(n){}
}
},i.prototype.resetPlayTotalTime=function(){
this._g.totalPlayTime=0;
},i.prototype.getPlayTotalTime=function(){
return this._endCountTime(),this._g.totalPlayTime;
},i.prototype.surportSeekRange=function(){
return 1==C._playtype?!1:2==this._surportType||3==this._surportType?!0:!1;
},i.prototype.setSrc=function(t){
-1==t.indexOf("?")&&(t+="?"),t+=d(this._o.mid),this._o.src=t,this._delMutexPlayers(),
this._g.mutexKey=this._o.src,C.mutexPlayers[this._g.mutexKey]?C.mutexPlayers[this._g.mutexKey].push(this):C.mutexPlayers[this._g.mutexKey]=[this];
},i.prototype.getSrc=function(){
return this._o.src||"";
},i.prototype.setDuration=function(t){
this._o.duration=t||0;
},i.prototype.getSurportType=function(){
return this._surportType||0;
},i.prototype.getPlayStatus=function(){
return this._status;
},i.prototype.getCurTime=function(){
return 1!=this._surportType&&3!=this._surportType||!this.jsApiData?this._h5Audio?this._h5Audio.currentTime:0:this.jsApiData.curTime||0;
},i.prototype.getDuration=function(){
return this._o.duration||void 0;
},i.prototype.pause=function(t,e,i){
return i===!0||this._o.allowPause?void(1==this._surportType||3==this._surportType?this._pauseJsapiPlay(t===!1?!1:!0,!1,function(){
"function"==typeof e&&e();
},function(){
"function"==typeof e&&e();
}):2==this._surportType&&this._h5Audio&&"function"==typeof this._h5Audio.pause&&(this._h5Audio.pause(),
"function"==typeof e&&e())):void this.stop(t,e);
},i.prototype.stop=function(t,e,i,o){
return 1==this._surportType||3==this._surportType?void this._stopJsapiPlay(t===!1?!1:!0,e,i,o):(2==this._surportType&&this._h5Audio&&this._h5Stop(),
void("function"==typeof e&&e()));
},i.prototype.destory=function(){
this.stop(),this._h5Audio&&(document.body.removeChild(this._h5Audio),this._h5Audio=null),
this._delMutexPlayers();
},i.prototype.resume=function(t,e,i){
(i===!0||2==this._status&&this._o.allowPause)&&(2==this._surportType&&this._h5Audio?this._h5Resume():C.inWechat&&this._resumeJsapiPlay(t===!1?!1:!0));
},i.prototype.onload=function(){
this._onLoading();
},i.prototype.jsapiLog=function(t,e){
try{
var i=this._o,o={
type:i.type,
src:i.src,
mid:i.mid,
protocal:i.protocal,
webUrl:i.webUrl,
musicbar_url:i.musicbar_url
},a="["+JSON.stringify(o)+"]"+t;
p(a,e);
}catch(n){}
},i.prototype.openStartMusicUI=function(){
var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=t.onError,i=t.onSuccess;
"function"!=typeof e&&(e=function(){}),"function"!=typeof i&&(i=function(){}),P.isWechat&&(P.isIOS||P.isAndroid)&&P.gtVersion("7.0.5",!0)?this._jsapiPlay({
needStartMusicUI:!0,
onError:function(){
e();
},
onSuccess:function(){
i();
}
}):e();
},i.prototype.play=function(){
var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=this,i=this._g,o=t.playAudioId;
if(e._o.src||e._o.albumId){
if(2==e._status&&e._o.allowPause){
if(e._o.src)return void e.resume();
if(e._o.playAudioId&&e._o.playAudioId===o)return void e.resume();
}
return i.playTimeoutId&&clearTimeout(i.playTimeoutId),i.hasCheckPlay?void(C.inWechat?this._jsapiPlay({
playAudioId:o
}):0!=C.surportType&&this._h5Play({
playAudioId:o
})):void(i.playTimeoutId=setTimeout(function(){
e.play();
},1e3));
}
},i.prototype.seek=function(t){
{
var e=this;
this._g;
}
if(1==e._status||2==e._status||4==e._status)return 3==this._surportType?(this._endCountTime(),
void this._jsapiSeek(t)):2==this._surportType&&this._h5Audio?(this._endCountTime(),
void this._h5Seek(t)):void 0;
},i.prototype.getBackgroundAudioState=function(){
var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=function(e){
!!C.debug&&console.log("getBackgroundAudioState log: "+JSON.stringify(e||{})),/:ok$/.test(e.err_msg)?(e.paused=1*e.paused,
"function"==typeof t.success&&t.success(e)):"function"==typeof t.error&&t.error(e);
};
this.isTingSupportType()&&1*this._o.isTingOpen===1?I.invoke("getTingAudioState",{},function(t){
e(t);
}):I.invoke("getBackgroundAudioState",{},function(t){
t.src&&(t.src=T(t.src,"t")),e(t);
});
},i.prototype.setOption=function(t){
this._extend(t),t.duration&&this.jsApiData&&(this.jsApiData.duration=t.duration);
},i.prototype.reverseList=function(t){
this._o.audioList.reverse(),this.update(t);
},i.prototype.update=function(t){
if(1===this._status||4===this._status){
var e=this,i=e._o,o=e.getAlbumCurAudio(),a=o.curIdx,n=o.curAudio,s=i.playAudioId,u={};
this._o.audioList.forEach(function(e){
e.startTime=t&&s&&e.audioId===s?t:0;
}),a>-1?(C.autoplayAudioList=this._o.audioList.slice(a,a+C.autoplayAudioListLen),
u=n.tingExtInfo):C.autoplayAudioList=[];
var r={
albumId:this._o.albumId+"",
playAudioId:this._o.playAudioId||this.jsApiData.audioId,
audioList:C.autoplayAudioList
};
e.isTingSupportType()&&1*i.isTingOpen===1?I.invoke("setTingAudioState",_extends({},r,{
albumName:i.albumInfo.albumName,
albumUrl:i.albumInfo.albumUrl,
username:i.userName,
extInfo:JSON.stringify(u),
playbackRate:i.isAudio?C.playbackRate:1
}),function(){}):I.invoke("setBackgroundAudioState",r,function(){});
}
},i.prototype.getPlayAudioOpt=function(t){
if(t=t||this._o.playAudioId,!t)return null;
for(var e=0;e<this._o.audioList.length;e++)if(this._o.audioList[e].audioId===t)return this._o.audioList[e];
},i.prototype.getPlayAudioId=function(){
return this._o.playAudioId;
},i.prototype.setPlayAudioId=function(t){
this._o.playAudioId=t;
},i.prototype.doubleSpeed=function(t){
var e=t.succCallback,i=t.pcCallback,o=this,a=o._o.speedList;
C.inWechat?o.getBackgroundAudioState({
success:function(t){
var i=t.playbackRate,n=t.currentTime,s=a.findIndex(function(t){
return t===+i;
}),u=a[(s+1)%a.length];
o._jsapiPlay({
isDoubleSpeed:!0,
playbackRate:u,
startTime:+n,
onSuccess:function(){
C.isAndroid&&o.seek(+n),e();
}
});
}
}):!function(){
var t=o._h5Audio.playbackRate,n=a.findIndex(function(e){
return e===+t;
}),s=a[(n+1)%a.length];
A(s),o._h5Audio.playbackRate=s,o._h5Audio.play(),i(),e();
}();
},i.prototype.updatePlayedDuration=function(t){
return"undefined"!=typeof t?void(this._g.hasPlayedDuration=t):void(this._g.hasPlayedDuration=this.getCurTime());
},i.prototype.isTingSupportType=function(){
var t=this._o.type;
return 2===t||3===t||4===t||10===t;
},i.prototype.getCurVol=function(){
return this._h5Audio?this._h5Audio.volume:0;
},i.prototype._synSpeedList=function(){
var t=this;
t.isTingSupportType()&&I.invoke("getTingAudioState",{},function(e){
/:ok$/.test(e.err_msg)&&"array"==typeof e.playRateList&&(t._o.speedList=e.playRateList);
});
},i.prototype.getAlbumCurAudio=function(){
var t=this,e=t._o;
if(e.albumId&&e.audioList){
var i=e.audioList.findIndex(function(e){
return e.audioId===t.getPlayAudioId();
});
if(i>-1)return{
curIdx:i,
curAudio:e.audioList[i]
};
}
return{
curIdx:-1,
curAudio:null
};
},{
isAndroid:C.isAndroid,
init:u,
triggerUnloadPlaying:m,
getSurportType:s,
getQuery:v,
getPlaybackRate:b
};
});define("biz_wap/zepto/zepto.js",[],function(){
"use strict";
var t=function(){
function t(t){
return null==t?String(t):J[W.call(t)]||"object";
}
function n(n){
return"function"==t(n);
}
function e(t){
return null!=t&&t==t.window;
}
function i(t){
return null!=t&&t.nodeType==t.DOCUMENT_NODE;
}
function r(n){
return"object"==t(n);
}
function o(t){
return r(t)&&!e(t)&&Object.getPrototypeOf(t)==Object.prototype;
}
function s(t){
return t instanceof Array;
}
function u(t){
return"number"==typeof t.length;
}
function c(t){
return P.call(t,function(t){
return null!=t;
});
}
function a(t){
return t.length>0?C.fn.concat.apply([],t):t;
}
function l(t){
return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase();
}
function f(t){
return t in M?M[t]:M[t]=new RegExp("(^|\\s)"+t+"(\\s|$)");
}
function h(t,n){
return"number"!=typeof n||z[l(t)]?n:n+"px";
}
function p(t){
var n,e;
return j[t]||(n=L.createElement(t),L.body.appendChild(n),e=getComputedStyle(n,"").getPropertyValue("display"),
n.parentNode.removeChild(n),"none"==e&&(e="block"),j[t]=e),j[t];
}
function d(t){
return"children"in t?$.call(t.children):C.map(t.childNodes,function(t){
return 1==t.nodeType?t:void 0;
});
}
function g(t,n,e){
for(E in n)e&&(o(n[E])||s(n[E]))?(o(n[E])&&!o(t[E])&&(t[E]={}),s(n[E])&&!s(t[E])&&(t[E]=[]),
g(t[E],n[E],e)):n[E]!==x&&(t[E]=n[E]);
}
function m(t,n){
return null==n?C(t):C(t).filter(n);
}
function v(t,e,i,r){
return n(e)?e.call(t,i,r):e;
}
function y(t,n,e){
null==e?t.removeAttribute(n):t.setAttribute(n,e);
}
function b(t,n){
var e=t.className,i=e&&e.baseVal!==x;
return n===x?i?e.baseVal:e:void(i?e.baseVal=n:t.className=n);
}
function w(t){
var n;
try{
return t?"true"==t||("false"==t?!1:"null"==t?null:/^0/.test(t)||isNaN(n=Number(t))?/^[\[\{]/.test(t)?C.parseJSON(t):t:n):t;
}catch(e){
return t;
}
}
function N(t,n){
n(t);
for(var e in t.childNodes)N(t.childNodes[e],n);
}
var x,E,C,O,T,S,A=[],$=A.slice,P=A.filter,L=window.document,j={},M={},z={
"column-count":1,
columns:1,
"font-weight":1,
"line-height":1,
opacity:1,
"z-index":1,
zoom:1
},Z=/^\s*<(\w+|!)[^>]*>/,q=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,k=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,B=/^(?:body|html)$/i,R=/([A-Z])/g,V=["val","css","html","text","data","width","height","offset"],F=["after","prepend","before","append"],H=L.createElement("table"),I=L.createElement("tr"),U={
tr:L.createElement("tbody"),
tbody:H,
thead:H,
tfoot:H,
td:I,
th:I,
"*":L.createElement("div")
},_=/complete|loaded|interactive/,D=/^[\w-]*$/,J={},W=J.toString,X={},Y=L.createElement("div"),G={
tabindex:"tabIndex",
readonly:"readOnly",
"for":"htmlFor",
"class":"className",
maxlength:"maxLength",
cellspacing:"cellSpacing",
cellpadding:"cellPadding",
rowspan:"rowSpan",
colspan:"colSpan",
usemap:"useMap",
frameborder:"frameBorder",
contenteditable:"contentEditable"
};
X.matches=function(t,n){
if(!n||!t||1!==t.nodeType)return!1;
var e=t.webkitMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector||t.matchesSelector;
if(e)return e.call(t,n);
var i,r=t.parentNode,o=!r;
return o&&(r=Y).appendChild(t),i=~X.qsa(r,n).indexOf(t),o&&Y.removeChild(t),i;
},T=function(t){
return t.replace(/-+(.)?/g,function(t,n){
return n?n.toUpperCase():"";
});
},S=function(t){
return P.call(t,function(n,e){
return t.indexOf(n)==e;
});
},X.fragment=function(t,n,e){
var i,r,s;
return q.test(t)&&(i=C(L.createElement(RegExp.$1))),i||(t.replace&&(t=t.replace(k,"<$1></$2>")),
n===x&&(n=Z.test(t)&&RegExp.$1),n in U||(n="*"),s=U[n],s.innerHTML=""+t,i=C.each($.call(s.childNodes),function(){
s.removeChild(this);
})),o(e)&&(r=C(i),C.each(e,function(t,n){
V.indexOf(t)>-1?r[t](n):r.attr(t,n);
})),i;
},X.Z=function(t,n){
t=t||[];
for(var e in C.fn)t[e]=C.fn[e];
return t.selector=n||"",t;
},X.isZ=function(t){
return t instanceof X.Z;
},X.init=function(t,e){
var i;
if(!t)return X.Z();
if("string"==typeof t)if(t=t.trim(),"<"==t[0]&&Z.test(t))i=X.fragment(t,RegExp.$1,e),
t=null;else{
if(e!==x)return C(e).find(t);
i=X.qsa(L,t);
}else{
if(n(t))return C(L).ready(t);
if(X.isZ(t))return t;
if(s(t))i=c(t);else if(r(t))i=[t],t=null;else if(Z.test(t))i=X.fragment(t.trim(),RegExp.$1,e),
t=null;else{
if(e!==x)return C(e).find(t);
i=X.qsa(L,t);
}
}
return X.Z(i,t);
},C=function(t,n){
return X.init(t,n);
},C.extend=function(t){
var n,e=$.call(arguments,1);
return"boolean"==typeof t&&(n=t,t=e.shift()),e.forEach(function(e){
g(t,e,n);
}),t;
},X.qsa=function(t,n){
var e,r="#"==n[0],o=!r&&"."==n[0],s=r||o?n.slice(1):n,u=D.test(s);
return i(t)&&u&&r?(e=t.getElementById(s))?[e]:[]:1!==t.nodeType&&9!==t.nodeType?[]:$.call(u&&!r?o?t.getElementsByClassName(s):t.getElementsByTagName(n):t.querySelectorAll(n));
},C.contains=function(t,n){
return t!==n&&t.contains(n);
},C.type=t,C.isFunction=n,C.isWindow=e,C.isArray=s,C.isPlainObject=o,C.isEmptyObject=function(t){
var n;
for(n in t)return!1;
return!0;
},C.inArray=function(t,n,e){
return A.indexOf.call(n,t,e);
},C.camelCase=T,C.trim=function(t){
return null==t?"":String.prototype.trim.call(t);
},C.uuid=0,C.support={},C.expr={},C.map=function(t,n){
var e,i,r,o=[];
if(u(t))for(i=0;i<t.length;i++)e=n(t[i],i),null!=e&&o.push(e);else for(r in t)e=n(t[r],r),
null!=e&&o.push(e);
return a(o);
},C.each=function(t,n){
var e,i;
if(u(t)){
for(e=0;e<t.length;e++)if(n.call(t[e],e,t[e])===!1)return t;
}else for(i in t)if(n.call(t[i],i,t[i])===!1)return t;
return t;
},C.grep=function(t,n){
return P.call(t,n);
},window.JSON&&(C.parseJSON=JSON.parse),C.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,n){
J["[object "+n+"]"]=n.toLowerCase();
}),C.fn={
forEach:A.forEach,
reduce:A.reduce,
push:A.push,
sort:A.sort,
indexOf:A.indexOf,
concat:A.concat,
map:function(t){
return C(C.map(this,function(n,e){
return t.call(n,e,n);
}));
},
slice:function(){
return C($.apply(this,arguments));
},
ready:function(t){
return _.test(L.readyState)&&L.body?t(C):L.addEventListener("DOMContentLoaded",function(){
t(C);
},!1),this;
},
get:function(t){
return t===x?$.call(this):this[t>=0?t:t+this.length];
},
toArray:function(){
return this.get();
},
size:function(){
return this.length;
},
remove:function(){
return this.each(function(){
null!=this.parentNode&&this.parentNode.removeChild(this);
});
},
each:function(t){
return A.every.call(this,function(n,e){
return t.call(n,e,n)!==!1;
}),this;
},
filter:function(t){
return n(t)?this.not(this.not(t)):C(P.call(this,function(n){
return X.matches(n,t);
}));
},
add:function(t,n){
return C(S(this.concat(C(t,n))));
},
is:function(t){
return this.length>0&&X.matches(this[0],t);
},
not:function(t){
var e=[];
if(n(t)&&t.call!==x)this.each(function(n){
t.call(this,n)||e.push(this);
});else{
var i="string"==typeof t?this.filter(t):u(t)&&n(t.item)?$.call(t):C(t);
this.forEach(function(t){
i.indexOf(t)<0&&e.push(t);
});
}
return C(e);
},
has:function(t){
return this.filter(function(){
return r(t)?C.contains(this,t):C(this).find(t).size();
});
},
eq:function(t){
return-1===t?this.slice(t):this.slice(t,+t+1);
},
first:function(){
var t=this[0];
return t&&!r(t)?t:C(t);
},
last:function(){
var t=this[this.length-1];
return t&&!r(t)?t:C(t);
},
find:function(t){
var n,e=this;
return n="object"==typeof t?C(t).filter(function(){
var t=this;
return A.some.call(e,function(n){
return C.contains(n,t);
});
}):1==this.length?C(X.qsa(this[0],t)):this.map(function(){
return X.qsa(this,t);
});
},
closest:function(t,n){
var e=this[0],r=!1;
for("object"==typeof t&&(r=C(t));e&&!(r?r.indexOf(e)>=0:X.matches(e,t));)e=e!==n&&!i(e)&&e.parentNode;
return C(e);
},
parents:function(t){
for(var n=[],e=this;e.length>0;)e=C.map(e,function(t){
return(t=t.parentNode)&&!i(t)&&n.indexOf(t)<0?(n.push(t),t):void 0;
});
return m(n,t);
},
parent:function(t){
return m(S(this.pluck("parentNode")),t);
},
children:function(t){
return m(this.map(function(){
return d(this);
}),t);
},
contents:function(){
return this.map(function(){
return $.call(this.childNodes);
});
},
siblings:function(t){
return m(this.map(function(t,n){
return P.call(d(n.parentNode),function(t){
return t!==n;
});
}),t);
},
empty:function(){
return this.each(function(){
this.innerHTML="";
});
},
pluck:function(t){
return C.map(this,function(n){
return n[t];
});
},
show:function(){
return this.each(function(){
"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=p(this.nodeName));
});
},
replaceWith:function(t){
return this.before(t).remove();
},
wrap:function(t){
var e=n(t);
if(this[0]&&!e)var i=C(t).get(0),r=i.parentNode||this.length>1;
return this.each(function(n){
C(this).wrapAll(e?t.call(this,n):r?i.cloneNode(!0):i);
});
},
wrapAll:function(t){
if(this[0]){
C(this[0]).before(t=C(t));
for(var n;(n=t.children()).length;)t=n.first();
C(t).append(this);
}
return this;
},
wrapInner:function(t){
var e=n(t);
return this.each(function(n){
var i=C(this),r=i.contents(),o=e?t.call(this,n):t;
r.length?r.wrapAll(o):i.append(o);
});
},
unwrap:function(){
return this.parent().each(function(){
C(this).replaceWith(C(this).children());
}),this;
},
clone:function(){
return this.map(function(){
return this.cloneNode(!0);
});
},
hide:function(){
return this.css("display","none");
},
toggle:function(t){
return this.each(function(){
var n=C(this);
(t===x?"none"==n.css("display"):t)?n.show():n.hide();
});
},
prev:function(t){
return C(this.pluck("previousElementSibling")).filter(t||"*");
},
next:function(t){
return C(this.pluck("nextElementSibling")).filter(t||"*");
},
html:function(t){
return 0===arguments.length?this.length>0?this[0].innerHTML:null:this.each(function(n){
var e=this.innerHTML;
C(this).empty().append(v(this,t,n,e));
});
},
text:function(t){
return 0===arguments.length?this.length>0?this[0].textContent:null:this.each(function(){
this.textContent=t===x?"":""+t;
});
},
attr:function(t,n){
var e;
return"string"==typeof t&&n===x?0==this.length||1!==this[0].nodeType?x:"value"==t&&"INPUT"==this[0].nodeName?this.val():!(e=this[0].getAttribute(t))&&t in this[0]?this[0][t]:e:this.each(function(e){
if(1===this.nodeType)if(r(t))for(E in t)y(this,E,t[E]);else y(this,t,v(this,n,e,this.getAttribute(t)));
});
},
removeAttr:function(t){
return this.each(function(){
1===this.nodeType&&y(this,t);
});
},
prop:function(t,n){
return t=G[t]||t,n===x?this[0]&&this[0][t]:this.each(function(e){
this[t]=v(this,n,e,this[t]);
});
},
data:function(t,n){
var e=this.attr("data-"+t.replace(R,"-$1").toLowerCase(),n);
return null!==e?w(e):x;
},
val:function(t){
return 0===arguments.length?this[0]&&(this[0].multiple?C(this[0]).find("option").filter(function(){
return this.selected;
}).pluck("value"):this[0].value):this.each(function(n){
this.value=v(this,t,n,this.value);
});
},
offset:function(t){
if(t)return this.each(function(n){
var e=C(this),i=v(this,t,n,e.offset()),r=e.offsetParent().offset(),o={
top:i.top-r.top,
left:i.left-r.left
};
"static"==e.css("position")&&(o.position="relative"),e.css(o);
});
if(0==this.length)return null;
var n=this[0].getBoundingClientRect();
return{
left:n.left+window.pageXOffset,
top:n.top+window.pageYOffset,
width:Math.round(n.width),
height:Math.round(n.height)
};
},
css:function(n,e){
if(arguments.length<2){
var i=this[0],r=getComputedStyle(i,"");
if(!i)return;
if("string"==typeof n)return i.style[T(n)]||r.getPropertyValue(n);
if(s(n)){
var o={};
return C.each(s(n)?n:[n],function(t,n){
o[n]=i.style[T(n)]||r.getPropertyValue(n);
}),o;
}
}
var u="";
if("string"==t(n))e||0===e?u=l(n)+":"+h(n,e):this.each(function(){
this.style.removeProperty(l(n));
});else for(E in n)n[E]||0===n[E]?u+=l(E)+":"+h(E,n[E])+";":this.each(function(){
this.style.removeProperty(l(E));
});
return this.each(function(){
this.style.cssText+=";"+u;
});
},
index:function(t){
return t?this.indexOf(C(t)[0]):this.parent().children().indexOf(this[0]);
},
hasClass:function(t){
return t?A.some.call(this,function(t){
return this.test(b(t));
},f(t)):!1;
},
addClass:function(t){
return t?this.each(function(n){
O=[];
var e=b(this),i=v(this,t,n,e);
i.split(/\s+/g).forEach(function(t){
C(this).hasClass(t)||O.push(t);
},this),O.length&&b(this,e+(e?" ":"")+O.join(" "));
}):this;
},
removeClass:function(t){
return this.each(function(n){
return t===x?b(this,""):(O=b(this),v(this,t,n,O).split(/\s+/g).forEach(function(t){
O=O.replace(f(t)," ");
}),void b(this,O.trim()));
});
},
toggleClass:function(t,n){
return t?this.each(function(e){
var i=C(this),r=v(this,t,e,b(this));
r.split(/\s+/g).forEach(function(t){
(n===x?!i.hasClass(t):n)?i.addClass(t):i.removeClass(t);
});
}):this;
},
scrollTop:function(t){
if(this.length){
var n="scrollTop"in this[0];
return t===x?n?this[0].scrollTop:this[0].pageYOffset:this.each(n?function(){
this.scrollTop=t;
}:function(){
this.scrollTo(this.scrollX,t);
});
}
},
scrollLeft:function(t){
if(this.length){
var n="scrollLeft"in this[0];
return t===x?n?this[0].scrollLeft:this[0].pageXOffset:this.each(n?function(){
this.scrollLeft=t;
}:function(){
this.scrollTo(t,this.scrollY);
});
}
},
position:function(){
if(this.length){
var t=this[0],n=this.offsetParent(),e=this.offset(),i=B.test(n[0].nodeName)?{
top:0,
left:0
}:n.offset();
return e.top-=parseFloat(C(t).css("margin-top"))||0,e.left-=parseFloat(C(t).css("margin-left"))||0,
i.top+=parseFloat(C(n[0]).css("border-top-width"))||0,i.left+=parseFloat(C(n[0]).css("border-left-width"))||0,
{
top:e.top-i.top,
left:e.left-i.left
};
}
},
offsetParent:function(){
return this.map(function(){
for(var t=this.offsetParent||L.body;t&&!B.test(t.nodeName)&&"static"==C(t).css("position");)t=t.offsetParent;
return t;
});
}
},C.fn.detach=C.fn.remove,["width","height"].forEach(function(t){
var n=t.replace(/./,function(t){
return t[0].toUpperCase();
});
C.fn[t]=function(r){
var o,s=this[0];
return r===x?e(s)?s["inner"+n]:i(s)?s.documentElement["scroll"+n]:(o=this.offset())&&o[t]:this.each(function(n){
s=C(this),s.css(t,v(this,r,n,s[t]()));
});
};
}),F.forEach(function(n,e){
var i=e%2;
C.fn[n]=function(){
var n,r,o=C.map(arguments,function(e){
return n=t(e),"object"==n||"array"==n||null==e?e:X.fragment(e);
}),s=this.length>1;
return o.length<1?this:this.each(function(t,n){
r=i?n:n.parentNode,n=0==e?n.nextSibling:1==e?n.firstChild:2==e?n:null,o.forEach(function(t){
if(s)t=t.cloneNode(!0);else if(!r)return C(t).remove();
N(r.insertBefore(t,n),function(t){
null==t.nodeName||"SCRIPT"!==t.nodeName.toUpperCase()||t.type&&"text/javascript"!==t.type||t.src||window.eval.call(window,t.innerHTML);
});
});
});
},C.fn[i?n+"To":"insert"+(e?"Before":"After")]=function(t){
return C(t)[n](this),this;
};
});
for(var K in C.fn)X.Z[K]=C.fn[K];
return X.uniq=S,X.deserializeValue=w,C.zepto=X,C;
}();
window.Zepto=t,void 0===window.$&&(window.$=t);
});define("pages_new/common_share/video/player/plugins/danmu/danmu_store.js",[],function(){
"use strict";
return{
name:"danmu-plugin",
namespaced:!0,
state:function(){
return{
inputStatus:0,
danmuInfo:null
};
},
mutations:{
setInputStatus:function(n,t){
n.inputStatus=t.value;
},
setDanmuInfo:function(n,t){
n.danmuInfo=t;
}
}
};
});var _extends=Object.assign||function(t){
for(var e=1;e<arguments.length;e++){
var a=arguments[e];
for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r]);
}
return t;
};
define("pages_new/common_share/video/player/player_store.js",["common/comm_report.js"],function(t){
"use strict";
var e=t("common/comm_report.js");
return{
name:"mp-video-player",
namespaced:!0,
state:function(){
return{
errType:0,
errCode:0,
errMsg:"",
status:"init",
subStatus:"init",
fullscreenStatus:0,
seekingStatus:0,
refreshBtnStatus:0,
topStickyInfoStatus:0,
loadingStatus:0,
controlBarStatus:0,
coverStatus:1,
midPlayStatus:0,
resolutionEntryStatus:0,
subSettingStatus:0,
accessPlayBtnStatus:0,
touchOprStatus:0,
likeCmtStatus:0,
orientationStatus:0,
banOprStatus:0,
progressBarMark:[],
commonReportData:{
Vid:"",
BizUin:0,
MsgId:0,
ItemIdx:0,
PlayerType:0,
Scene:0,
SubScene:0,
ItemShowType:0,
EnterId:0,
SessionId:"",
ChannelId:"",
ReloadId:"",
ReloadSeq:0,
Duration:0,
OrStatus:0,
PageUrl:"",
VideoUrl:"",
IsFans:0
},
enter23439ReportExData:{
IsContinue:0,
IsWatchMore:0,
UserDanMuFlag:0,
isDanShow:0
},
play23440ReportExData:{
DeviceModel:"",
DeviceBrand:"",
OsName:"",
OsVersion:"",
NetType:0,
ScreenHeight:0,
ScreenWidth:0,
MiaoKai:0,
PlayType:0
},
perf23442ReportExData:{
DeviceModel:"",
DeviceBrand:"",
OsName:"",
OsVersion:"",
NetType:0,
ScreenHeight:0,
ScreenWidth:0,
MiaoKai:0,
EventType:0,
EventTime:0,
PreloadType:0,
Definition:0,
VideoWidth:0,
VideoHeight:0,
BufferTime:0,
BufferType:0,
DefinitionBefore:0,
VideoWidthBefore:0,
VideoHeightBefore:0,
PlayErrType:0,
Traffic:0
},
leave23443ReportExData:{
EventType:0,
EventTime:0,
PlayTime:0,
StayTime:0,
PagePlayTime:0,
PageStayTime:0,
ImmersivePlayTime:0,
ImmersiveStayTime:0
},
op23444ReportExData:{
EventType:0,
EventTime:0,
FullscreenType:0,
PauseTime:0,
BarBefore:"",
BarAfter:"",
SpeedBefore:"",
SpeedAfter:"",
DefinitionBefore:"",
DefinitionAfter:""
},
reload23445ReportExData:{
EventType:0,
FullscreenType:0,
WatchMoreSet:0,
ContinueBreakReason:0,
RecVid:"",
RecBizUin:0,
RecMsgId:0,
RecItemIdx:0,
RecSeq:0,
RecType:0,
SortId:0,
RecInfo:""
},
ad23446ReportExData:{
EventType:0,
EventTime:0,
Location:0
}
};
},
mutations:{
setError:function(t,e){
t.errType=e.type,t.errCode=e.code,t.errMsg=e.msg,t.refreshBtnStatus=e.refresh;
},
setTopStickyInfoStatus:function(t,e){
t.topStickyInfoStatus=e.status;
},
setFullscreenStatus:function(t,e){
t.fullscreenStatus=e.status,window.__video_fullscreen__=!!e.status;
},
setSeekingStatus:function(t,e){
t.seekingStatus=e.status;
},
setStatus:function(t,e){
t.status=e.status,t.subStatus=e.subStatus;
},
setLoadingStatus:function(t,e){
t.loadingStatus=e.status;
},
setControlBarStatus:function(t,e){
t.controlBarStatus=e.status;
},
setCoverStatus:function(t,e){
t.coverStatus=e.status;
},
setMidPlayStatus:function(t,e){
t.midPlayStatus=e.status;
},
setResolutionEntryStatus:function(t,e){
t.resolutionEntryStatus=e.status;
},
setSubSettingStatus:function(t,e){
t.subSettingStatus=e.status;
},
setAccessPlayBtnStatus:function(t,e){
t.accessPlayBtnStatus=e.status;
},
setTouchOprStatus:function(t,e){
t.touchOprStatus=e.status;
},
setLikeCmtStatus:function(t,e){
t.likeCmtStatus=e.status;
},
setOrientationStatus:function(t,e){
t.orientationStatus=e.status;
},
setBanOprStatus:function(t,e){
t.banOprStatus=e.status;
},
addProgressBarMark:function(t,e){
t.progressBarMark=[].concat(t.progressBarMark,e.value);
},
removeProgressBarMark:function(t,e){
for(var a=t.progressBarMark.length-1;a>-1;a--){
var r=t.progressBarMark[a];
r.id===e.id&&t.progressBarMark.splice(a,1);
}
},
clearProgressBarMark:function(t){
t.progressBarMark=[];
},
setCommonReportData:function(t,e){
t.commonReportData=_extends({},t.commonReportData,e);
},
setEnter23439ReportExData:function(t,e){
t.enter23439ReportExData=_extends({},t.enter23439ReportExData,e);
},
setPlay23440ReportExData:function(t,e){
t.play23440ReportExData=_extends({},t.play23440ReportExData,e);
},
setPerf23442ReportExData:function(t,e){
t.perf23442ReportExData=_extends({},t.perf23442ReportExData,e);
},
setLeave23443ReportExData:function(t,e){
t.leave23443ReportExData=_extends({},t.leave23443ReportExData,e);
},
setOp23444ReportExData:function(t,e){
t.op23444ReportExData=_extends({},t.op23444ReportExData,e);
},
setReload23445ReportExData:function(t,e){
t.reload23445ReportExData=_extends({},t.reload23445ReportExData,e);
},
setAd23446ReportExData:function(t,e){
t.ad23446ReportExData=_extends({},t.ad23446ReportExData,e);
}
},
actions:{
reportEnter23439:function(t,a){
var r=t.state;
e.report(23439,_extends({},r.commonReportData,r.enter23439ReportExData,a));
},
reportPlay23440:function(t,a){
var r=t.state;
e.report(23440,_extends({},r.commonReportData,r.play23440ReportExData,a));
},
reportPerf23442:function(t,a){
var r=t.state;
e.report(23442,_extends({},r.commonReportData,r.perf23442ReportExData,a));
},
reportLeave23443:function(t,a){
var r=t.state;
e.report(23443,_extends({},r.commonReportData,r.leave23443ReportExData,a));
},
reportOp23444:function(t,a){
var r=t.state;
e.report(23444,_extends({},r.commonReportData,r.op23444ReportExData,a));
},
reportReload23445:function(t,a){
var r=t.state;
e.report(23445,_extends({},r.commonReportData,r.reload23445ReportExData,a));
},
reportAd23446:function(t,a){
var r=t.state;
e.report(23446,_extends({},r.commonReportData,r.ad23446ReportExData,a));
}
}
};
});function _toConsumableArray(t){
if(Array.isArray(t)){
for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];
return i;
}
return Array.from(t);
}
function _typeof(t){
return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t;
}
function _defineProperty(t,e,i){
return e in t?Object.defineProperty(t,e,{
value:i,
enumerable:!0,
configurable:!0,
writable:!0
}):t[e]=i,t;
}
var _extends=Object.assign||function(t){
for(var e=1;e<arguments.length;e++){
var i=arguments[e];
for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r]);
}
return t;
};
define("pages_new/common_share/video/player/controller.js",["biz_wap/ui/weui.js","biz_common/utils/string/html.js","pages_new/3rd/vue.js","pages_new/3rd/vuex.js","a/a_utils.js","pages/utils.js","pages_new/common_share/video/player/controller.html.js","biz_wap/jsapi/core.js","biz_wap/utils/mmversion.js","biz_common/utils/url/parse.js","biz_wap/utils/ajax.js","appmsg/kan_report.js","common/comm_report.js","pages_new/common_share/video/player/plugins/base.js","pages_new/common_share/video/player/plugins/danmu/danmu.js","pages_new/common_share/video/player/plugins/monitor/monitor.js","biz_wap/utils/localstorage.js","pages/report.js","pages_new/common_share/video/player/player.js","new_video/ctl.js","pages/create_txv.js","biz_wap/utils/jsmonitor_report.js","biz_wap/jsapi/leaveReport.js","biz_wap/utils/setMpInfo.js","biz_wap/jsapi/log.js","appmsg/topbar.js","common/utils.js","common/safeAreaInsets.js","pages_new/modules/utils/event_bus.js","pages_new/common_share/video/utils/immersive_data.js","pages_new/common_share/video/report.js"],function(t){
"use strict";
function e(t){
function e(r){
var o=Math.floor(Math.max(r.width,r.height));
if(o>3841)switch(1*r.format_id){
case 10002:
r=t.url_info[i["480p"].index],$.setSum(27302,6,1),e(r);
break;

case 10003:
r=t.url_info[i["270p"].index],$.setSum(27302,7,1);
}
return r;
}
for(var i={},r=0;r<t.url_info.length;r++){
var o=t.url_info[r];
switch(1*o.format_id){
case 20003:
R.isWechat&&R.isAndroid&&R.gtVersion("7.0.16",1)&&(i["1080p"]={
index:r
});
break;

case 10002:
i["720p"]={
index:r
};
break;

case 10003:
i["480p"]={
index:r
};
break;

case 10004:
i["270p"]={
index:r
};
}
}
var n=void 0;
if(ae.playerStatus&&ae.playerStatus.formatId&&"3g"!==ae.networkType&&"2g"!==ae.networkType&&1*t.is_mp_video_urgent_state!==1)switch(1*ae.playerStatus.formatId){
case 10002:
i["720p"]&&(n=t.url_info[i["720p"].index]);
break;

case 10003:
i["480p"]&&(n=t.url_info[i["480p"].index]);
break;

case 10004:
i["270p"]&&(n=t.url_info[i["270p"].index]);
}
n||("2g"===ae.networkType||1*t.is_mp_video_urgent_state===1?i["270p"]?n=t.url_info[i["270p"].index]:i["480p"]&&(n=t.url_info[i["480p"].index]):ae.isPc||"wifi"===ae.networkType?i["720p"]?n=t.url_info[i["720p"].index]:i["480p"]&&(n=t.url_info[i["480p"].index]):i["480p"]?n=t.url_info[i["480p"].index]:i["720p"]&&(n=t.url_info[i["720p"].index])),
n||(n=t.url_info[0]),n=e(n);
var a=Math.floor(n.duration_ms/1e3),s=(parseFloat(n.filesize)/1024/1024).toFixed(2);
return{
formatid:n.format_id,
time:a,
title:n.title||"",
width:n.width,
height:n.height,
file_size:n.filesize,
totalUrl:n.url,
rate:Math.round(n.filesize/1024*8/a),
flow:s,
ori_url_info:t.url_info
};
}
function i(t){
function i(){
M({
type:"GET",
dataType:"json",
timeout:3e4,
url:s,
success:function(t){
if(t&&t.base_resp&&0==t.base_resp.ret){
var i="",r=void 0;
if(t.is_mp_video_delete?(i="该视频已被发布者删除",r=72):t.is_mp_video_forbid?(i="该视频因违规已下架",
r=73):1*t.is_mp_video_transing===1?(i="正在转码，转码完成后可播放",r=78):t.is_mp_video_checking?(i="审核中",
r=75):t.is_mp_video_check_fail?(i="审核失败",r=76):1*t.is_appmsg_unauthorized===1&&(i="该视频因未经授权使用而无法查看",
r=77),i&&"undefined"!=typeof r)return void a({
err_msg:i,
code:r
});
if(t.url_info&&t.url_info.length>0)return void n({
data:e(t)
});
a({
err_msg:ae.defaultErrorWording,
code:71
});
}else a({
err_msg:"当前视频不存在，暂无法观看",
code:74
});
},
error:function(t){
var e=void 0;
e=t?t.status>=200&&t.status<400?81:t.status>=400&&t.status<500?82:t.status>=500&&t.status<600?83:0==t.status&&4==t.readyState?84:85:80,
a({
err_msg:ae.defaultErrorWording,
code:e
});
}
});
}
var o=t.retry||1,n="function"==typeof t.onSuccess?t.onSuccess:function(){},a=function(e){
return e&&e.code>=80&&e.code<=85&&o>0?(o--,void i()):void("function"==typeof t.onError&&t.onError(e));
},s=["/mp/videoplayer?action=get_mp_video_play_url","&preview=",t.preview?"1":"0","&__biz=",t.__biz,"&mid=",t.mid,"&idx=",t.idx,"&vid=",t.vid,t.auto?"&isauto=true":""].join("");
r(i);
}
function r(t){
!ae.networkType&&R.isWechat&&(R.isIOS||R.isAndroid)?D.invoke("getNetworkType",{},function(e){
ae.networkType=ae.netTypeMap[e.err_msg]||"fail",("network_type:edge"==e.err_msg||"network_type:wwan"==e.err_msg)&&(e.detailtype||e.subtype)&&(ae.networkType=e.detailtype||e.subtype),
"function"==typeof t&&t();
}):"function"==typeof t&&t();
}
function o(t){
function e(){
M({
type:"GET",
dataType:"json",
timeout:3e4,
url:p,
notJoinUrl:!0,
noXRequestedWidthHeader:!0,
success:function(e){
var i=Date.now()-o;
e=e||{},"undefined"==typeof e.em&&(e.em=0);
var r=e.em,p=void 0;
if(0==e.em){
if(e.exem>0?r=-4:0==e.exem&&e.vl&&e.vl.vi&&e.vl.vi[0]&&8==e.vl.vi[0].st&&(r=e.preview>0?-5:-3),
0!=r||e.vl&&e.vl.vi&&e.vl.vi[0]||(r=-2),0==r){
var h=e.vl.vi[0];
if(p={
newVid:h.lnk,
time:Math.floor(h.td),
title:h.ti,
width:h.vw,
height:h.vh,
file_size:h.fs,
rate:Math.round(h.fs/1024*8/h.td),
flow:(parseFloat(h.fs)/1024/1024).toFixed(2)
},h.ul&&h.ul.ui&&h.ul.ui[0]){
var d=h.ul.ui[0],l=d.url+h.fn,u=e.fl,_="";
u&&u.cnt>0?(p.formatid=10003,_="高清",p.resolution="高清;(480P)".replace(/^.*;\((:?.*)P\)$/,"$1")||0,
p.format=_,p.vt=d.vt,p.totalUrl=[l,-1!=l.indexOf("?")?"&":"?","vkey=",h.fvkey,"&sdtfrom=",z.getsdtfrom(),"&type=",1==d.dt?"tflv":2==d.dt||0==d.dt?"mp4":"","&platform=",z.getPlatformType(),"&fmt=",_,"&level=",h.level,"&br=",h.br,"&sp=",h.sp].join("")):r=-2;
}
}
0==r?(z.getinfoReport({
vid:t.vid,
val:i,
val1:r,
vurl:p.totalUrl
}),a({
data:p,
oriData:e,
c_time:i,
ret_code:r
})):(z.getinfoReport({
vid:t.vid,
val:i,
val1:r,
vurl:""
}),s(-2,{
ret_code:r,
http_status:200,
c_time:i,
err_msg:n(1*r,1*e.exem,e)
}));
}else s(r,{
ret_code:r,
http_status:200,
c_time:i,
err_msg:n(r)
});
},
error:function(e){
var i=Date.now()-o,r=void 0;
r=e?e.status>=200&&e.status<400?-23:e.status>=400&&e.status<500?-22:e.status>=500&&e.status<600?-22:0==e.status&&4==e.readyState?-21:-21:-23,
z.getinfoReport({
vid:t.vid,
val:i,
val1:r,
vurl:""
}),s(r,{
ret_code:r,
http_status:e&&e.status||0,
c_time:i,
err_msg:n(-1)
});
}
});
}
var i=t.retry||1,o=Date.now(),a="function"==typeof t.onSuccess?t.onSuccess:function(){},s=function(r,o){
return r&&-20>r&&i>0?(i--,void e()):void("function"==typeof t.onError&&t.onError(r,o));
},p=["https://h5vv6.video.qq.com/getvinfo?dtype=1&otype=ojson&appVer=1&encryptVer=6.3&platform=61001&use_proxy_sdk=0","&vid=",t.vid,"&cKey=",t.ckey,"&sdtfrom=",z.getsdtfrom(),"&device=",z.getPlatformType()].join("");
r(e);
}
function n(t,e){
var i="";
switch(1*t){
case-4:
i="因版权限制，该视频不支持播放";
break;

case-5:
i="因版权限制，该视频不支持播放";
break;

case-3:
i="因版权限制，该视频不支持播放";
break;

case 61:
i="当前视频不存在，暂无法观看";
break;

case 62:
i="当前视频已下架，暂无法观看";
break;

case 63:
i="视频加载失败，暂无法观看";
break;

case 65:
i="视频加载失败，暂无法观看";
break;

case 67:
i="视频加载失败，暂无法观看";
break;

case 69:
i="视频格式不支持移动端观看，请在电脑上观看";
break;

case 71:
i="视频加载失败，暂无法观看";
break;

case 73:
i="视频加载失败，暂无法观看";
break;

case 74:
i="视频加载失败，暂无法观看";
break;

case 80:
switch(1*e){
case 1:
i="很抱歉，当前IP地址所在地区暂不支持播放";
break;

case 2:
i="因版权限制，暂不支持播放";
break;

default:
i="因版权限制，该视频不支持播放";
}
break;

case 81:
i="视频加载失败，暂无法观看";
break;

case 82:
i="视频加载失败，暂无法观看";
break;

case 83:
switch(1*e){
case-1:
i=ae.defaultErrorWording;
break;

case-2:
i="因版权限制，该视频不支持播放";
break;

default:
i="该片为付费视频，请前往腾讯视频观看";
}
break;

case 84:
i="很抱歉，根据您的IP地址，暂无法播放";
break;

default:
i=ae.defaultErrorWording;
}
return i;
}
function a(t){
var e=["https://h5vv6.video.qq.com/getextinfo?otype=ojson","&vid=",t.vid].join("");
M({
type:"GET",
dataType:"json",
timeout:3e4,
url:e,
notJoinUrl:!0,
noXRequestedWidthHeader:!0,
success:function(e){
if(!e||"o"!=e.s||e.vl.cnt<=0)return void("function"==typeof t.onError&&t.onError(-1));
var i=e.vl.vi[0],r={
title:i.title||"视频",
desc:1*i.desc===0?"":i.desc||"",
director:i.director||"",
leading_actor:i.leading_actor||"",
costar:i.costar||"",
time:Math.floor(i.td)||0
};
if(i.pl&&i.pl.cnt>0){
var o=i.pl.pi;
r.p400_300=o[0]?o[0].url:"",r.p140_100=o[1]?o[1].url:"",r.p120_90=o[2]?o[2].url:"",
r.p400_300=r.p400_300&&-1==r.p400_300.indexOf("http")?"http://"+r.p400_300:r.p400_300,
r.p140_100=r.p140_100&&-1==r.p140_100.indexOf("http")?"http://"+r.p140_100:r.p140_100,
r.p120_90=r.p120_90&&-1==r.p120_90.indexOf("http")?"http://"+r.p120_90:r.p120_90;
}
"function"==typeof t.onSuccess&&t.onSuccess(r);
},
error:function(e){
var i=void 0;
i=e?e.status>=200&&e.status<400?-1:e.status>=400&&e.status<500?400:e.status>=500&&e.status<600?400:0==e.status&&4==e.readyState?500:500:-1,
"function"==typeof t.onError&&t.onError(i);
}
});
}
function s(){
var t=arguments.length<=0||void 0===arguments[0]?"cover":arguments[0],e=arguments[1],i=arguments[2],r=arguments[3],o=arguments[4],n=1,a=0,s=0,p=r,h=o,d=0,l=0,u=e,_=i,c=e/i,m=r/o;
return"cover"===t?m>=c?(n=i/o,a=(r-e/n)/2,p=e/n,h=o):(n=e/r,s=(o-i/n)/2,p=r,h=i/n):"contain"===t&&(m>=c?(n=e/r,
l=(i-o*n)/2,_=o*n):(n=i/o,d=(e-r*n)/2,u=r*n)),[a,s,p,h,d,l,u,_];
}
function p(t){
for(var e=1e8,i=0,r=0,o=t.length;o>r;r++)i=(i<<5)+i+t.charCodeAt(r);
return i%e;
}
function h(t,e){
return e?"/mp/videoplayer?action=get_mp_video_cover&vid="+t:location.protocol+"//puui.qpic.cn/qqvideo/0/"+t+"/0";
}
function d(t,e,i,r){
var o=j.get(ae.cachekey+r);
if(!o)return null;
try{
if(o=JSON.parse(o)||{},!o.time||Date.now()-ae.cacheTime>1*o.time)return m(r),o.videoInfo={
status:l(t,e,i,r)
},o;
}catch(n){
return m(r),null;
}
return o=o.videoInfo?o:{
videoInfo:{}
},o.videoInfo.status=l(t,e,i,r),o.videoInfo?o:null;
}
function l(t,e,i,r){
var o=j.get(ae.cachekey+t+e+i+r);
if(!o)return null;
try{
o=JSON.parse(o)||{};
}catch(n){
return v(t,e,i,r),null;
}
return o;
}
function u(){
var t=j.get(ae.cachekey+"playerStatus");
if(t){
try{
t=JSON.parse(t)||{};
}catch(e){
return void m("playerStatus");
}
t.playerStatus&&(ae.playerStatus=t.playerStatus,A.info("player controller: get player status cache "+JSON.stringify(ae.playerStatus)));
}
}
function _(t,e,i,r,o,n){
var a={
dynamicData:o.dynamicData||null,
coverUrl:o.coverUrl||""
};
j.set(ae.cachekey+r,JSON.stringify({
time:n||Date.now(),
videoInfo:a
})),o.status&&j.set(ae.cachekey+t+e+i+r,JSON.stringify(o.status));
}
function c(){
j.set(ae.cachekey+"playerStatus",JSON.stringify({
playerStatus:ae.playerStatus
})),D.invoke("handleMPPageAction",{
action:"setLocalData",
key:"formatId",
data:String(ae.playerStatus.formatId)
},function(t){
console.log("setLocalData"+JSON.stringify(t));
}),A.info("player controller: set player status cache "+JSON.stringify(ae.playerStatus));
}
function m(t){
j.remove(ae.cachekey+t);
}
function v(t,e,i,r){
j.remove(ae.cachekey+t+e+i+r);
}
function f(t){
window.ext_complete?t():G.on("ext-complete",t);
}
t("biz_wap/ui/weui.js"),t("biz_common/utils/string/html.js");
var g=t("pages_new/3rd/vue.js"),y=t("pages_new/3rd/vuex.js"),w=y.mapState,T=y.mapMutations,E=y.mapActions,S=t("a/a_utils.js"),b=t("pages/utils.js"),k=t("pages_new/common_share/video/player/controller.html.js"),D=t("biz_wap/jsapi/core.js"),R=t("biz_wap/utils/mmversion.js"),I=t("biz_common/utils/url/parse.js"),M=t("biz_wap/utils/ajax.js"),P=t("appmsg/kan_report.js"),O=t("common/comm_report.js"),C=t("pages_new/common_share/video/player/plugins/base.js"),x=t("pages_new/common_share/video/player/plugins/danmu/danmu.js"),V=t("pages_new/common_share/video/player/plugins/monitor/monitor.js"),j=t("biz_wap/utils/localstorage.js"),z=t("pages/report.js"),B=t("pages_new/common_share/video/player/player.js"),L=t("new_video/ctl.js"),U=t("pages/create_txv.js"),$=t("biz_wap/utils/jsmonitor_report.js"),W=t("biz_wap/jsapi/leaveReport.js"),F=t("biz_wap/utils/setMpInfo.js"),A=t("biz_wap/jsapi/log.js"),N=t("appmsg/topbar.js"),H=t("common/utils.js"),q=t("common/safeAreaInsets.js"),J=t("appmsg/topbar.js"),K=J.setTopBarWhenVisible,G=t("pages_new/modules/utils/event_bus.js"),X=t("biz_wap/utils/jsmonitor_report.js"),Y=t("pages_new/common_share/video/utils/immersive_data.js"),Q=Y.getImmersivePlayerData,Z=Y.oprImmersivePlayerData,te=t("pages_new/common_share/video/report.js"),ee=te.getNetType,ie=te.getDeviceModel,re=te.getOsName,oe=te.getOsVersion,ne=te.getMiaoKai,ae={
cachekey:"qqmovieStatus_",
cacheTime:6e5,
networkType:"",
isPc:/(WindowsNT)|(Windows NT)|(Macintosh)/i.test(navigator.userAgent),
defaultErrorWording:"视频加载失败，请刷新页面重试",
defaultHeadImgUrl:"http://mmbiz.qpic.cn/mmbiz/a5icZrUmbV8p5jb6RZ8aYfjfS2AVle8URwBt8QIu6XbGewB9wiaWYWkPwq4R7pfdsFibuLkic16UcxDSNYtB8HnC1Q/0",
playerStatus:{
formatId:null
},
netTypeMap:{
"network_type:fail":"fail",
"network_type:edge":"2g/3g",
"network_type:wwan":"2g/3g",
"network_type:wifi":"wifi"
},
formatIdMap:{
20003:4,
10002:3,
10003:2,
10004:1
}
},se=["继续观看",""],pe=["再次观看","refresh"],he={
1:se.concat("135px"),
2:pe.concat("135px"),
201:se.concat("100%"),
202:pe.concat("100%"),
203:se.concat("135px"),
204:pe.concat("135px")
},de="update_recommend_status",le="submitMsgToTL",ue=200,_e=function(t,e){
var i={
origin:"mp",
isLike:t?1:0,
url:encodeURIComponent(window.msg_link.html(!1)),
content:e||""
};
D.invoke("handleHaokanAction",{
action:le,
recommend:t?1:0,
server_data:JSON.stringify(i)
},function(t){
console.log("handleHaokanAction",t);
}),D.invoke("handleHaokanAction",{
action:de,
permission:1,
recommend:t?1:0
},function(t){
console.log("handleHaokanAction for client",t);
});
},ce=g.extend({
template:k,
components:_defineProperty({},B.name,B),
data:function(){
return{
opt:null,
playerOpt:null,
wrapStyle:null,
videoStyle:null,
posterStyle:null,
topStickyExpendWhenPaused:!1,
toastTips:""
};
},
computed:_extends({},w("mp-video-player",["errType","errCode","errMsg","banOprStatus","fullscreenStatus","orientationStatus","refreshBtnStatus","topStickyInfoStatus","commonReportData","enter23439ReportExData"]),{
innerPlugins:function(){
return this.opt&&this.opt.plugins&&this.opt.plugins.filter(function(t){
return t.type===C.TYPE_INNER;
})||[];
},
coverPlugins:function(){
return this.opt&&this.opt.plugins&&this.opt.plugins.filter(function(t){
return t.type===C.TYPE_COVER;
})||[];
},
controlPlugins:function(){
return this.opt&&this.opt.plugins&&this.opt.plugins.filter(function(t){
return t.type===C.TYPE_CONTROL;
})||[];
},
topStickyInfoWording:function(){
var t=he[this.topStickyInfoStatus];
return t&&t[0]||"继续观看";
},
topStickyInfoIconClass:function(){
var t=he[this.topStickyInfoStatus];
return t&&t[1]||"";
},
topStickyInfoMaskWidth:function(){
var t=he[this.topStickyInfoStatus];
return t&&t[2]||"100%";
}
}),
watch:{
banOprStatus:function(){
this.setVideoMenuItems();
},
orientationStatus:function(){
this.onOrientationStatusChange();
}
},
mounted:function(){
var t=this;
this.initController(),O.leaveReport(23443,function(){
return t.onLeaveReport23443({
event:1,
type:"leaveReport"
});
}),O.leaveReport(23443,function(){
return t.onLeaveReport23443({
type:"leaveReport"
});
}),O.leaveReport(23442,function(){
return t.onLeaveReport23442({
type:"leaveReport"
});
}),W.addReport(function(){
return t.onKykLeaveReport({
type:"leaveReport"
});
}),W.addReport(function(){
return t.onPageUnload({
type:"leaveReport"
});
}),W.addSpecificReport("native_data",function(){
return{
video_data:{
vid:t.opt.vid,
lastPlayedTime:t.getCurrentTime(),
lastPlayedTimeExpiredTime:(Date.now()+ae.cacheTime)/1e3
}
};
}),window.addEventListener("unload",this.__onLeaveReport23443EventType1=function(){
return t.onLeaveReport23443({
event:1
});
}),window.addEventListener("unload",this.__onLeaveReport23443EventType2or3=function(){
return t.onLeaveReport23443();
}),window.addEventListener("unload",this.onLeaveReport23442),window.addEventListener("unload",this.onKykLeaveReport),
window.addEventListener("unload",this.onPageUnload),window.addEventListener("resize",this.onPageResize),
document.addEventListener("visibilitychange",this.onVisibilityChange);
},
beforeDestroy:function(){
window.addEventListener("unload",this.__onLeaveReport23443EventType1),window.addEventListener("unload",this.__onLeaveReport23443EventType2or3),
window.removeEventListener("unload",this.onKykLeaveReport),window.removeEventListener("unload",this.onPageUnload),
window.removeEventListener("resize",this.onPageResize),document.removeEventListener("visibilitychange",this.onVisibilityChange),
this.disableTopSticky();
},
methods:_extends({},T("mp-video-player",["setError","setTopStickyInfoStatus","setCommonReportData","setEnter23439ReportExData","setPlay23440ReportExData","setPerf23442ReportExData","setLeave23443ReportExData","setOp23444ReportExData","setReload23445ReportExData","setAd23446ReportExData"]),E("mp-video-player",["reportEnter23439","reportPlay23440","reportPerf23442","reportLeave23443","reportOp23444","reportReload23445","reportAd23446"]),{
initController:function(){
var t=this;
return this.opt=_extends({
bizUserName:"",
bizNickName:"",
profileTabType:2,
videoTitle:"",
headImgUrl:"",
preview:!1,
fromid:0,
oriStatus:3,
isMpVideo:0,
showFullscreenMenu:!0,
supportNativeFullPlayer:!0,
canShareVideo:!0,
videoMd5:"",
oriVid:"",
vid:"",
ckey:"",
width:0,
height:0,
autoplay:!1,
muted:!1,
loop:!1,
__biz:"",
uin:"",
mid:"",
idx:"",
comment_id:"",
scene_type:0,
hitBizuin:"",
hitVid:"",
totalRange:10,
useWcSlPlayer:!1,
useImmersiveMode:!1,
useFeFullscreen:!1,
coverFit:"contain"
},this.$options.opt),this.opt.oriVid=this.opt.oriVid||this.opt.vid,this.opt.headImgUrl=this.opt.headImgUrl||ae.defaultHeadImgUrl,
1!=this.opt.oriStatus&&2!=this.opt.oriStatus&&(this.opt.oriStatus=3),(!R.isWechat||!R.isIOS&&!R.isAndroid||R.isIOS&&R.ltVersion("7.0.9")||R.isAndroid&&R.ltVersion("7.0.10")||R.isInMiniProgram||!this.opt.videoMd5)&&(this.opt.supportNativeFullPlayer=!1,
H.supportImmersiveMode||(this.opt.canShareVideo=!1)),this.__reportData=z.getVideoReportData(),
this.__gWidth=this.__gWidth||this.opt.width,this.__gHeight=this.__gHeight||this.opt.height,
this.__hasFirstPlayed=!1,this.__hasReport23439EnterStatus=0,this.__hasReport23444SubscribeBtnExpose=!1,
this.__hasLeaveReport23443EventType1=!1,this.__hasLeaveReport23443EventType2or3=!1,
this.__enterTime=(new Date).getTime(),this.__enterPageTime=this.opt.useImmersiveMode?0:this.__enterTime,
this.__enterImmersiveModeTime=0,this.__playRangeInfo=[],this.__dynamicErrMsg="",
this.__isUnloaded=!1,this.__isShowTx=!1,this.__dataCount=0,this.__targetDataCount=2,
this.__coverUrl="",this.__cacheStartTs=0,this.__initialData=null,this.__vInfo={
status:null,
coverUrl:"",
dynamicData:null
},this.hideError(),this.initLegacyPlugins(),this.initReportData(),this.initKykReportData(),
S.report115849(71),this.replaceByTxVideo()===!0?void S.report115849(70):(this.getCache(),
window.__timelineInitialData&&(this.__initialData=window.__timelineInitialData,delete window.__timelineInitialData),
this.getCoverUrl(),ae.playerStatus&&!ae.playerStatus.formatId?r(function(){
return t.getDynamicData();
}):this.getDynamicData(),H.supportImmersiveMode&&this.opt.canShareVideo&&Q({
biz:this.opt.__biz,
mid:this.opt.mid,
idx:this.opt.idx,
vid:this.opt.vid,
onSuccess:function(e){
t.playerOpt?(t.playerOpt.readNum=e.view_num&&e.view_num.pv||0,t.playerOpt.praiseNum=e.like_num&&e.like_num.pv||0,
t.playerOpt.likeNum=e.seen_num&&e.seen_num.pv||0,t.playerOpt.isPraised=e.like_num&&e.like_num.liked||0,
t.playerOpt.isLiked=e.seen_num&&e.seen_num.seen||0):t.__immersiveData=e,!t.opt.preview&&t.opt.useImmersiveMode&&D.invoke("handleHaokanAction",{
action:de,
recommend:e.seen_num.seen?1:0,
permission:1
});
}
}),this.reportH265VideoSupport(),void("number"==typeof this.opt.leaveReport12710Type&&this.leaveReport12710()));
},
reload:function(){
this.playerOpt=null,this.initController();
},
destroyPlugins:function(){
this.opt.plugins=[],this.__legacyPlugins.forEach(function(t){
return t.destroy&&t.destroy();
}),this.__legacyPlugins=[],this.__blockPlugin={};
},
resetPlayer:function(){
var t=this.$refs.player;
t&&(t.__canplay=!1,t.pause(),t.showLoading(),t.preventOperating(2),t.$refs.video.currentTime=0,
t.currentTime=0);
},
reinit:function(t){
var e=this;
this.opt&&"object"===_typeof(this.opt)&&(this.$options.opt=t),delete this.__gWidth,
delete this.__gHeight,this.$nextTick(function(){
e.initController(),O.leaveReport(23443,function(){
return e.onLeaveReport23443({
event:1,
type:"leaveReport"
});
}),O.leaveReport(23443,function(){
return e.onLeaveReport23443({
type:"leaveReport"
});
}),O.leaveReport(23442,function(){
return e.onLeaveReport23442({
type:"leaveReport"
});
}),W.addReport(function(){
return e.onKykLeaveReport({
type:"leaveReport"
});
}),W.addReport(function(){
return e.onPageUnload({
type:"leaveReport"
});
}),W.addSpecificReport("native_data",function(){
return{
video_data:{
vid:e.opt.vid,
lastPlayedTime:e.getCurrentTime(),
lastPlayedTimeExpiredTime:(Date.now()+ae.cacheTime)/1e3
}
};
});
});
},
initReportData:function(){
var t=this.__reportData;
t.mid=this.opt.mid,t.__biz=this.opt.__biz,t.idx=this.opt.idx,t.vid=this.opt.vid,
t.commentid=this.opt.comment_id,t.scene_type=this.opt.scene_type,t.auto_play=this.opt.autoplay?1:0,
t.fromid=this.opt.fromid,t.hit_bizuin=this.opt.hitBizuin,t.hit_vid=this.opt.hitVid,
this.__monitorUid=this.triggerEvent("initMonitor",64728),this.__monitorUid2=this.triggerEvent("initMonitor",110644);
},
initKykReportData:function(){
this.__videoReportInfo={
hasUnloadReport:!1,
hasApiReport:!1,
every_start_play_time:0,
every_end_play_time:0,
total_play_time:0
},this.__kanReportData={
rec_expand:b.getParam("rec_expand")||"",
scene:b.getParam("scene")||"",
report_action:1,
vid:this.opt.vid,
start_play_time:0,
end_play_time:0,
play_time:0,
has_end:0,
replay_cnt:0,
pause_cnt:0,
auto_play:this.opt.autoplay?1:0,
has_full_screen:this.fullscreenStatus?1:0
};
},
initImmersiveReportCommonData:function(){
var t=0;
try{
t=1*window.atob(this.opt.__biz);
}catch(e){}
var i=this.__vInfo.dynamicData&&this.__vInfo.dynamicData.data||{},r={
DeviceModel:ie(),
DeviceBrand:ie(),
OsName:re(),
OsVersion:oe(),
NetType:ee(),
MiaoKai:ne(),
ScreenWidth:window.screen.width,
ScreenHeight:window.screen.height
},o=-1;
R.isIOS?o=1:R.isAndroid&&(o=2),this.setCommonReportData({
Vid:this.opt.vid,
BizUin:t,
MsgId:1*this.opt.mid,
ItemIdx:1*this.opt.idx,
PlayerType:H.isWcSlPage()?1:this.__isShowTx?3:2,
Scene:1*(window.source||window.cgiData.scene||b.getParam("scene")),
SubScene:1*(window.subscene||window.cgiData.subscene||b.getParam("subscene")),
ItemShowType:this.opt.useImmersiveMode?16:1*window.real_item_show_type,
EnterId:1*window.enterid||1*window.cgiData.enterid||parseInt(Date.now()/1e3,10),
SessionId:(window.sessionid||"")+"",
ChannelId:(b.getParam("channel_session_id")||"")+"",
ReloadId:(window.reloadid||"")+"",
ReloadSeq:1*(window.reloadseq||1),
Duration:parseInt(1e3*(i.time||0)),
OrStatus:1*this.opt.oriStatus,
PageUrl:window.location.href,
VideoUrl:i.totalUrl||"",
IsFans:window.isFans?2:1,
Device:o
}),this.setPlay23440ReportExData(_extends({},r)),this.setPerf23442ReportExData(_extends({},r)),
this.setOp23444ReportExData({
FullscreenType:1
}),this.setReload23445ReportExData({
FullscreenType:1
});
},
reportH265VideoSupport:function(){
var t=this.__monitorUid2;
this.triggerEvent("setMonitor",t,{
36:1
});
var e=document.createElement("video");
if("function"==typeof e.canPlayType){
var i=e.canPlayType('video/mp4; codecs="hevc"');
("maybe"==i.toLowerCase()||"probably"==i.toLowerCase())&&this.triggerEvent("setMonitor",t,{
37:1
});
}
this.triggerEvent("sendMonitor",t);
},
getReportTypeBySceneType:function(){
return 0==this.opt.scene_type?1:1==this.opt.scene_type||2==this.opt.scene_type?2:4==this.opt.scene_type?3:7==this.opt.scene_type?4:0;
},
onPageUnload:function(t){
if(!this.__isUnloaded){
this.__isUnloaded=!0;
var e=this.__reportData;
if(0===e.videoerror?this.cacheData():this.clearCache(),this.getPlayerReportData(),
t&&"leaveReport"===t.type){
var i=[];
for(var r in e)e.hasOwnProperty(r)&&i.push(r+"="+encodeURIComponent(e[r]));
return{
reportUrl:"/mp/videoreport?",
method:"POST",
reportData:i.join("&")
};
}
z.videoreport({
data:e,
async:!1
});
}
},
onLeaveReport23442:function(t){
var e=void 0,i=void 0;
if(this.$refs.player&&(this.$refs.player.__firstPlayStart?(e=6,i=Date.now()-this.$refs.player.__firstPlayStart):this.$refs.player.__playingBufferingStartTime&&(e=7,
i=Date.now()-this.$refs.player.__playingBufferingStartTime)),e){
var r={
EventType:e,
EventTime:this.getCurrentTimeMs(),
Definition:this.getCurrentDefinition(),
VideoWidth:this.playerOpt&&this.playerOpt.videoWidth||0,
VideoHeight:this.playerOpt&&this.playerOpt.videoHeight||0,
BufferTime:i
};
if(t&&"leaveReport"===t.type)return _extends({},this.commonReportData,r);
this.reportPerf23442(r);
}
},
onLeaveReport23443:function(){
var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];
if(!(1===t.event&&this.__hasLeaveReport23443EventType1||1!==t.event&&this.__hasLeaveReport23443EventType2or3)){
var e=this.getCurrentTimeMs(),i=this.getRealPlayTime(),r=(new Date).getTime()-this.__enterTime,o=void 0;
if(1===t.event?(this.__hasLeaveReport23443EventType1=!0,o={
EventType:1,
EventTime:e,
PlayTime:i,
StayTime:r
}):(this.__hasLeaveReport23443EventType2or3=!0,o=this.fullscreenStatus?{
EventType:3,
EventTime:e,
ImmersivePlayTime:i,
ImmersiveStayTime:r
}:{
EventType:2,
EventTime:e,
PagePlayTime:i,
PageStayTime:r
}),o){
if("leaveReport"===t.type)return _extends({},this.commonReportData,o);
this.reportLeave23443(o);
}
}
},
onKykLeaveReport:function(t){
if(t&&"leaveReport"===t.type&&!this.__videoReportInfo.hasUnloadReport||!this.__videoReportInfo.hasApiReport)if(this.__videoReportInfo.every_end_play_time=Math.round(1e3*this.getCurrentTime()),
this.__pauseTimestamp||(this.__videoReportInfo.total_play_time+=this.__videoReportInfo.every_end_play_time-this.__videoReportInfo.every_start_play_time),
this.__kanReportData.play_time=this.__videoReportInfo.total_play_time,this.__kanReportData.end_play_time=Date.parse(new Date)/1e3,
t&&"leaveReport"===t.type){
if(b.getParam("rec_expand")&&1*b.getParam("scene")===94){
this.__videoReportInfo.hasApiReport=!0,console.log("kanReportData"+JSON.stringify(this.__kanReportData));
var e=[];
for(var i in this.__kanReportData)this.__kanReportData.hasOwnProperty(i)&&e.push(i+"="+encodeURIComponent(this.__kanReportData[i]));
return{
reportUrl:"https://mp.weixin.qq.com/mp/videoreport?action=report_for_kyk",
reportData:e.join("&"),
method:"POST"
};
}
}else this.__videoReportInfo.hasUnloadReport=!0,console.log("real play time"+this.__videoReportInfo.total_play_time),
P.reportKanData(this.__kanReportData);
},
onVisibilityChange:function(){
document.hidden&&this.cacheData();
},
onPageResize:function(){
var t=this;
if(!this.__preventResize)return this.$refs.player&&this.$refs.player.isWcSlPlayer?void(this.fullscreenStatus||setTimeout(function(){
var e=t.$el.parentNode,i=e&&e.getBoundingClientRect(),r=i&&i.width||0;
0!==r&&t.setVideoSize({
width:r
});
},0)):void(this.opt.height&&this.opt.width&&(this.__isShowTx&&this.__txPlayer?setTimeout(function(){
try{
var e=t.$el.parentNode,i=e&&e.getBoundingClientRect(),r=t.opt.width/t.opt.height,o=i&&i.width||0,n=Math.floor(o/r);
0!==o&&(e.style.height=n+"px",t.__gWidth=o,t.__gHeight=n,t.__txPlayer.resize({
width:o,
height:n
}));
}catch(a){}
},0):setTimeout(function(){
var e=t.$el.parentNode,i=e&&e.getBoundingClientRect(),r=t.opt.width/t.opt.height,o=i&&i.width||0,n=Math.floor(o/r);
0!==o&&(e.style.height=n+"px",t.__gWidth=o,t.__gHeight=n,t.setVideoSize({
width:o,
height:n
}));
},0)));
},
getCache:function(){
var t=d(this.opt.__biz,this.opt.mid,this.opt.idx,this.opt.vid);
if(t){
var e=this.__vInfo;
e.dynamicData=t.videoInfo.dynamicData||null,e.coverUrl=t.videoInfo.coverUrl||"",
e.status=t.videoInfo.status||null,this.__cacheStartTs=t.time||null;
}
},
cacheData:function(){
var t=this.$refs.player,e=this.__vInfo;
t&&(e.status||(e.status={}),"function"==typeof t.isEnd&&(e.status.isEnd=t.isEnd()),
"function"==typeof t.getCurTime&&(e.status.playTime=t.getCurTime()),"function"==typeof t.getPlaybackRate&&(e.status.playbackRate=t.getPlaybackRate()),
!this.__initialData&&this.__coverUrl&&(e.coverUrl=this.__coverUrl),_(this.opt.__biz,this.opt.mid,this.opt.idx,this.opt.vid,this.__vInfo,this.__cacheStartTs));
},
clearCache:function(){
m(this.opt.vid);
},
leaveReport12710:function(){
var t=this,e={
type:this.opt.leaveReport12710Type,
step:17,
useruin:this.opt.uin,
bizuin:this.opt.__biz,
mid:this.opt.mid,
idx:this.opt.idx,
vid:this.opt.vid
};
W.addReport(function(){
var i=t.getRealPlayTime();
if(!i)return!1;
var r=t.getVideoData();
return e.duration=Math.round(1e3*r.time),e.fromid=t.getFromid(),e.clienttime=Date.now(),
e.real_play_time=i,e.appmsg_scene=window.source||window.scene||0,{
reportUrl:"https://mp.weixin.qq.com/mp/ad_video_report?action=video_play_exit_report",
reportData:Object.keys(e).map(function(t){
return t+"="+encodeURIComponent(e[t]||"");
}).join("&"),
method:"POST"
};
});
},
initLegacyPlugins:function(){
var t=this.opt.plugins||[];
this.__blockPlugin={},this.__legacyPlugins=[];
var e=new V;
e.setPlayer(this),e.init&&e.init(),this.__legacyPlugins.push(e);
for(var i=0,r=t.length;r>i;i++){
var o=t[i];
o.prototype instanceof C||(o.setPlayer(this),o.init&&o.init(),this.__legacyPlugins.push(o));
}
},
initPlugins:function(){
var t=this;
this.$refs.innerPlugins&&this.$refs.innerPlugins.forEach(function(e){
return e.initContext(t);
}),this.$refs.coverPlugins&&this.$refs.coverPlugins.forEach(function(e){
return e.initContext(t);
}),this.$refs.controlPlugins&&this.$refs.controlPlugins.forEach(function(e){
return e.initContext(t);
});
},
getCoverUrl:function(){
var t=this,e="";
if(this.__initialData&&this.__initialData.initialCover?e=this.__initialData.initialCover:this.opt.isMpVideo&&window.__mpVideoCoverUrl?(e=window.__mpVideoCoverUrl,
delete window.__mpVideoCoverUrl):this.__vInfo.coverUrl&&(e=this.__vInfo.coverUrl),
e)return this.__coverUrl=e,this.__dataCount++,this.videoDataReady(),void this.getFloatCoverBase64(this.__coverUrl);
if(this.__coverUrl=h(this.opt.vid,this.opt.isMpVideo),!this.opt.isMpVideo)return this.__dataCount++,
this.videoDataReady(),void this.getFloatCoverBase64(this.__coverUrl);
var i=1,r=function o(){
M({
type:"GET",
dataType:"json",
timeout:3e4,
url:t.__coverUrl+"&f=json",
success:function(e){
e&&e.base_resp&&0==e.base_resp.ret&&e.url&&(t.__coverUrl=e.url),t.__dataCount++,
t.videoDataReady(),t.getFloatCoverBase64(t.__coverUrl);
},
error:function(){
return i>0?(i--,void o()):(t.__dataCount++,void t.videoDataReady());
}
});
};
r();
},
getDynamicData:function(){
var t=this;
if(this.opt.isMpVideo&&window.__mpVideoTransInfo&&window.__mpVideoTransInfo.length>0)return this.__dataCount++,
this.__vInfo.dynamicData={
data:e({
url_info:window.__mpVideoTransInfo.map(function(t){
return t.url=t.url.htmlDecode(),t;
})
})
},delete window.__mpVideoTransInfo,void this.videoDataReady();
if(this.__vInfo.dynamicData){
this.__dataCount++;
var r=this.__vInfo.dynamicData;
return this.__reportData.getvinfo_ret="undefined"!=typeof r.ret_code?r.ret_code:-2,
this.__reportData.getvinfo_time=r.c_time||0,this.opt.isMpVideo&&r.data&&r.data.ori_url_info&&r.data.ori_url_info.length>0&&(this.__vInfo.dynamicData={
data:e({
url_info:r.data.ori_url_info
})
}),void this.videoDataReady();
}
var n=this.__monitorUid,a=this.__monitorUid2;
return this.opt.isMpVideo?void i({
preview:this.opt.preview,
vid:this.opt.vid,
__biz:this.opt.__biz,
mid:this.opt.mid,
idx:this.opt.idx,
auto:!(!R.isAndroid||!R.gtVersion("7.0.16",1)),
onSuccess:function(e){
t.triggerEvent("setMonitor",a,{
4:1,
5:1
}),t.triggerEvent("sendMonitor",a),t.__dataCount++,t.__vInfo.dynamicData=e,t.videoDataReady();
},
onError:function(e){
var i=e.code;
switch(t.triggerEvent("setMonitor",a,{
4:1,
6:1
}),i){
case 80:
t.triggerEvent("setMonitor",a,{
7:1,
24:1
});
break;

case 81:
t.triggerEvent("setMonitor",a,{
7:1,
25:1
});
break;

case 82:
t.triggerEvent("setMonitor",a,{
7:1,
26:1
});
break;

case 83:
t.triggerEvent("setMonitor",a,{
7:1,
27:1
});
break;

case 84:
t.triggerEvent("setMonitor",a,{
7:1,
28:1
});
break;

case 85:
t.triggerEvent("setMonitor",a,{
7:1,
29:1
});
break;

case 71:
t.triggerEvent("setMonitor",a,{
8:1
});
break;

case 72:
t.triggerEvent("setMonitor",a,{
9:1
});
break;

case 73:
t.triggerEvent("setMonitor",a,{
10:1
});
break;

case 74:
t.triggerEvent("setMonitor",a,{
11:1
});
break;

case 75:
t.triggerEvent("setMonitor",a,{
34:1
});
break;

case 76:
t.triggerEvent("setMonitor",a,{
35:1
});
}
t.triggerEvent("sendMonitor",a),t.__reportData.videoerror=i,t.__dynamicErrMsg=e.err_msg||"",
t.__reportData.duration_ms=0,t.__vInfo.dynamicData=null,t.__dataCount=t.__targetDataCount,
t.videoDataReady(),t.reportPerf23442({
EventType:4,
EventTime:t.getCurrentTimeMs(),
Definition:t.getCurrentDefinition(),
VideoWidth:t.playerOpt&&t.playerOpt.videoWidth||0,
VideoHeight:t.playerOpt&&t.playerOpt.videoHeight||0,
PlayErrType:i
});
}
}):void o({
vid:this.opt.vid,
ckey:this.opt.ckey,
onSuccess:function(e){
if(t.triggerEvent("setMonitor",n,{
10:1,
11:1,
13:Math.min(e.c_time,6e4)
}),e.data.width&&e.data.height){
var i=Math.round(10*e.data.width/e.data.height*1);
i>20?i=20:0>i&&(i=0);
var r=41+2*i,o={};
o[r]=1,t.triggerEvent("setMonitor",n,o);
}else t.triggerEvent("setMonitor",n,{
83:1
});
t.triggerEvent("sendMonitor",n),t.__dataCount++,t.__vInfo.dynamicData=e,t.__reportData.getvinfo_ret=e.ret_code,
t.__reportData.getvinfo_time=e.c_time,t.__reportData.file_size=e.data.file_size,
t.__reportData.rate=e.data.rate,t.__reportData.resolution=e.data.resolution,t.__reportData.format=e.data.format,
t.__reportData.vt=e.data.vt,t.__reportData.video_ext=z.getsdtfrom(),t.videoDataReady();
},
onError:function(e,i){
if(t.triggerEvent("setMonitor",n,{
10:1,
12:1,
13:Math.min(i.c_time,6e4)
}),-2==e)switch(1*i.ret_code){
case-2:
t.triggerEvent("setMonitor",n,{
17:1
}),t.__reportData.videoerror=2;
break;

case-3:
t.triggerEvent("setMonitor",n,{
40:1
}),t.__reportData.videoerror=53;
break;

case-4:
t.triggerEvent("setMonitor",n,{
109:1
}),t.__reportData.videoerror=54;
break;

case-5:
t.triggerEvent("setMonitor",n,{
110:1
}),t.__reportData.videoerror=55;
break;

case 61:
t.triggerEvent("setMonitor",n,{
18:1
}),t.__reportData.videoerror=25;
break;

case 62:
t.triggerEvent("setMonitor",n,{
19:1
}),t.__reportData.videoerror=26;
break;

case 64:
t.triggerEvent("setMonitor",n,{
20:1
}),t.__reportData.videoerror=27;
break;

case 67:
t.triggerEvent("setMonitor",n,{
21:1
}),t.__reportData.videoerror=28;
break;

case 69:
t.triggerEvent("setMonitor",n,{
22:1
}),t.__reportData.videoerror=52;
break;

case 80:
t.triggerEvent("setMonitor",n,{
23:1
}),t.__reportData.videoerror=29;
break;

case 81:
t.triggerEvent("setMonitor",n,{
24:1
}),t.__reportData.videoerror=50;
break;

case 85:
t.triggerEvent("setMonitor",n,{
25:1
}),t.__reportData.videoerror=51;
break;

default:
t.triggerEvent("setMonitor",n,{
26:1
}),t.__reportData.videoerror=24;
}else{
switch(1*e){
case-21:
t.triggerEvent("setMonitor",n,{
14:1
});
break;

case-22:
t.triggerEvent("setMonitor",n,{
15:1
});
break;

case-23:
t.triggerEvent("setMonitor",n,{
16:1
});
}
t.__reportData.videoerror=-1*e;
}
t.triggerEvent("sendMonitor",n),t.__dynamicErrMsg=i.err_msg||"",t.__reportData.getvinfo_ret=i.ret_code,
t.__reportData.duration_ms=0,t.__reportData.getvinfo_time=i.c_time||0,t.__vInfo.dynamicData=null,
t.__dataCount=t.__targetDataCount,t.videoDataReady(),t.reportPerf23442({
EventType:4,
EventTime:t.getCurrentTimeMs(),
Definition:t.getCurrentDefinition(),
VideoWidth:t.playerOpt&&t.playerOpt.videoWidth||0,
VideoHeight:t.playerOpt&&t.playerOpt.videoHeight||0,
PlayErrType:t.__reportData.videoerror
}),window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&window.WX_BJ_REPORT.BadJs.report("TxGetVInfoApi:"+i.http_status,"httpStatus: "+i.http_status+"; errorCode: "+t.__reportData.videoerror+"; vid: "+t.opt.vid+"; ckey: "+t.opt.ckey,{
mid:"mmbizwap:txvideo_api",
view:"wap_business"
});
}
});
},
videoDataReady:function(){
this.__dataCount===this.__targetDataCount&&(this.__isShowTx?this.removeLoading():this.__vInfo.dynamicData?this.createPlayer():(this.removeLoading(),
A.error("player controller: failed to create player because no dynamic data")));
},
createPlayer:function(){
var t=this,e=this.__vInfo,i=this.__reportData,r=e.dynamicData.data;
this.__reportData.duration_ms=parseInt(1e3*r.time),this.initPlayRangeInfo({
durationMs:this.__reportData.duration_ms
}),i.vtitle=this.opt.vtitle||r.title||"",f(function(){
t.initImmersiveReportCommonData(),t.__hasReport23439EnterStatus<3&&(-1===t.controlPlugins.indexOf(x)||2===t.__hasReport23439EnterStatus?(t.__hasReport23439EnterStatus=3,
t.reportEnter23439()):t.__hasReport23439EnterStatus=1,t.opt.useImmersiveMode||t.reportPv23447());
});
var o=this.getReportTypeBySceneType(),n=void 0;
r.ori_url_info&&!function(){
var e={
10002:"超清",
10003:"高清",
10004:"流畅",
20003:"自动"
};
n=[],r.ori_url_info.forEach(function(i){
(1*i.format_id!==20003||R.isWechat&&R.isAndroid&&t.opt.useWcSlPlayer&&R.gtVersion("7.0.16",1))&&n.push({
name:i.video_quality_wording||e[i.format_id],
formatId:i.format_id,
height:i.height,
width:i.width,
src:i.url
});
});
}();
var a=[{
rate:.5,
name:"0.5倍"
},{
rate:.75,
name:"0.75倍"
},{
rate:1,
name:"1.0倍"
},{
rate:1.5,
name:"1.5倍"
},{
rate:2,
name:"2.0倍"
}],s=I.getQuery("play_time"),p=0;
this.__initialData?p=this.__initialData.initialTime||0:""!==s?p=1*s||0:e.status&&!e.status.isEnd&&(p=e.status.playTime||0),
A.info("player controller: begin to create player"),this.playerOpt={
__biz:this.opt.__biz,
mid:this.opt.mid,
idx:this.opt.idx,
bizUserName:this.opt.bizUserName,
bizNickName:this.opt.bizNickName,
profileTabType:this.opt.profileTabType,
videoTitle:i.vtitle,
videoReportType:o,
coverFit:this.opt.coverFit,
cover:this.__coverUrl,
width:this.__gWidth,
height:this.__gHeight,
videoWidth:r.width,
videoHeight:r.height,
duration:r.time,
autoplay:this.opt.autoplay,
flowNotice:this.opt.flowNotice,
flow:r.flow,
loop:this.opt.loop,
muted:this.opt.muted,
src:r.totalUrl,
formatId:r.formatid,
headImgUrl:this.opt.headImgUrl,
useWcSlPlayer:this.opt.useWcSlPlayer,
useImmersiveMode:this.opt.useImmersiveMode,
useFeFullscreen:this.opt.useFeFullscreen,
oriStatus:this.opt.oriStatus,
initialTime:p,
resolutionInfo:n,
playbackRateInfo:a,
playbackRateBtnInfoDefaultId:2,
showFullscreenMenu:this.opt.showFullscreenMenu,
supportNativeFullPlayer:this.opt.supportNativeFullPlayer,
canShareVideo:this.opt.canShareVideo,
videoMd5:this.opt.videoMd5,
extinfo:{
hit_bizuin:this.opt.hitBizuin,
hit_vid:this.opt.hitVid,
vid:this.opt.vid,
preview:this.opt.preview,
pageplayer:this
},
fileSize:r.file_size,
checkPlayAuthority:this.checkPlayAuthority,
readNum:this.__immersiveData&&this.__immersiveData.view_num&&this.__immersiveData.view_num.pv||0,
praiseNum:this.__immersiveData&&this.__immersiveData.like_num&&this.__immersiveData.like_num.pv||0,
likeNum:this.__immersiveData&&this.__immersiveData.seen_num&&this.__immersiveData.seen_num.pv||0,
isPraised:this.__immersiveData&&this.__immersiveData.like_num&&this.__immersiveData.like_num.liked||0,
isLiked:this.__immersiveData&&this.__immersiveData.seen_num&&this.__immersiveData.seen_num.seen||0
},this.qqVideoReport({
step:3
}),this.$nextTick(function(){
t.initPlugins(),t.triggerEvent("playerReady");
});
},
removeLoading:function(){
this.afterRemoveLoading();
},
afterRemoveLoading:function(){
if(!this.__isShowTx&&!this.__vInfo.dynamicData)if(this.opt.isMpVideo){
var t=1;
(72==this.__reportData.videoerror||73==this.__reportData.videoerror)&&(t=2),this.showError(this.__dynamicErrMsg,t);
}else this.showError(this.__dynamicErrMsg||"");
var e=this.getVideoData();
this.triggerEvent("videoReady",{
formatId:e&&e.formatid
});
},
showError:function(t,e){
t=t||ae.defaultErrorWording,this.setError({
type:e||1,
code:this.__reportData.videoerror,
msg:t,
refresh:t===ae.defaultErrorWording?1:0
}),this.disableTopSticky();
},
hideError:function(){
this.setError({
type:0,
code:0,
msg:"",
refresh:0
});
},
checkPlayAuthority:function(t){
var e=this;
this.opt.checkNoPaid?M({
type:"GET",
dataType:"json",
timeout:3e4,
url:"/mp/videoplayer?action=check_video_paid_status&__biz="+this.opt.__biz+"&mid="+this.opt.mid+"&idx="+this.opt.idx,
success:function(i){
1==!i.can_play?window.weui.confirm("此视频来自于付费内容，在原文付费后才可播放",{
buttons:[{
type:"default",
label:"取消"
},{
label:"前往原文",
onClick:function(){
e.opt.openArticle();
}
}]
}):"function"==typeof t.allowPlay&&t.allowPlay();
}
}):"function"==typeof t.allowPlay&&t.allowPlay();
},
onLoaded:function(){
var t=this;
setTimeout(function(){
t.removeLoading();
},0),A.info("player controller: succ created player");
},
onTimeupdate:function(t){
if(!this.__reportedTimeupdate){
this.__reportedTimeupdate=!0,L.report({
step:6,
vid:this.opt.vid,
traceid:this.getTraceId(),
orderid:this.getOrderid(),
type:this.getReportTypeBySceneType(),
fromid:this.opt.fromid
});
var e=this.$refs.player.getLog(),i=e.loadwait||0;
this.qqVideoReport({
step:6,
loadwait:i
});
}
if(!this.__reportedPv){
this.__reportedPv=!0;
var r=this.__monitorUid,o=this.__monitorUid2;
this.triggerEvent("clearMonitor",r),this.triggerEvent("clearMonitor",o),this.opt.isMpVideo?(this.triggerEvent("setMonitor",o,{
12:1,
13:1
}),this.triggerEvent("sendMonitor",o)):(this.triggerEvent("setMonitor",r,{
0:1,
1:1
}),this.triggerEvent("sendMonitor",r));
}
this.__reportData.last_ms=parseInt(1e3*t.currentTime),this.__reportData.video_play_time=parseInt(1e3*t.currentTime),
this.reportCurRangeInfo({
curTime:this.__reportData.last_ms
}),this.triggerEvent("timeupdate",t);
},
onBeginPlay:function(){
var t=this.__reportData;
t.client_time_when_play=Math.round(Date.now()/1e3),t.click_play_button=1,!this.$refs.player.autoplay&&this.recoverPlaybackRate(),
this.triggerEvent("beginPlay");
},
onDurationchange:function(){
this.$refs.player.autoplay&&this.recoverPlaybackRate();
},
onEnterFullscreen:function(){
this.__preventResize=!0,this.$refs.player.needFeFullscreen&&H.supportImmersiveMode&&this.opt.canShareVideo&&F.currentMpInfo({
disableShowFinderLiveTopBar:1,
isDisableMenuHeader:!0,
itemShowType:"16"
});
},
onExitFullscreen:function(){
var t=this;
document.body.style.backgroundColor=null,this.__resumeResizeTimeoutId&&clearTimeout(this.__resumeResizeTimeoutId),
this.__resumeResizeTimeoutId=setTimeout(function(){
t.__resumeResizeTimeoutId=null,t.__preventResize=!1;
},500),this.$refs.player.needFeFullscreen&&H.supportImmersiveMode&&this.opt.canShareVideo&&F.currentMpInfo({
disableShowFinderLiveTopBar:0,
isDisableMenuHeader:!1,
itemShowType:window.item_show_type
});
},
onFullscreenchange:function(t){
if(t.state?(this.__kanReportData.has_full_screen=1,document.body.style.backgroundColor="#000"):document.body.style.backgroundColor=null,
"immersive"===t.type||"samelayer"===t.type&&H.supportImmersiveMode||"frontend"===t.type)if(t.state){
if(("immersive"===t.type||this.$refs.player.enableWcSlPlayerFullscreenAfterOrientationChange)&&this.onEnterFullscreen(),
this.setLoop(!0),this.setVideoShareInfo(),this.setVideoMenuItems(),N.hideCurrentMpInfo(),
this.setOp23444ReportExData({
FullscreenType:2
}),this.setReload23445ReportExData({
FullscreenType:2
}),"immersive"!==t.type){
var e=!this.opt.useImmersiveMode&&"samelayer"===t.type&&this.$refs.player&&this.$refs.player.enableWcSlPlayerFullscreenAfterOrientationChange;
this.reportOp23444({
EventType:e?15:11,
EventTime:this.getCurrentTimeMs(),
FullscreenType:e?3:2
}),this.__enterImmersiveModeTime=(new Date).getTime(),this.reportLeave23443({
EventType:2,
EventTime:this.getCurrentTimeMs(),
PagePlayTime:this.getRealPlayTime(),
PageStayTime:this.__enterImmersiveModeTime-this.__enterPageTime
});
}
"immersive"===t.type?X.setSum(283598,0,1):"frontend"===t.type?X.setSum(283598,1,1):X.setSum(283598,2,1);
}else if(this.setLoop(this.opt.loop),this.recoverVideoShareInfo(),this.recoverVideoMenuItems(),
this.__enterPageTime=(new Date).getTime(),this.reportLeave23443({
EventType:3,
EventTime:this.getCurrentTimeMs(),
ImmersivePlayTime:this.getRealPlayTime(),
ImmersiveStayTime:this.__enterPageTime-this.__enterImmersiveModeTime
}),this.setOp23444ReportExData({
FullscreenType:1
}),this.setReload23445ReportExData({
FullscreenType:1
}),"immersive"!==t.type){
var e=!this.opt.useImmersiveMode&&"samelayer"===t.type&&this.$refs.player&&this.$refs.player.enableWcSlPlayerFullscreenAfterOrientationChange;
this.reportOp23444({
EventType:e?16:14,
EventTime:this.getCurrentTimeMs()
});
}
this.topStickyInfoStatus>0&&(t.state?this.$refs.player.resumeOperating():this.$refs.player.preventOperating()),
this.triggerEvent("fullscreenchange",t);
},
onOrientationStatusChange:function(){
if(this.fullscreenStatus&&this.$refs.player&&(this.opt.useImmersiveMode||!this.$refs.player.isWcSlPlayer||!this.$refs.player.enableWcSlPlayerFullscreenAfterOrientationChange)){
var t=0===this.orientationStatus?2:3;
this.setOp23444ReportExData({
FullscreenType:t
}),this.setReload23445ReportExData({
FullscreenType:t
}),this.reportOp23444({
EventType:0===this.orientationStatus?13:12,
EventTime:this.getCurrentTimeMs()
});
}
},
onTouchVideo:function(){
this.triggerEvent("touchVideo");
},
onShareVideo:function(){
var t=this;
if(this.opt.preview)return void window.weui.alert("预览状态下无法分享视频");
window.customShareSource=3,this.fullscreenStatus||this.setVideoShareInfo();
var e=function i(e){
var r=R.isIOS?!!(1*e.hasFocus):!e.hasFocus;
r||(D.remove("onWindowFocusChanged",i),t.fullscreenStatus||setTimeout(t.recoverVideoShareInfo,1e3),
setTimeout(function(){
return delete window.customShareSource;
},1e3));
};
D.on("onWindowFocusChanged",e),this.reportOp23444({
EventType:24,
EventTime:this.getCurrentTimeMs()
});
},
onPraiseVideo:function(){
return this.opt.preview?void window.weui.alert("预览状态下无法点赞视频"):(this.playerOpt.isPraised=!this.playerOpt.isPraised,
this.playerOpt.isPraised?this.playerOpt.praiseNum++:this.playerOpt.praiseNum--,Z({
biz:this.opt.__biz,
vid:this.opt.vid,
type:this.playerOpt.isPraised?3:5,
styleType:6
}),void this.reportOp23444({
EventType:25,
EventTime:this.getCurrentTimeMs()
}));
},
onLikeVideo:function(t){
if(this.opt.preview)return void window.weui.alert("预览状态下无法在看视频");
var e=this.$store.state.cgiData,i=t&&1*t.recommend||!this.playerOpt.isLiked;
t&&t.comment?this.showToast("已发送"):!this.playerOpt.isLiked&&i?(this.playerOpt.likeNum++,
1*e.item_show_type===5&&(this.$store.commit("SET_RECOMMEND_STATUS",{
hasRecommended:i
}),this.$store.commit("SET_RECOMMEND_NUM",{
recommendNum:this.playerOpt.likeNum
}))):this.playerOpt.isLiked&&!i&&(this.showToast("已取消"),this.playerOpt.likeNum--,
1*e.item_show_type===5&&(this.$store.commit("SET_RECOMMEND_STATUS",{
hasRecommended:i
}),this.$store.commit("SET_RECOMMEND_NUM",{
recommendNum:this.playerOpt.likeNum
}))),this.playerOpt.isLiked=i,Z({
biz:this.opt.__biz,
vid:this.opt.vid,
mid:this.opt.mid,
idx:this.opt.idx,
comment:t&&t.comment||"",
type:i?4:6,
styleType:t?5:7,
onSuccess:function(){
_e(i,t&&t.comment||"");
},
onError:function(){
window.weui.alert(t&&t.comment&&t.comment.length>ue?"想法不可以超过%s字".replace("%s",ue):"网络异常，请稍后重试");
}
}),this.reportOp23444({
EventType:26,
EventTime:this.getCurrentTimeMs()
});
},
onOpenSourcePage:function(){
this.triggerEvent("openSourcePage"),this.reportOp23444({
EventType:20,
EventTime:this.getCurrentTimeMs()
});
},
onShowSubscribe:function(){
this.triggerEvent("showSubscribe"),this.__hasReport23444SubscribeBtnExpose||(this.__hasReport23444SubscribeBtnExpose=!0,
this.reportOp23444({
EventType:22,
EventTime:this.getCurrentTimeMs()
}));
},
onClickSubscribe:function(){
this.triggerEvent("clickSubscribe"),this.reportOp23444({
EventType:23,
EventTime:this.getCurrentTimeMs()
});
},
onFastForward:function(){
this.triggerEvent("fastForward"),this.reportOp23444({
EventType:17,
EventTime:this.getCurrentTimeMs()
});
},
onReplay:function(){
this.triggerEvent("replay");
},
onStatusChange:function(t){
var e=this.__reportData;
if("loading"!==t.status||"seeked"!==t.subStatus&&"seeking"!==t.subStatus||this.initPlayRangeInfo({
durationMs:e.duration_ms
}),"pause"===t.status?(this.computePlayTotalTimeForKyk(t),this.__kanReportData.pause_cnt+=1):"play"===t.status?this.__videoReportInfo.every_start_play_time=Math.round(1e3*t.currentTime):"end"===t.status&&(this.__videoReportInfo.every_end_play_time=Math.round(1e3*this.getCurrentTime()),
console.log("real play time"+this.__videoReportInfo.total_play_time),this.__kanReportData.play_time=this.__videoReportInfo.total_play_time,
this.__kanReportData.end_play_time=Date.parse(new Date)/1e3,this.__kanReportData.has_end=1,
P.reportKanData(this.__kanReportData)),"loading"===t.status&&"waiting"===t.subStatus){
var i=0;
"play"===t.preStatus?i=1:"loading"===t.preStatus&&"seeked"===t.preSubStatus?i=2:"loading"===t.preStatus&&"resolutionchange"===t.preSubStatus&&(i=3),
i&&this.reportPerf23442({
EventType:2,
EventTime:this.getCurrentTimeMs(),
Definition:this.getCurrentDefinition(),
VideoWidth:this.playerOpt&&this.playerOpt.videoWidth||0,
VideoHeight:this.playerOpt&&this.playerOpt.videoHeight||0,
BufferType:i
});
}
this.triggerEvent("statusChange",t);
},
onAfterReplay:function(){
this.triggerEvent("afterReplay");
},
onHandDragComplete:function(t){
this.reportOp23444({
EventType:8,
EventTime:this.getCurrentTimeMs(),
BarBefore:t.startDragVideoTime+"",
BarAfter:t.playTime+""
}),this.triggerEvent("handDragComplete",t);
},
onBarDragComplete:function(t){
this.triggerEvent("barDragComplete",t),this.reportOp23444({
EventType:7,
EventTime:this.getCurrentTimeMs(),
BarBefore:t.startDragVideoTime+"",
BarAfter:t.playTime+""
});
},
onEnd:function(){
var t=this.__vInfo,e=this.__reportData,i=t.dynamicData.data,r=this.getReportTypeBySceneType();
e.hasended=1,L.report({
step:7,
vid:this.opt.vid,
ext1:1e3*i.time,
traceid:this.getTraceId(),
orderid:this.getOrderid(),
type:r,
fromid:this.opt.fromid
}),this.triggerEvent("beforeEnd",this.playerOpt.loop),this.playerOpt.loop?(this.__reportedPv=!1,
this.__reportData.replay=1,this.qqVideoReport({
step:3
})):this.triggerEvent("showEndContent"),this.triggerEvent("end",this.playerOpt.loop),
this.reportCurRangeInfo({
curTime:e.last_ms
}),this.initPlayRangeInfo({
durationMs:e.duration_ms
});
},
onError:function(t){
var e=this.__reportData,i=this.__monitorUid,r=this.__monitorUid2;
if(e.videoerror=!t||!t.errorcode||t.errorcode>5||t.errorcode<=0?46:t.errorcode+40,
this.opt.isMpVideo){
switch(this.__reportedPv||(this.__reportedPv=!0,this.triggerEvent("setMonitor",r,{
12:1
})),this.triggerEvent("setMonitor",r,{
14:1
}),1*t.errorcode){
case 1:
this.triggerEvent("setMonitor",r,{
15:1
});
break;

case 2:
this.triggerEvent("setMonitor",r,{
16:1
});
break;

case 3:
this.triggerEvent("setMonitor",r,{
17:1
});
break;

case 4:
this.triggerEvent("setMonitor",r,{
18:1
});
break;

case 5:
this.triggerEvent("setMonitor",r,{
19:1
});
break;

case 6:
this.triggerEvent("setMonitor",r,{
39:1
});
break;

default:
this.triggerEvent("setMonitor",r,{
20:1
});
}
this.triggerEvent("sendMonitor",r);
}else{
switch(this.__reportedPv||(this.__reportedPv=!0,this.triggerEvent("setMonitor",i,{
0:1
})),this.triggerEvent("setMonitor",i,{
2:1,
3:1
}),1*t.errorcode){
case 1:
this.triggerEvent("setMonitor",i,{
4:1
});
break;

case 2:
this.triggerEvent("setMonitor",i,{
5:1
});
break;

case 3:
this.triggerEvent("setMonitor",i,{
6:1
});
break;

case 4:
this.triggerEvent("setMonitor",i,{
7:1
});
break;

case 5:
this.triggerEvent("setMonitor",i,{
8:1
});
break;

default:
this.triggerEvent("setMonitor",i,{
9:1
});
}
this.triggerEvent("sendMonitor",i),this.triggerEvent("sendMonitor",r);
}
e.v_err_code=t.errorcode,this.showError(),this.qqVideoReport({
step:1999,
val:e.videoerror
}),this.initPlayRangeInfo({
durationMs:e.duration_ms
});
},
onFirstBufferingTime:function(t){
this.reportPerf23442({
EventType:1,
EventTime:this.getCurrentTimeMs(),
Definition:this.getCurrentDefinition(),
VideoWidth:this.playerOpt&&this.playerOpt.videoWidth||0,
VideoHeight:this.playerOpt&&this.playerOpt.videoHeight||0,
BufferTime:t.bufferingTime
});
var e=void 0;
if(e=this.__hasFirstPlayed?3:this.$refs.player.autoplay?1:2,this.reportPlay23440({
PlayType:e
}),this.__kanReportData.start_play_time=Date.parse(new Date)/1e3,this.__hasFirstPlayed){
this.__kanReportData.replay_cnt+=1;
var i={
rec_expand:b.getParam("rec_expand")||"",
scene:b.getParam("scene")||"",
report_action:1,
vid:this.opt.vid,
end_play_time:0,
play_time:0,
has_end:0,
pause_cnt:0,
auto_play:this.opt.autoplay?1:0,
has_full_screen:this.fullscreenStatus?1:0
};
this.__videoReportInfo={
hasUnloadReport:!1,
hasApiReport:!1,
every_start_play_time:0,
every_end_play_time:0,
total_play_time:0
},this.__kanReportData=_extends(this.__kanReportData,i);
}else this.__hasFirstPlayed=!0;
this.triggerEvent("firstBufferingTime",t);
},
onPlayingBufferingTime:function(t){
this.reportPerf23442({
EventType:3,
EventTime:this.getCurrentTimeMs(),
Definition:this.getCurrentDefinition(),
VideoWidth:this.playerOpt&&this.playerOpt.videoWidth||0,
VideoHeight:this.playerOpt&&this.playerOpt.videoHeight||0,
BufferTime:t.bufferingTime
}),this.triggerEvent("playingBufferingTime",t);
},
onFlowNotice:function(t){
this.reportPerf23442({
EventType:5,
EventTime:this.getCurrentTimeMs(),
Definition:this.getCurrentDefinition(),
VideoWidth:this.playerOpt&&this.playerOpt.videoWidth||0,
VideoHeight:this.playerOpt&&this.playerOpt.videoHeight||0,
Traffic:t.flow
}),this.triggerEvent("flowNotice",t);
},
onUserplay:function(t){
this.triggerEvent("userplay",t);
var e=6;
1===t.tapType?e=4:2===t.tapType&&(e=2),this.reportOp23444({
EventType:e,
EventTime:this.getCurrentTimeMs()
});
},
onUserpause:function(t){
this.triggerEvent("userpause",_extends({
curTime:this.getCurrentTime()
},t));
var e=this.__reportData;
e.pause_num=(e.pause_num||0)+1;
var i=5;
1===t.tapType?i=3:2===t.tapType&&(i=1),this.reportOp23444({
EventType:i,
EventTime:this.getCurrentTimeMs()
});
},
onWaiting:function(t){
this.triggerEvent("waiting",t);
},
onPlay:function(t){
this.__pauseTimestamp&&(this.reportOp23444({
EventType:18,
EventTime:this.getCurrentTimeMs(),
PauseTime:Date.now()-this.__pauseTimestamp
}),delete this.__pauseTimestamp),this.triggerEvent("play",t);
},
onPause:function(t){
this.triggerEvent("pause",t),this.__pauseTimestamp=Date.now();
},
onMidPlayClick:function(){
this.reportOp23444({
EventType:19,
EventTime:this.getCurrentTimeMs()
});
},
onAfterCheckVideoFit:function(t){
var e={
97:1
};
t.needToFit===!0&&(e[98]=1,e[100]=1,t.os.ios&&(e[103]=1),t.os.android&&(e[106]=1),
t.supportObjectFit===!0&&(e[101]=1,t.os.ios&&(e[104]=1),t.os.android&&(e[107]=1)));
var i=this.__monitorUid;
this.triggerEvent("setMonitor",i,e),this.triggerEvent("sendMonitor",i);
},
onBindError:function(t){
this.triggerEvent("bindError",t);
},
onRateChange:function(t){
this.triggerEvent("rateChange",t),"changed"===t.action&&(this.cacheData(),this.reportOp23444({
EventType:9,
EventTime:this.getCurrentTimeMs(),
SpeedBefore:t.rateBefore+"",
SpeedAfter:t.rateAfter+""
}));
},
onResolutionChange:function(t){
"changed"===t.action&&(ae.playerStatus.formatId=t.infoAfter&&t.infoAfter.formatId||null,
c(),this.reportOp23444({
EventType:10,
EventTime:this.getCurrentTimeMs(),
DefinitionBefore:ae.formatIdMap[t.infoBefore.formatId]+"",
DefinitionAfter:ae.formatIdMap[t.infoAfter.formatId]+""
}),this.setPerf23442ReportExData({
DefinitionBefore:ae.formatIdMap[t.infoBefore.formatId],
VideoWidthBefore:t.infoBefore.width,
VideoHeightBefore:t.infoBefore.height
})),this.triggerEvent("resolutionChange",t);
},
onBrightnessChange:function(t){
this.triggerEvent("brightnessChange",t);
},
onVolumeChange:function(t){
this.triggerEvent("volumeChange",t);
},
onProfileJump:function(t){
this.triggerEvent("profileJump",t),this.reportOp23444({
EventType:21,
EventTime:this.getCurrentTimeMs()
});
},
onProcessStateChange:function(t){
this.triggerEvent("processStateChange",t);
},
onCanplay:function(t){
this.triggerEvent("canplay",t);
},
onShowControlBar:function(t){
this.triggerEvent("showControlBar",t);
},
onHideControlBar:function(t){
this.triggerEvent("hideControlBar",t);
},
onShowMenu:function(t){
this.triggerEvent("showMenu",t);
},
triggerEvent:function(t){
for(var e=[].concat(this.$refs.innerPlugins||[],this.$refs.coverPlugins||[],this.$refs.controlPlugins||[],this.__legacyPlugins),i=this.__blockPlugin[t]||this.__blockPlugin.all,r=void 0,o=void 0,n=0,a=arguments.length,s=Array(a>1?a-1:0),p=1;a>p;p++)s[p-1]=arguments[p];
if(i&&"function"==typeof i.recv&&(r=i.recv.apply(i,[t].concat(s)),"[object Object]"==Object.prototype.toString.call(r)?(n|=r.code,
o=r.data):n|=r,1&n))return o;
for(var h=0,d=e.length;d>h;++h){
try{
var l;
r=(l=e[h]).recv.apply(l,[t].concat(s));
}catch(u){
console.error("player controller plugin error:",u,t,s);
}
if("[object Object]"==Object.prototype.toString.call(r)?(n|=r.code,o=r.data):n|=r,
2&n)break;
}
if(!(this._blockInnerHandler||4&n)){
var _=this[t+"InnerHandler"];
_&&(r=_.apply(this,[t].concat(s)),"[object Object]"==Object.prototype.toString.call(r)&&(o=r.data));
}
return 8&n||this.emitEvent.apply(this,[t.replace(/[A-Z]/g,function(t){
return"-"+t.toLowerCase();
})].concat(s)),o;
},
emitEvent:function(t){
for(var e=arguments.length,i=Array(e>1?e-1:0),r=1;e>r;r++)i[r-1]=arguments[r];
t&&this.$emit.apply(this,[t].concat(i));
},
setBlockPlugin:function(t,e){
this.__blockPlugin[t]=e;
},
replaceByTxVideo:function(){
var t=this;
if(!this.opt.ckey&&!this.opt.isMpVideo){
this.__isShowTx=!0;
var e=this.$el.getAttribute("id");
e||(e="js_tx_video_container_"+Math.random(),this.$el.setAttribute("id",e));
var i=q&&q.top||60;
this.opt.useImmersiveMode&&(this.$el.style.paddingTop=i+"px",this.$el.style.paddingBottom="60px"),
D.invoke("handleDeviceInfo",{
action:"setOrientation",
orientation:0,
lock:!0
}),U.createTxVideo({
win:window,
containerId:e,
vid:this.opt.vid,
width:this.opt.useImmersiveMode?window.screen.width:this.__gWidth,
height:this.opt.useImmersiveMode?window.screen.height-i-60:this.__gHeight,
autoplay:!1,
allowFullScreen:!0,
onSuccess:function(e){
t.__txPlayer=e.player,t.__dataCount=t.__targetDataCount,t.videoDataReady();
},
onError:function(){}
});
var r=this.__monitorUid,o=this.$store.state.cgiData;
return 1==o.is_login?this.triggerEvent("setMonitor",r,{
38:1
}):this.triggerEvent("setMonitor",r,{
39:1
}),this.triggerEvent("sendMonitor",r),!0;
}
return!1;
},
getPlayer:function(){
return this.$refs.player;
},
supportWcSlPlayer:function(){
return!!this.$refs.player&&this.$refs.player.supportWcSlPlayer();
},
initPlayRangeInfo:function(t){
function e(t,e){
for(var i=[{
start:0,
end:t,
hasReport:!1
}];;){
var r=i[i.length-1];
if(r.end>=e)break;
i.push({
start:r.end,
end:r.end+t,
hasReport:!1
});
}
return i;
}
if(!(t.durationMs<=0)){
var i=this.opt.totalRange;
this.__playRangeInfo=1e3*i>=t.durationMs?e(1e3,t.durationMs):e(Math.ceil(t.durationMs/i),t.durationMs);
}
},
reportCurRangeInfo:function(t){
var e=this.__playRangeInfo;
if(e&&0!==e.length)for(var i=e.length,r=0;i>r;r++){
var o=e[r];
if(o.start<t.curTime&&o.end>=t.curTime){
o.hasReport||(o.hasReport=!0,L.report({
step:14,
vid:this.opt.vid,
hit_bizuin:this.opt.hitBizuin,
hit_vid:this.opt.hitVid,
traceid:this.getTraceId(),
orderid:this.getOrderid(),
ori_status:this.getOriStatus(),
type:this.getReportTypeBySceneType(),
fromid:this.getFromid(),
total_range:i,
current_range:r+1,
duration:this.__reportData.duration_ms||e[i-1].end
}));
break;
}
}
},
getTraceId:function(){
return 0;
},
getOrderid:function(){
return 0;
},
getOriStatus:function(){
return this.opt.oriStatus;
},
getFromid:function(){
return this.opt.fromid;
},
qqVideoReport:function(t){
var e={
step:t.step,
loadwait:t.loadwait||0,
val:t.val||0,
vid:this.opt.vid
};
6==t.step&&(e.vt=this.__reportData.vt),z.qqvideo_common_report(e);
},
showEndContentInnerHandler:function(){
this.$refs.player.isWcSlPlayer?this.$refs.player.showCover():this.$refs.player.resetVideo();
},
danmuPluginInitedInnerHandler:function(){
this.__hasReport23439EnterStatus<3&&(1===this.__hasReport23439EnterStatus?(this.__hasReport23439EnterStatus=3,
this.reportEnter23439()):this.__hasReport23439EnterStatus=2);
},
getPlayerReportData:function(){
var t=this.__reportData,e=this.$refs.player;
e&&(t.play_time=this.getRealPlayTime(),t.full_screen=this.fullscreenStatus?1:0,t.quick_play=e.hasSeeked()?1:0,
t.drag_times=e.getSeekedTimes().join(":|:")),t.webviewid=L.getWebviewid();
},
pause:function(){
this.$refs.player&&this.$refs.player.pause4outer();
},
play:function(){
this.$refs.player&&this.$refs.player.play4outer();
},
topStickyInfoPlay:function(){
var t=this.$refs.player;
t&&(t.isEnd()?t.replay():t.play4outer());
},
getRealPlayTime:function(){
var t=0,e=this.$refs.player;
return e&&(t=Math.round(1e3*e.getPlayTotalTime())),t;
},
getCurrentTime:function(){
var t=0,e=this.$refs.player;
return e&&(t=e.getCurTime()),t;
},
getCurrentTimeMs:function(){
return Math.round(1e3*this.getCurrentTime());
},
getVideoData:function(){
return this.__vInfo&&this.__vInfo.dynamicData&&this.__vInfo.dynamicData.data?this.__vInfo.dynamicData.data:null;
},
getReportData:function(){
return this.__reportData;
},
extendMpReportData:function(t){
_extends(this.__reportData,t);
},
getMpReportData:function(){
return this.__reportData;
},
recoverPlaybackRate:function(){
var t=this,e=this.__vInfo.status,i=e&&e.playbackRate||1;
this.$refs.player.setPlaybackRate(i),this.$refs.player.isWcSlPlayer&&setTimeout(function(){
return t.$refs.player.setPlaybackRate(i);
},250);
},
setLoop:function(t){
this.playerOpt&&(this.playerOpt.loop=t);
},
setMuted:function(t){
this.playerOpt&&(this.playerOpt.muted=t);
},
setAutoplay:function(t){
this.$refs.player&&(this.$refs.player.autoplay=t);
},
setVideoSize:function(t){
this.playerOpt&&("number"==typeof t.width&&(this.playerOpt.width=t.width),"number"==typeof t.height&&(this.playerOpt.height=t.height));
},
setVideoTopSticky:function(){
var t=this,e=this.$refs.player,i=-this.$el.getBoundingClientRect().top;
if(!e||0>i)return this.unsetVideoTopSticky();
var r=e.isPlay()||this.topStickyExpendWhenPaused,o=3*this.opt.width/4,n=this.opt.height-o,a=Math.max(0,Math.min(i,n)),s=r?this.opt.height-a:Math.max(this.opt.height-i,72);
this.wrapStyle={
position:"fixed",
zIndex:9,
top:0,
height:s+"px",
transition:this.__isPlayingWhenLastStick!==r?"height .2s ease-out":"height 0s"
},this.posterStyle={
top:"auto",
bottom:0,
minHeight:Math.min(this.opt.height,o)+"px"
},this.supportWcSlPlayer()&&!function(){
var i=1-a/t.opt.height,o=t.__isPlayingWhenLastStick!==r?"transform .25s":"transform 0s",p=r&&0>n?"transform-origin .25s linear":"transform-origin 0s";
(s>72||0===t.topStickyInfoStatus)&&(t.videoStyle={
bottom:0,
position:"absolute",
transition:p+", "+o,
transform:"scale3d("+i+", "+i+", 1.1)",
transformOrigin:"bottom"
}),s>72?t.resetVideoTopStickyInfo():0===t.topStickyInfoStatus&&(t.__topStickyAnimTimer=setTimeout(function(){
if(t.topStickyInfoStatus>200){
var i=135/t.opt.width;
t.videoStyle={
bottom:0,
position:"absolute",
transition:(0>n?p:"transform-origin .2s")+", transform .25s",
transform:"scale3d("+i+", "+i+", 1.1) translate(0, "+(t.opt.height*i-s)+"px)",
transformOrigin:"left bottom",
zIndex:999
},t.__topStickyAnimTimer=setTimeout(function(){
t.setTopStickyInfoStatus({
status:e.isEnd()?2:1
}),t.__topStickyAnimTimer=null;
},200),t.setTopStickyInfoStatus({
status:e.isEnd()?204:203
});
}
},200),e.preventOperating(),t.setTopStickyInfoStatus({
status:e.isEnd()?202:201
})),t.__isPlayingWhenLastStick=r;
}();
},
unsetVideoTopSticky:function(){
this.wrapStyle=null,this.posterStyle=null,this.supportWcSlPlayer()&&(this.videoStyle=null,
this.resetVideoTopStickyInfo());
},
resetVideoTopStickyInfo:function(){
if(this.topStickyInfoStatus>0){
var t=this.$refs.player;
t&&t.resumeOperating(),this.setTopStickyInfoStatus({
status:0
}),this.__topStickyAnimTimer&&(clearTimeout(this.__topStickyAnimTimer),this.__topStickyAnimTimer=null);
}
},
enableTopSticky:function(){
this.__videoTopStickyEnabled||(window.addEventListener("scroll",this.setVideoTopSticky),
this.__videoTopStickyEnabled=!0);
},
disableTopSticky:function(){
this.__videoTopStickyEnabled&&(window.removeEventListener("scroll",this.setVideoTopSticky),
this.__videoTopStickyEnabled=!1);
},
setVideoShareInfo:function(){
if(this.playerOpt){
var t=this.$store.state.cgiData;
if("0"===window.item_show_type){
var e=["https://mp.weixin.qq.com/s?item_show_type=16","&vid=",this.opt.vid,"&__biz=",this.opt.__biz,"&mid=",this.opt.mid,"&idx=",this.opt.idx,"&sn=",t.sn||"","#wechat_redirect"].join("");
window.customShareInfo={
vid:this.opt.vid,
link:e,
img_url:this.playerOpt.cover,
img_width:"120",
img_height:"90",
forbid_msg:this.opt.preview?"预览状态下无法#op#视频":t.isPaySubscribe?"付费图文内视频暂不支持#op#":null
},F.currentMpInfo({
vid:this.opt.vid,
duration:this.playerOpt.duration,
VideoWidth:this.playerOpt&&this.playerOpt.videoWidth||120,
VideoHeight:this.playerOpt&&this.playerOpt.videoHeight||90,
videoCover:this.playerOpt.cover,
customSnapShot:R.isIOS&&this.__floatCoverBase64||"",
isMenuShowBrandInfo:0,
itemShowType:"16"
});
}else if("5"===window.item_show_type){
var e=["https://mp.weixin.qq.com/s?t=pages/video_detail_new&item_show_type=16&scene=#scene#","&vid=",this.opt.vid,"&__biz=",this.opt.__biz,"&mid=",this.opt.mid,"&idx=",this.opt.idx,"&sn=",t.sn||"","&vidsn=",t.vidsn||"","#wechat_redirect"].join("");
window.customShareInfo={
vid:this.opt.vid,
link:e,
img_url:this.playerOpt.cover,
img_width:"120",
img_height:"90",
forbid_msg:this.opt.preview?"预览状态下无法#op#视频":t.isPaySubscribe?"付费图文内视频暂不支持#op#":null
},F.currentMpInfo({
customSnapShot:R.isIOS&&this.__floatCoverBase64||"",
isMenuShowBrandInfo:0,
itemShowType:"16"
});
}
K(!1),N.setTopBar();
}
},
recoverVideoShareInfo:function(){
this.playerOpt&&("0"===window.item_show_type?(delete window.customShareInfo,F.currentMpInfo({
vid:"",
duration:0,
videoWidth:0,
videoHeight:0,
videoCover:"",
customSnapShot:"",
isMenuShowBrandInfo:1,
itemShowType:"0"
})):"5"===window.item_show_type&&F.currentMpInfo({
customSnapShot:"",
isMenuShowBrandInfo:1,
itemShowType:"5"
}),K(!0),N.setTopBar());
},
setVideoMenuItems:function(){
this.fullscreenStatus&&this.$refs.player&&this.$refs.player.needFeFullscreen&&H.supportImmersiveMode&&(this.opt.preview?D.invoke("hideMenuItems",{
menuList:["menuItem:share:appMessage"]
}):this.banOprStatus||this.$store.state.cgiData.isPaySubscribe?(D.invoke("hideMenuItems",{
menuList:["menuItem:share:appMessage","menuItem:share:timeline"]
}),D.invoke("handleHaokanAction",{
action:de,
permission:0
})):(this.banOprStatus||D.invoke("showMenuItems",{
menuList:["menuItem:share:appMessage","menuItem:share:timeline"]
}),D.invoke("handleHaokanAction",{
action:de,
permission:1,
recommend:this.playerOpt.isLiked?1:0
})));
},
recoverVideoMenuItems:function(){
this.opt.preview?D.invoke("showMenuItems",{
menuList:["menuItem:share:appMessage"]
}):(D.invoke("showMenuItems",{
menuList:["menuItem:share:appMessage","menuItem:share:timeline"]
}),D.invoke("handleHaokanAction",{
action:de,
permission:1,
recommend:window.__article_liked__?1:0
}));
},
getFloatCoverBase64:function(t){
var e=this,i=new Image;
i.crossOrigin="anonymous",i.onload=function(){
i.onload=null,i.onerror=null;
try{
var t=i.naturalWidth||i.width,r=i.naturalHeight||i.height,o=document.createElement("canvas"),n=o.getContext("2d"),a=640,p=1280;
o.width=a,o.height=p,o.style.width=a+"px",o.style.height=p+"px";
var h=s("contain",a,p,t,r);
n.drawImage.apply(n,[i].concat(_toConsumableArray(h))),n.beginPath(),n.moveTo(a/2-50,p/2-60),
n.lineTo(a/2-50,p/2+60),n.lineTo(a/2+50,p/2),n.fillStyle="rgba(255,255,255,0.8)",
n.strokeStyle="rgba(255,255,255,0.8)",n.shadowBlur=100,n.shadowColor="rgba(0,0,0,0.5)",
n.fill(),n.closePath(),n.stroke(),e.__floatCoverBase64=o.toDataURL("image/jpeg",0),
e.__floatCoverBase64=e.__floatCoverBase64.replace("data:image/jpeg;base64,",""),
e.opt.useImmersiveMode&&e.setVideoShareInfo();
}catch(d){
e.__floatCoverBase64="",console.error(d);
}
},i.onerror=function(){
e.__floatCoverBase64="",i.onload=null,i.onerror=null;
},i.src=t;
},
showToast:function(t){
var e=this;
this.__toastTimeoutId&&clearTimeout(this.__toastTimeoutId),this.toastTips=t,this.__toastTimeoutId=setTimeout(function(){
e.__toastTimeoutId=null,e.toastTips="";
},1e3);
},
reportPv23447:function(){
var t=this.$store.state.cgiData;
M({
type:"POST",
timeout:2e3,
url:"/mp/appmsgreport?action=immersive",
data:{
__biz:this.opt.__biz,
mid:this.opt.mid,
idx:this.opt.idx,
vid:this.opt.vid,
scene:t.scene,
sub_scene:t.subscene,
devicetype:t.devicetype,
version:t.clientversion,
enterid:t.enterid,
sessionid:t.sessionid,
item_show_type:window.item_show_type,
channel_session_id:t.channel_session_id
}
});
},
computePlayTotalTimeForKyk:function(t){
this.__videoReportInfo.every_end_play_time=Math.round(1e3*t.currentTime),this.__videoReportInfo.total_play_time+=this.__videoReportInfo.every_end_play_time-this.__videoReportInfo.every_start_play_time,
console.log("real play time**********"+this.__videoReportInfo.total_play_time);
},
getCurrentDefinition:function(){
return ae.playerStatus.formatId?ae.formatIdMap[ae.playerStatus.formatId]:this.__vInfo.dynamicData?ae.formatIdMap[this.__vInfo.dynamicData.data.formatid]:0;
}
})
});
return r(),u(),{
mpVideoPlayer:ce,
getFormatTime:B._getFormatTime,
getAllPlayersOfPage:B._getAllPlayersOfPage,
getHashByVid:p,
getCoverByVid:h,
getQQVideoStaticInfo:a
};
});define("appmsg/without_iframe/video_appmsg.html.js",[],function(){
return'<div id="page-content">\n    <!--S 全屏播放 full_screen_mv-->\n    <div id="js_mpvedio_wrapper_<#=vid#>" style="position:relative; height: <#=video_h#>px">\n        <div class="add_bg_color appmsg_video">\n            <div id="js_video_tail_panel_<#=vid#>" class="video_tail_module video_screen_half" style="display: none;">\n                <div class="video_tail_module__hd" id="js_video_tail_hd">\n                    <div class="account_info_wrp">\n                        <div class="profile_info_wrp js_go_profile">\n                            <img class="account_avatar" src="" alt="" id="js_tail_panel_account_avatar">\n                            <div class="account_name" id="js_tail_panel_account_name"></div>\n                            <div class="subscription_info subscription_success">\n                                <div class="account_subscription_tips js_subscription_success" id="js_subscription_success"\n                                    style="display: none;">已关注</div>\n                                <i class="account_link_icon js_profile_icon" id="js_profile_icon"></i>\n                            </div>\n                        </div>\n                        <div class="btn_account_subscription js_btn_account_subscription" id="js_btn_account_subscription" style="display: none;">\n                            关注</div>\n                    </div>\n                    <div class="opr_wrp">\n                        <span class="opr_item_wrp js_replay" id="js_replay">\n                            <i class="opr_item refresh_icon"></i>\n                            <span class="opr_item_text">重播</span>\n                        </span>\n                        <span class="opr_item_wrp share_item_wrp js_share_button" id="js_tail_share_button"\n                            style="display: none;">\n                            <i class="opr_item share_icon"></i>\n                            <span class="opr_item_text">分享</span>\n                        </span>\n                        <!--点赞后 加className selected-->\n                        <span class="opr_item_wrp like_item_wrp" id="js_tail_like_button" style="display: none;">\n                            <i class="opr_item like_icon"></i>\n                            <span class="opr_item_text">赞</span>\n                        </span>\n                        <!-- <span class="opr_item_wrp recommend_item_wrp" id="js_tail_channel_button"\n                            style="display: none;">\n                            <i class="opr_item video-logo_icon"></i>\n                            <span class="opr_item_text">随便看看</span>\n                        </span> -->\n                    </div>\n                </div>\n\n                <!-- 有拓展内容 -->\n                <div class="have_expand" id="js_expand_area">\n                </div>\n\n                <!-- 广告内容 -->\n                <div class="ad_area" id="js_tail_video_ad_area">\n                </div>\n            </div>\n        </div>\n        <div id="js_vue_player_<#=index#>"></div>\n    </div>\n    <!--E 视频播放器-->\n    <!-- S 视频社交-->\n    <div id="bottom_bar" class="interact_video" style="display:none;height: 35px;">\n        <div class="inter_opr">\n            <a id="video_detail_btn" href="javascript:;" target="_blank" class="access_original">\n                视频详情            </a>\n        </div>\n    </div>\n</div>';
});;define('page/appmsg_new/mod/album_read.css', [], function(require, exports, module) {
	return ".wx_icon_pay_tag{color:#fff;background:#fa9d3b;border-radius:2px;font-size:10px;line-height:1;padding:3px 4px}.wx_icon_pay_tag_paid{color:#fa9d3b;background:rgba(250,157,59,0.2)}@media(prefers-color-scheme:dark){.wx_icon_pay_tag{background:#c87d2f}.wx_icon_pay_tag_paid{color:rgba(250,157,59,0.6);background:rgba(250,157,59,0.2)}}.album_read_card{overflow:hidden;margin-top:16px;font-size:14px;color:rgba(0,0,0,0.9);line-height:1.4}.album_read_card .weui-flex__item{min-width:0}.album_read_card .weui-btn__word-wrp{font-size:14px;color:rgba(0,0,0,0.5)}.album_read_hd{padding:20px 24px;-webkit-box-align:center;-webkit-align-items:center;align-items:center;position:relative}.album_read_hd:active .weui-link,.album_read_hd:active .weui-btn__word-wrp{opacity:.5}.album_read_source{width:auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;word-wrap:normal;color:rgba(0,0,0,0.5)}.album_read_source a:active{opacity:.5}.album_read_directory_access{color:#576b95;margin-left:24px}.album_read_directory_access:active{opacity:.5}.album_read_directory_access:before{content:\"\";display:inline-block;vertical-align:middle;font-size:10px;width:2em;height:2em;margin-top:-0.2em;-webkit-mask:url(\"data:image\/svg+xml;charset=utf8,%3Csvg xmlns='http:\/\/www.w3.org\/2000\/svg' width='20' height='20' viewBox='0 0 20 20'%3E  %3Cg fill='none' fill-rule='evenodd'%3E    %3Cpath fill='%23D8D8D8' d='M0 0h20v20H0z' opacity='0'\/%3E    %3Cpath fill='%23576B95' d='M14.8 13c.11 0 .2.09.2.2v.8a.2.2 0 0 1-.2.2H5.2A.2.2 0 0 1 5 14v-.8c0-.11.09-.2.2-.2h9.6zm0-4c.11 0 .2.09.2.2v.8a.2.2 0 0 1-.2.2H5.2A.2.2 0 0 1 5 10v-.8c0-.11.09-.2.2-.2h9.6zm0-4c.11 0 .2.09.2.2V6a.2.2 0 0 1-.2.2H5.2A.2.2 0 0 1 5 6v-.8c0-.11.09-.2.2-.2h9.6z'\/%3E  %3C\/g%3E%3C\/svg%3E\") no-repeat 50% 50%;mask:url(\"data:image\/svg+xml;charset=utf8,%3Csvg xmlns='http:\/\/www.w3.org\/2000\/svg' width='20' height='20' viewBox='0 0 20 20'%3E  %3Cg fill='none' fill-rule='evenodd'%3E    %3Cpath fill='%23D8D8D8' d='M0 0h20v20H0z' opacity='0'\/%3E    %3Cpath fill='%23576B95' d='M14.8 13c.11 0 .2.09.2.2v.8a.2.2 0 0 1-.2.2H5.2A.2.2 0 0 1 5 14v-.8c0-.11.09-.2.2-.2h9.6zm0-4c.11 0 .2.09.2.2v.8a.2.2 0 0 1-.2.2H5.2A.2.2 0 0 1 5 10v-.8c0-.11.09-.2.2-.2h9.6zm0-4c.11 0 .2.09.2.2V6a.2.2 0 0 1-.2.2H5.2A.2.2 0 0 1 5 6v-.8c0-.11.09-.2.2-.2h9.6z'\/%3E  %3C\/g%3E%3C\/svg%3E\") no-repeat 50% 50%;-webkit-mask-size:cover;mask-size:cover;background-color:currentColor}.album_read_nav_item{position:relative;text-align:center;padding:0 24px 20px}.album_read_nav_item:before{content:\"\";position:absolute;top:4px;bottom:20px;left:0;width:1px;background:-webkit-linear-gradient(top,rgba(0,0,0,0.03),rgba(0,0,0,0.05) 50%,rgba(0,0,0,0.03) 100%)}.album_read_nav_item:active{opacity:.5}.album_read_nav_item.album_read_nav_prev{text-align:left}.album_read_nav_item.album_read_nav_next{text-align:right}.album_read_nav_item:first-child:before{display:none}.album_read_nav_item:first-child:last-child{padding-top:12px;padding-bottom:32px}.album_read_nav_item:first-child:last-child:before{top:14px;bottom:32px}.album_read_nav_item:first-child:last-child .album_read_nav_btn:before,.album_read_nav_item:first-child:last-child .album_read_nav_btn:after{display:none}.album_read_nav_item:first-child:last-child .album_read_nav_inner{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;max-width:100%}.album_read_nav_item:first-child:last-child .album_read_nav_inner:before,.album_read_nav_item:first-child:last-child .album_read_nav_inner:after{content:\"\";-webkit-flex-shrink:0;flex-shrink:0;display:inline-block;vertical-align:middle;font-size:10px;margin-top:-1px;width:1em;height:2em;-webkit-mask-size:cover;mask-size:cover;background-color:currentColor;-webkit-mask-image:url(data:image\/svg+xml,%3Csvg%20width%3D%2212%22%20height%3D%2224%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpath%20d%3D%22M2.454%206.58l1.06-1.06%205.78%205.779a.996.996%200%20010%201.413l-5.78%205.779-1.06-1.061%205.425-5.425-5.425-5.424z%22%20fill%3D%22%23B2B2B2%22%20fill-rule%3D%22evenodd%22%2F%3E%3C%2Fsvg%3E);mask-image:url(data:image\/svg+xml,%3Csvg%20width%3D%2212%22%20height%3D%2224%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpath%20d%3D%22M2.454%206.58l1.06-1.06%205.78%205.779a.996.996%200%20010%201.413l-5.78%205.779-1.06-1.061%205.425-5.425-5.425-5.424z%22%20fill%3D%22%23B2B2B2%22%20fill-rule%3D%22evenodd%22%2F%3E%3C%2Fsvg%3E)}.album_read_nav_item:first-child:last-child.album_read_nav_prev .album_read_nav_inner:before{transform:matrix(-1,0,0,-1,0,0);-ms-transform:matrix(-1,0,0,-1,0,0);-webkit-transform:matrix(-1,0,0,-1,0,0);margin-right:4px}.album_read_nav_item:first-child:last-child.album_read_nav_prev .album_read_nav_inner:after{display:none}.album_read_nav_item:first-child:last-child.album_read_nav_next .album_read_nav_inner:before{display:none}.album_read_nav_item:first-child:last-child.album_read_nav_next .album_read_nav_inner:after{margin-left:4px}.album_read_nav_item:first-child:last-child .album_read_nav_title{margin-top:0;display:-webkit-box;display:-webkit-flex;display:flex;min-width:0}.album_read_nav_item:first-child:last-child .album_read_nav_title:before{content:\"\\00B7\";display:block;margin-left:4px;margin-right:4px}.album_read_nav_item:first-child:last-child .album_read_nav_title_inner{display:block;white-space:nowrap}.album_read_nav_item:first-child:last-child .album_read_nav_btn{-webkit-flex-shrink:0;flex-shrink:0}.album_read_nav_btn{display:block;color:rgba(0,0,0,0.9);font-weight:500}.album_read_nav_btn:before,.album_read_nav_btn:after{content:\"\";display:inline-block;vertical-align:middle;font-size:10px;margin-top:-0.2em;width:1em;height:2em;-webkit-mask-size:cover;mask-size:cover;background-color:currentColor;-webkit-mask-image:url(data:image\/svg+xml,%3Csvg%20width%3D%2212%22%20height%3D%2224%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpath%20d%3D%22M2.454%206.58l1.06-1.06%205.78%205.779a.996.996%200%20010%201.413l-5.78%205.779-1.06-1.061%205.425-5.425-5.425-5.424z%22%20fill%3D%22%23B2B2B2%22%20fill-rule%3D%22evenodd%22%2F%3E%3C%2Fsvg%3E);mask-image:url(data:image\/svg+xml,%3Csvg%20width%3D%2212%22%20height%3D%2224%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpath%20d%3D%22M2.454%206.58l1.06-1.06%205.78%205.779a.996.996%200%20010%201.413l-5.78%205.779-1.06-1.061%205.425-5.425-5.425-5.424z%22%20fill%3D%22%23B2B2B2%22%20fill-rule%3D%22evenodd%22%2F%3E%3C%2Fsvg%3E)}.album_read_nav_prev .album_read_nav_btn:before{transform:matrix(-1,0,0,-1,0,0);-ms-transform:matrix(-1,0,0,-1,0,0);-webkit-transform:matrix(-1,0,0,-1,0,0);margin-right:4px}.album_read_nav_prev .album_read_nav_btn:after{display:none}.album_read_nav_next .album_read_nav_btn:before{display:none}.album_read_nav_next .album_read_nav_btn:after{margin-left:4px}.album_read_nav_title{display:block;margin-top:6px;line-height:1.4;font-weight:500}.album_read_nav_title_inner{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2}.album_read_directory .weui-half-screen-dialog{padding:0}.album_read_directory .weui-half-screen-dialog__hd{padding:0 24px;padding:0 calc(24px + constant(safe-area-inset-right)) 0 calc(24px + constant(safe-area-inset-left));padding:0 calc(24px + env(safe-area-inset-right)) 0 calc(24px + env(safe-area-inset-left))}.album_read_directory .weui-btn__word-wrp{font-size:14px}.album_read_title{color:#576b95}.album_read_directory_item{display:-webkit-box;display:-webkit-flex;display:flex;color:rgba(0,0,0,0.9);line-height:1.4;font-size:17px;padding:24px 26px 24px 42px;padding:24px calc(26px + constant(safe-area-inset-right)) 24px calc(42px + constant(safe-area-inset-left));padding:24px calc(26px + env(safe-area-inset-right)) 24px calc(42px + env(safe-area-inset-left));position:relative}.album_read_directory_item:before{content:\" \";position:absolute;left:0;bottom:0;right:0;height:1px;border-bottom:1px solid rgba(0,0,0,0.1);-webkit-transform-origin:0 100%;transform-origin:0 100%;-webkit-transform:scaleY(0.5);transform:scaleY(0.5);left:42px;left:calc(42px + constant(safe-area-inset-left));left:calc(42px + env(safe-area-inset-left));right:26px;right:calc(26px + constant(safe-area-inset-right));right:calc(26px + env(safe-area-inset-right))}.album_read_directory_item:active{background-color:rgba(0,0,0,0.05)}.album_read_directory_item .wx_icon_pay_tag{margin-left:4px;margin-top:-0.2em;display:inline-block;vertical-align:middle}.album_read_directory_current{font-weight:500}.album_read_directory_current:after{content:\"\";background:var(--weui-BRAND);position:absolute;font-size:6px;width:1em;height:1em;border-radius:100%;left:20px;left:calc(20px + constant(safe-area-inset-left));left:calc(20px + env(safe-area-inset-left));top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.album_read_directory_disabled{color:rgba(0,0,0,0.28)}.album_read_directory_item_index{margin-right:4px}@media(prefers-color-scheme:dark){.album_read_card{color:rgba(255,255,255,0.8)}.album_read_card .weui-btn__word-wrp{color:rgba(255,255,255,0.5)}.album_read_bd:before{border-top-color:rgba(255,255,255,0.05)}.album_read_directory_access{color:#7d90a9}.album_read_title{color:#7d90a9}.album_read_source{color:rgba(255,255,255,0.5)}.album_read_nav_item:before{background:-webkit-linear-gradient(top,rgba(255,255,255,0.03),rgba(255,255,255,0.05) 50%,rgba(255,255,255,0.03) 100%)}.album_read_nav_btn{color:rgba(255,255,255,0.8)}.album_read_directory_item{color:rgba(255,255,255,0.8)}.album_read_directory_item:before{border-bottom-color:rgba(255,255,255,0.05)}.album_read_directory_item:active{background-color:rgba(255,255,255,0.1)}.album_read_directory_disabled{color:rgba(255,255,255,0.24)}}";
});define("appmsg/more_read_tpl.html.js",[],function(){
return'<p class="read-more__desc">你还可以看</p>\n<div class="read-more__article__area">\n  <# list.forEach(function (item) { #>\n    <div class="read-more__article__item">\n      <a href="javascript:;" class="more_read_link"><#=item.title#></a>\n      <# if (item.fans_read_cnt > 0) { #>\n        <p class="read-more__article__extra"><#=item.fans_read_cnt#>位好友读过</p>\n      <# } #>\n    </div>\n  <# }); #>\n</div>';
});function _defineProperty(e,s,n){
return s in e?Object.defineProperty(e,s,{
value:n,
enumerable:!0,
configurable:!0,
writable:!0
}):e[s]=n,e;
}
var _extends=Object.assign||function(e){
for(var s=1;s<arguments.length;s++){
var n=arguments[s];
for(var _ in n)Object.prototype.hasOwnProperty.call(n,_)&&(e[_]=n[_]);
}
return e;
};
define("pages_new/common_share/video/store.js",["pages_new/3rd/vue.js","pages_new/3rd/vuex.js","pages_new/modules/utils/url.js","pages_new/common_share/video/lifecycle_manager.js","pages_new/common_share/video/player/player_store.js","pages_new/common_share/video/related_video_list/related_video_list_store.js","pages_new/common_share/video/like_and_share/like_and_share_store.js","pages_new/common_share/video/topic/topic_store.js","pages_new/modules/comment/comment_store.js","pages_new/modules/reward/reward_store.js","pages_new/common_share/video/player/plugins/danmu/danmu_store.js","pages_new/common_share/video/player/plugins/popup/popup_store.js","pages_new/common_share/video/player/plugins/mid_ad/mid_ad_store.js","pages_new/common_share/video/player/plugins/after_ad/after_ad_store.js","pages_new/common_share/video/player/plugins/auto_next/auto_next_store.js","pages_new/common_share/video/player/plugins/hls_tips/hls_tips_store.js"],function(e){
"use strict";
function s(){
return _extends({},window.cgiData,{
uin:window.uin,
biz:window.biz,
appmsgid:window.appmsgid,
idx:window.idx,
scene:window.scene,
subscene:window.subscene,
enterid:window.enterid,
sessionid:window.sessionid,
channel_session_id:window.channel_session_id,
real_item_show_type:window.real_item_show_type,
item_show_type:window.item_show_type,
clientversion:window.clientversion,
devicetype:window.devicetype,
continueid:window.continueid,
continueseq:window.continueseq,
reloadid:window.reloadid,
reloadseq:window.reloadseq,
exptype:window.exptype,
expsessionid:window.expsessionid,
source:window.source,
is_temp_url:window.is_temp_url,
appmsg_like_type:window.appmsg_like_type,
pass_ticket:window.pass_ticket,
passparam:window.passparam,
wxtoken:window.wxtoken,
copyright_stat:window.copyright_stat,
need_pay:window.need_pay,
is_pay_subscribe:window.is_pay_subscribe,
msg_title:window.msg_title,
msg_desc:window.msg_desc,
ct:window.ct,
ori_send_time:window.ori_send_time,
msg_link:window.msg_link,
is_login:window.is_login,
user_uin:window.user_uin,
isprofileblock:window.isprofileblock,
round_head_img:window.round_head_img,
kanyikan_video_educate_pic:window.kanyikan_video_educate_pic,
kanyikan_educate_pic:window.kanyikan_educate_pic,
appmsg_type:window.appmsg_type,
send_time:window.send_time,
isPaySubscribe:window.isPaySubscribe,
defaultAvatarUrl:window.defaultAvatarUrl
});
}
function n(){
f.forEach(function(e){
return U.registerModule(e.name,e);
});
}
function _(){
f.forEach(function(e){
return U.unregisterModule(e.name);
});
}
function o(){
x.forEach(function(e){
return U.registerModule([l.name,e.name],e);
});
}
function i(){
x.forEach(function(e){
return U.unregisterModule([l.name,e.name]);
});
}
function a(){
_(),i(),U.commit(u.SET_CGI_DATA,s()),U.commit(u.SET_URL_PARAMS,w.getParams()),n(),
o();
}
function t(e){
U.commit(u.SET_CGI_DATA,s()),U.commit(u.SET_URL_PARAMS,w.getParams()),e&&(n(),o());
}
function r(){
U.commit(u.SET_EXT_RES,{}),U.commit(u.SET_AD_RES,{}),U.commit(u.SET_CGI_DATA,{}),
U.commit(u.SET_URL_PARAMS,{});
}
var d,p=e("pages_new/3rd/vue.js"),m=e("pages_new/3rd/vuex.js"),w=e("pages_new/modules/utils/url.js"),c=e("pages_new/common_share/video/lifecycle_manager.js");
p.use(m);
var u={
SET_EXT_RES:"SET_EXT_RES",
SET_AD_RES:"SET_AD_RES",
SET_CGI_DATA:"SET_CGI_DATA",
SET_URL_PARAMS:"SET_URL_PARAMS",
SET_PRAISE_NUM:"SET_PRAISE_NUM",
SET_RECOMMEND_NUM:"SET_RECOMMEND_NUM",
SET_RECOMMEND_STATUS:"SET_RECOMMEND_STATUS",
SET_PRAISE_STATUS:"SET_PRAISE_STATUS",
SET_SUBSCRIBE_STATUS:"SET_SUBSCRIBE_STATUS",
SET_RELATED_VIDEO_SOURCE:"SET_RELATED_VIDEO_SOURCE"
},l=e("pages_new/common_share/video/player/player_store.js"),g=e("pages_new/common_share/video/related_video_list/related_video_list_store.js"),S=e("pages_new/common_share/video/like_and_share/like_and_share_store.js"),E=e("pages_new/common_share/video/topic/topic_store.js"),T=e("pages_new/modules/comment/comment_store.js"),y=e("pages_new/modules/reward/reward_store.js"),f=[g,S,E,T,y],R=e("pages_new/common_share/video/player/plugins/danmu/danmu_store.js"),h=e("pages_new/common_share/video/player/plugins/popup/popup_store.js"),A=e("pages_new/common_share/video/player/plugins/mid_ad/mid_ad_store.js"),v=e("pages_new/common_share/video/player/plugins/after_ad/after_ad_store.js"),j=e("pages_new/common_share/video/player/plugins/auto_next/auto_next_store.js"),P=e("pages_new/common_share/video/player/plugins/hls_tips/hls_tips_store.js"),x=[R,h,A,v,j,P],U=new m.Store({
modules:_defineProperty({},l.name,l),
state:{
extRes:{},
adRes:{},
cgiData:{},
urlParams:{}
},
mutations:(d={},_defineProperty(d,u.SET_EXT_RES,function(e,s){
e.extRes=s;
}),_defineProperty(d,u.SET_AD_RES,function(e,s){
e.adRes=s;
}),_defineProperty(d,u.SET_CGI_DATA,function(e,s){
e.cgiData=s;
}),_defineProperty(d,u.SET_URL_PARAMS,function(e,s){
e.urlParams=s;
}),_defineProperty(d,u.SET_PRAISE_NUM,function(e,s){
e.extRes.appmsgstat&&e.extRes.appmsgstat.old_like_num&&(e.extRes.appmsgstat.old_like_num=s.praiseNum);
}),_defineProperty(d,u.SET_RECOMMEND_NUM,function(e,s){
e.extRes.appmsgstat&&e.extRes.appmsgstat.like_num&&(e.extRes.appmsgstat.like_num=s.recommendNum);
}),_defineProperty(d,u.SET_RECOMMEND_STATUS,function(e,s){
e.extRes.appmsgstat&&(e.extRes.appmsgstat.liked=s.hasRecommended?1:0);
}),_defineProperty(d,u.SET_PRAISE_STATUS,function(e,s){
e.extRes.appmsgstat&&(e.extRes.appmsgstat.old_liked=s.hasPraised?1:0);
}),_defineProperty(d,u.SET_SUBSCRIBE_STATUS,function(e,s){
e.extRes.is_fans=s.hasSubscribed?1:0;
}),_defineProperty(d,u.SET_RELATED_VIDEO_SOURCE,function(e,s){
e.cgiData.related_video_source=s.relatedVideoSource;
}),d)
});
return c.register({
getData:a,
init:t,
destroy:r
}),U;
});var _extends=Object.assign||function(n){
for(var e=1;e<arguments.length;e++){
var t=arguments[e];
for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);
}
return n;
};
define("appmsg/comment/comment_report.js",["common/comm_report.js"],function(n){
"use strict";
var e=n("common/comm_report.js"),t=void 0;
switch(1*window.item_show_type){
case 5:
t=1;
break;

case 7:
t=2;
break;

case 8:
t=3;
break;

case 10:
t=4;
break;

case 0:
case 9:
case 11:
default:
t=0;
}
return{
report22214:function(n){
return function(t){
return e.report(22214,_extends({},n,t));
};
}({
BizUin:window.biz||"",
AppMsgId:window.parseInt(window.mid,10)||0,
AppMsgItemIdx:window.parseInt(window.idx,10)||0,
Scene:t,
EnterId:window.parseInt(window.enterid,10)||0,
CommentId64Bit:window.parseInt(window.comment_id,10)||0
}),
report22215:function(n){
return function(t){
return e.report(22215,_extends({},n,t));
};
}({
BizUin:window.biz||"",
AppMsgId:window.parseInt(window.mid,10)||0,
AppMsgItemIdx:window.parseInt(window.idx,10)||0,
Scene:t,
EnterId:window.parseInt(window.enterid,10)||0,
CommentId64Bit:window.parseInt(window.comment_id,10)||0
})
};
});function _typeof(e){
return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e;
}
function _classCallCheck(e,t){
if(!(e instanceof t))throw new TypeError("Cannot call a class as a function");
}
var _createClass=function(){
function e(e,t){
for(var n=0;n<t.length;n++){
var i=t[n];
i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i);
}
}
return function(t,n,i){
return n&&e(t.prototype,n),i&&e(t,i),t;
};
}();
define("appmsg/emotion/emotion_panel.js",["widget/wx-widget/wx_emotion_panel.css","biz_wap/jsapi/core.js","biz_common/dom/event.js","biz_common/utils/emoji_panel_data.js","biz_common/utils/emoji_data.js","biz_wap/utils/mmversion.js","appmsg/emotion/selection.js","appmsg/comment/comment_input/comment_input.js"],function(require,exports,module,alert){
"use strict";
require("widget/wx-widget/wx_emotion_panel.css");
var JSAPI=require("biz_wap/jsapi/core.js"),DomEvent=require("biz_common/dom/event.js"),panelData=require("biz_common/utils/emoji_panel_data.js"),emojiData=require("biz_common/utils/emoji_data.js"),mmversion=require("biz_wap/utils/mmversion.js"),Selection=require("appmsg/emotion/selection.js"),CommentInput=require("appmsg/comment/comment_input/comment_input.js"),emotionPanelList=[],EmotionPanel=function(){
function EmotionPanel(e){
switch(_classCallCheck(this,EmotionPanel),this.isShow=!1,this.opt=e,this.__bindEvent(),
e.type){
case"contenteditable":
this.valueKey="innerHTML",this.lastRange=null,this.__bindContenteditableEvent();
break;

default:
this.valueKey="value";
}
this.limit=e.limit,mmversion.isAndroid&&this.__initEmojiPanel(),emotionPanelList.push(this);
}
return _createClass(EmotionPanel,[{
key:"show",
value:function(){
var e=this;
this.isShow||(mmversion.isIOS?JSAPI.invoke("showSmileyPanel",{
hidden:!1,
duration:.01
},function(t){
/:ok$/.test(t.err_msg)&&(e.isShow=!0,"function"==typeof e.opt.onShow&&e.opt.onShow(t.height));
}):(this.opt.input.blur(),JSAPI.invoke("handleDeviceInfo",{
action:"hideKeyBoard"
},function(){}),setTimeout(function(){
e.panel.style.display="",e.isShow=!0,"function"==typeof e.opt.onShow&&e.opt.onShow(e.panel.offsetHeight);
},200)));
}
},{
key:"hide",
value:function(){
var e=this;
this.isShow&&(mmversion.isIOS?JSAPI.invoke("showSmileyPanel",{
hidden:!0
},function(t){
/:ok$/.test(t.err_msg)&&(e.isShow=!1,"function"==typeof e.opt.onHide&&e.opt.onHide());
}):(this.panel.style.display="none",this.isShow=!1,"function"==typeof this.opt.onHide&&this.opt.onHide(),
JSAPI.invoke("handleDeviceInfo",{
action:"hideKeyBoard"
},function(){})));
}
},{
key:"toggle",
value:function(){
this[this.isShow?"hide":"show"]();
}
},{
key:"setLimit",
value:function(e){
this.limit=e;
}
},{
key:"restoreRange",
value:function(){
if(this.lastRange)if("contenteditable"===this.opt.type){
var e=Selection.getSelection(),t=document.createRange();
t.setStart(this.lastRange.endContainer,this.lastRange.endOffset),t.setEnd(this.lastRange.endContainer,this.lastRange.endOffset),
e.removeAllRanges(),e.addRange(t);
}else{
var e=Selection.getSelection();
if(e.addRange)e.removeAllRanges(),e.addRange(this.lastRange);else{
var t=Selection.getRange();
t.setEndPoint&&(t.setEndPoint("EndToEnd",this.lastRange),t.setEndPoint("StartToStart",this.lastRange)),
t.select();
}
}else if("contenteditable"===this.opt.type){
var e=Selection.getSelection();
e.selectAllChildren(this.opt.input),e.collapseToEnd();
}else{
var n=this.opt.input,i=n.value.length;
n.setSelectionRange(i,i);
}
this.__saveRange();
}
},{
key:"__bindEvent",
value:function(){
var e=this;
DomEvent.on(this.opt.input,"touchstart",function(){
e.hide();
});
}
},{
key:"__bindContenteditableEvent",
value:function(){
var e=this;
DomEvent.on(this.opt.input,"input",function(){
e.__saveRange();
}),DomEvent.on(this.opt.input,"keyup",function(){
e.__saveRange();
}),DomEvent.on(this.opt.input,"mouseup",function(){
e.__saveRange();
});
var t=null;
DomEvent.on(this.opt.input,"paste",function(){
t&&clearTimeout(t),t=setTimeout(function(){
Selection.setCursorToEnd(CommentInput.FilterNode(e.opt.input,!0)),e.__saveRange();
},10);
});
}
},{
key:"__saveRange",
value:function(e){
this.lastRange=e||Selection.getRange();
}
},{
key:"__getContent",
value:function(e,t){
return this.opt.input[this.valueKey].substring(e,t);
}
},{
key:"__setInputValue",
value:function(e,t){
var n=this,i=this.opt.input;
if(this.opt.vueOpt){
var o=this.opt.vueOpt;
o.instance[o.key]=e,o.instance.$nextTick(function(){
n.__setSelectionRange(t);
});
}else i[this.valueKey]=e,this.__setSelectionRange(t);
}
},{
key:"__setSelectionRange",
value:function(e){
var t=this.opt.input;
if("contenteditable"===this.opt.type){
var n=(e||t.childNodes.length-1+"_").split("_").map(function(e,n,i){
return 1===n&&""===e?t.childNodes[1*i[0]].nodeValue.length:+e;
});
this.__saveRange({
endContainer:t.childNodes[n[0]],
endOffset:n[1]
});
}else t.setSelectionRange(e,e);
}
},{
key:"__insertContent",
value:function(e){
var t=this;
if(this.opt.input){
var n=this.opt.input,i="",o="",a=void 0,s=void 0;
"contenteditable"===this.opt.type?!function(){
var l=-1;
Array.prototype.forEach.call(n.childNodes,function(e,n){
t.lastRange?-1===l?e===t.lastRange.endContainer?1===e.nodeType?(l=n+1,i+=e.outerHTML):(l=n,
i+=e.nodeValue.slice(0,t.lastRange.endOffset),o+=e.nodeValue.slice(t.lastRange.endOffset)):i+=1===e.nodeType?e.outerHTML:e.nodeValue:o+=1===e.nodeType?e.outerHTML:e.nodeValue:i+=1===e.nodeType?e.outerHTML:e.nodeValue;
}),a=i+e+o,s=t.lastRange&&-1!==l?l+"_"+(t.lastRange.endOffset+e.length):"";
}():(i=this.__getContent(0,n.selectionStart),o=this.__getContent(n.selectionEnd),
a=i+e+o,s=n.selectionStart+e.length);
var l=this.opt.counter?this.opt.counter(a):a.length;
if(0!==this.limit&&l>this.limit)return;
this.__setInputValue(EmotionPanel.__filterContent(a),s);
}
}
},{
key:"__delContent",
value:function(){
var e=this;
if(this.opt.input){
var t=this.opt.input,n="",i="";
if("contenteditable"===this.opt.type){
var o=function(){
var o=-1;
if(e.lastRange?Array.prototype.some.call(t.childNodes,function(t){
return o++,t===e.lastRange.endContainer?!0:!1;
}):o=t.childNodes.length-1,-1===o)return{
v:void 0
};
var a=t.childNodes[o];
if(1===a.nodeType)if(t.removeChild(a),0===t.childNodes.length)e.lastRange=null;else{
var s=o,l=void 0;
o?(s--,l=3===t.childNodes[s].nodeType?t.childNodes[s].nodeValue.length:0):l=0,e.__saveRange({
endContainer:t.childNodes[s],
endOffset:l
});
}else{
var r=a.nodeValue;
if(r){
if(0===o&&0===e.lastRange.endOffset)return{
v:void 0
};
e.lastRange?(n=r.slice(0,e.lastRange.endOffset),i=r.slice(e.lastRange.endOffset)):(n=r,
i="");
var u=EmotionPanel.__delEmojiText(n,i),l=void 0;
null===u.value?(l=e.lastRange.endOffset-1,a.nodeValue=n.substring(0,n.length-1)+i):(l=e.lastRange.endOffset-u.length,
a.nodeValue=u.value),e.__saveRange({
endContainer:t.childNodes[o],
endOffset:l
});
}else if(o){
t.removeChild(a);
var c=t.childNodes[o-1];
e.__saveRange({
endContainer:c,
endOffset:3===c.nodeType?c.nodeValue.length:0
}),e.__delContent();
}
}
}();
if("object"===("undefined"==typeof o?"undefined":_typeof(o)))return o.v;
}else{
n=this.__getContent(0,t.selectionStart),i=this.__getContent(t.selectionEnd);
var a=void 0,s=void 0;
if(t.selectionStart===t.selectionEnd){
var l=EmotionPanel.__delEmojiText(n,i);
null===l.value?(a=n.substring(0,n.length-1)+i,s=t.selectionStart-1):(a=l.value,s=t.selectionStart-l.length);
}else a=n+i,s=t.selectionStart;
this.__setInputValue(EmotionPanel.__filterContent(a),s);
}
}
}
},{
key:"__initEmojiPanel",
value:function(){
for(var e=this,t=16,n=7,i=34,o=[],a={},s=[],l=0;l<panelData.length;l++)for(var r=0;r<emojiData.length;r++)if(emojiData[r].id===panelData[l]){
s[l]=emojiData[r];
break;
}
for(var l=0;n>l;l++)for(var r=0;t>r;r++){
var u=l*t+r;
s[u]&&o.push({
name:s[u].style,
title:s[u].emoji?s[u].emoji:s[u].cn,
bp:"background-position: 0 -"+u*i+"px;",
id:s[u].id
});
}
for(var l=0;l<s.length;l++)a[s[l].style]=s[l].emoji||s[l].cn;
var c=document.createDocumentFragment();
this.panel=document.createElement("ul"),this.panel.className="comment_primary_emotion_list_mobile comment__emoji__panel",
this.panel.style.display="none",c.appendChild(this.panel),o.forEach(function(t,n){
var i=document.createElement("li"),o=document.createElement("span");
i.className="comment_primary_emotion_item js_emotion_item",i.setAttribute("data-index",n),
o.className="comment_primary_emotion",o.setAttribute("style",t.bp),o.setAttribute("text-name",t.name),
o.setAttribute("role","button"),o.setAttribute("title",t.title),i.appendChild(o),
e.panel.appendChild(i);
}),document.body.appendChild(this.panel);
var h=void 0;
DomEvent.on(this.panel,"touchstart",function(e){
h=e.changedTouches[0].clientY;
}),DomEvent.on(this.panel,"touchmove",function(t){
var n=t.changedTouches[0].clientY,i=e.panel.scrollTop,o=e.panel.scrollHeight,a=e.panel.clientHeight;
(.5>i&&n>h||.5>o-i-a&&h>n)&&t.preventDefault(),"function"==typeof e.opt.onTouchmove&&e.opt.onTouchmove(t);
}),DomEvent.on(this.panel,"click",function(t){
if(console.log("click",t),"comment_primary_emotion"===t.target.className){
var n=t.target.getAttribute("text-name"),i=a[n];
i&&e.__insertContent(i),"function"==typeof e.opt.onChange&&e.opt.onChange({
type:"emotion",
value:n,
text:i
});
}
});
}
}],[{
key:"__filterContent",
value:function(e){
var t=e;
return t;
}
},{
key:"__getEmojiText",
value:function __getEmojiText(emoji){
for(var i=0;i<emojiData.length;i++){
var e=emojiData[i];
switch(emoji){
case e.cn:
return e.emoji||e.cn;

case e.hk:
return e.emoji||e.hk;

case e.us:
return e.emoji||e.us;

case e.emoji:
return e.emoji;

case e.code:
return e.emoji||e.cn;

default:
if(!mmversion.isIOS&&e.code.startsWith("\\ue"))try{
var c=eval("'"+e.code+"'");
if(emoji===c)return e.emoji||e.cn;
}catch(err){}
}
}
return"";
}
},{
key:"__delEmojiText",
value:function(e,t){
for(var n=null,i=0;i<emojiData.length;i++){
var o=emojiData[i];
if(o.cn&&e.endsWith(o.cn)){
n=o.cn.length;
break;
}
if(o.hk&&e.endsWith(o.hk)){
n=o.hk.length;
break;
}
if(o.us&&e.endsWith(o.us)){
n=o.us.length;
break;
}
if(o.emoji&&e.endsWith(o.emoji)){
n=o.emoji.length;
break;
}
}
return{
value:null===n?null:e.substring(0,e.length-n)+t,
length:n
};
}
}]),EmotionPanel;
}();
return mmversion.isIOS&&!function(){
var e=function(e,t,n){
"function"==typeof n&&n(),"function"==typeof e.opt.onChange&&e.opt.onChange(t);
};
JSAPI.on("onGetSmiley",function(t){
emotionPanelList.some(function(n){
if(n.isShow){
switch(t.smiley){
case"[DELETE_EMOTION]":
e(n,{
type:"action",
value:"del"
},function(){
n.__delContent();
});
break;

case"[DONE_EMOTION]":
e(n,{
type:"action",
value:"done"
},function(){
n.isShow=!1;
});
break;

default:
var i=EmotionPanel.__getEmojiText(t.smiley);
e(n,{
type:"emotion",
value:t.smiley,
text:i
},function(){
i&&n.__insertContent(i);
});
}
return!0;
}
return!1;
});
});
}(),EmotionPanel;
});function _classCallCheck(e,t){
if(!(e instanceof t))throw new TypeError("Cannot call a class as a function");
}
var _createClass=function(){
function e(e,t){
for(var n=0;n<t.length;n++){
var i=t[n];
i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i);
}
}
return function(t,n,i){
return n&&e(t.prototype,n),i&&e(t,i),t;
};
}();
define("common/fixed_input.js",["biz_common/dom/event.js"],function(e){
"use strict";
var t=e("biz_common/dom/event.js"),n=function(){
function e(n){
var i=this;
switch(_classCallCheck(this,e),this.hackStatus=!0,n.type){
case"contenteditable":
this.valueKey="innerHTML";
break;

default:
this.valueKey="value";
}
this.input=n.input,this.placeholder=this.input.cloneNode(),this.placeholder.removeAttribute("id"),
this.placeholder.style.display="none","function"==typeof n.onCreate&&n.onCreate(this.placeholder),
t.on(this.input,"focus",function(e){
if(i.hackStatus){
var t=i.input.scrollTop;
i.input.style.padding=0,i.input.style.height=0,i.placeholder.style.display="",i.placeholder.scrollTop=t,
setTimeout(function(){
i.input.style.removeProperty("padding"),i.input.style.removeProperty("height"),i.placeholder.style.display="none";
},300);
}
"function"==typeof n.onFocus&&n.onFocus(e);
}),t.on(this.input,"input",function(e){
i.placeholder[i.valueKey]=i.input[i.valueKey],"function"==typeof n.onInput&&n.onInput(e);
}),this.input.insertAdjacentElement("afterend",this.placeholder);
}
return _createClass(e,[{
key:"setInput",
value:function(e){
this.input[this.valueKey]=e,this.setPlaceholder(e);
}
},{
key:"setFocus",
value:function(){
this.input.focus();
}
},{
key:"setPlaceholder",
value:function(e){
this.placeholder[this.valueKey]=e;
}
},{
key:"enableHack",
value:function(){
this.hackStatus=!0;
}
},{
key:"disableHack",
value:function(){
this.hackStatus=!1;
}
}]),e;
}();
return n;
});